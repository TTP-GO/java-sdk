<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text Chat Widget - Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 1400px;
      margin: 40px auto;
      padding: 20px;
      background: #F9FAFB;
    }
    
    @media (max-width: 768px) {
      body {
        margin: 0;
        padding: 10px;
      }
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #111827;
      margin-top: 0;
    }
    
    h2 {
      color: #374151;
      border-bottom: 2px solid #E5E7EB;
      padding-bottom: 8px;
      margin-top: 30px;
    }
    
    .info {
      background: #EFF6FF;
      border-left: 4px solid #3B82F6;
      padding: 16px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    .status {
      margin: 20px 0;
      padding: 12px;
      background: #F3F4F6;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
    }
    
    .status.success {
      background: #D1FAE5;
      color: #065F46;
    }
    
    .status.error {
      background: #FEE2E2;
      color: #991B1B;
    }

    button {
      background: #4F46E5;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 10px 10px 0;
    }

    button:hover {
      background: #4338CA;
    }
    
    button.secondary {
      background: #6B7280;
    }
    
    button.secondary:hover {
      background: #4B5563;
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 14px;
      color: #374151;
    }

    select, input[type="text"], input[type="number"], input[type="color"] {
      padding: 8px 12px;
      border: 1px solid #D1D5DB;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      background: white;
      color: #111827;
    }

    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .code-block {
      background: #1F2937;
      color: #F9FAFB;
      padding: 16px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 12px;
      overflow-x: auto;
      margin: 20px 0;
    }
    
    /* Customization sections */
    .customization-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    
    .customization-section {
      border: 1px solid #E5E7EB;
      border-radius: 8px;
      padding: 20px;
      background: #F9FAFB;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
      margin: 0;
    }
    
    .section-toggle {
      font-size: 20px;
      color: #6B7280;
      transition: transform 0.2s;
    }
    
    .section-toggle.collapsed {
      transform: rotate(-90deg);
    }
    
    .section-content {
      margin-top: 16px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    
    .section-content.hidden {
      display: none;
    }
    
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #E5E7EB;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí¨ Text Chat Widget Test</h1>
    
    <div class="info">
      <strong>üìù Instructions:</strong>
      <ul>
        <li>Click the chat button (bottom-right) to open the chat panel</li>
        <li>Type a message and press Enter or click Send</li>
        <li>Customize the widget using the sections below</li>
        <li>Click "Apply" to update the widget with your changes</li>
      </ul>
    </div>
    
    <div id="status" class="status">Loading SDK...</div>

    <h2>Live Customization</h2>
    <div class="customization-container">
      
      <!-- Common Section -->
      <div class="customization-section">
        <div class="section-header" onclick="toggleSection('common')">
          <h3 class="section-title">üîß Common Settings</h3>
          <span class="section-toggle" id="common-toggle">‚ñº</span>
        </div>
        <div class="section-content" id="common-content">
          <label id="labelLanguage">Language
            <select id="languageSelect">
              <option value="en">English</option>
              <option value="he" selected>◊¢◊ë◊®◊ô◊™</option>
              <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
              <option value="ru">–†—É—Å—Å–∫–∏–π</option>
              <option value="es">Espa√±ol</option>
              <option value="fr">Fran√ßais</option>
              <option value="de">Deutsch</option>
            </select>
          </label>
          <label id="labelWidgetMode">Widget Mode
            <select id="modeSelect">
              <option value="unified" selected>Unified (Both)</option>
              <option value="voice-only">Voice Only</option>
              <option value="text-only">Text Only</option>
            </select>
          </label>
          <label id="labelDirection">Direction
            <select id="dirSelect">
              <option value="ltr">LTR</option>
              <option value="rtl" selected>RTL</option>
            </select>
          </label>
          <label id="labelPosition">Position
            <select id="posSelect">
              <option value="bottom-right" selected>bottom-right</option>
              <option value="bottom-left">bottom-left</option>
              <option value="top-right">top-right</option>
              <option value="top-left">top-left</option>
            </select>
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Panel</h4>
          <label>Panel Width
            <input id="panelWidth" type="number" value="350" min="260" max="520" />
          </label>
          <label>Panel Height
            <input id="panelHeight" type="number" value="500" min="360" max="900" />
          </label>
          <label>Border Radius
            <input id="panelBorderRadius" type="number" value="12" min="0" max="30" />
          </label>
          <label>Background Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="panelBgColor" type="color" value="#FFFFFF" />
              <div id="panelBgColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #FFFFFF; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="panelBgColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#FFFFFF</span>
            </div>
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Button</h4>
          <label>Button Size
            <select id="buttonSize">
              <option value="small">Small</option>
              <option value="medium" selected>Medium</option>
              <option value="large">Large</option>
              <option value="xl">XL</option>
            </select>
          </label>
          <label>Button Shape
            <select id="buttonShape">
              <option value="circle" selected>Circle</option>
              <option value="square">Square</option>
              <option value="rounded">Rounded</option>
            </select>
          </label>
          <label>Button Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="buttonBgColor" type="color" value="#7C3AED" />
              <div id="buttonBgColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #7C3AED; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="buttonBgColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#7C3AED</span>
            </div>
          </label>
          <label>Button Hover Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="buttonHoverColor" type="color" value="#059669" />
              <div id="buttonHoverColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #059669; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="buttonHoverColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#059669</span>
            </div>
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Header</h4>
          <label>Title
            <input id="headerTitle" type="text" value="◊¢◊ï◊ñ◊® ◊ï◊ô◊®◊ò◊ï◊ê◊ú◊ô ◊ó◊õ◊ù" />
          </label>
          <label>Show Title
            <select id="headerShowTitle">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
          <label>Background Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="headerBgColor" type="color" value="#7C3AED" />
              <div id="headerBgColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #7C3AED; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="headerBgColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#7C3AED</span>
            </div>
          </label>
          <label>Text Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="headerTextColor" type="color" value="#FFFFFF" />
              <div id="headerTextColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #FFFFFF; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="headerTextColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#FFFFFF</span>
            </div>
          </label>
          <label>Show Close Button
            <select id="headerShowClose">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Tooltips</h4>
          <label>New Chat Tooltip
            <input id="tooltipNewChat" type="text" value="" placeholder="Leave empty for default" />
          </label>
          <label>Back Tooltip
            <input id="tooltipBack" type="text" value="" placeholder="Leave empty for default" />
          </label>
          <label>Close Tooltip
            <input id="tooltipClose" type="text" value="" placeholder="Leave empty for default" />
          </label>
          <label>Mute Tooltip (Voice)
            <input id="tooltipMute" type="text" value="" placeholder="Leave empty for default" />
          </label>
          <label>Speaker Tooltip (Voice)
            <input id="tooltipSpeaker" type="text" value="" placeholder="Leave empty for default" />
          </label>
          <label>End Call Tooltip (Voice)
            <input id="tooltipEndCall" type="text" value="" placeholder="Leave empty for default" />
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Messages</h4>
          <label>Font Size
            <input id="msgFontSize" type="text" value="14px" />
          </label>
          <label>Border Radius
            <input id="msgBorderRadius" type="number" value="8" min="0" max="30" />
          </label>
          <label>Text Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="msgTextColor" type="color" value="#1F2937" />
              <div id="msgTextColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #1F2937; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="msgTextColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#1F2937</span>
            </div>
          </label>
          <label>User Bubble Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="userBgColor" type="color" value="#E5E7EB" />
              <div id="userBgColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #E5E7EB; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="userBgColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#E5E7EB</span>
            </div>
          </label>
          <label>Agent Bubble Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="agentBgColor" type="color" value="#F3F4F6" />
              <div id="agentBgColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #F3F4F6; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="agentBgColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#F3F4F6</span>
            </div>
          </label>
          <label>System Bubble Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="systemBgColor" type="color" value="#DCFCE7" />
              <div id="systemBgColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #DCFCE7; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="systemBgColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#DCFCE7</span>
            </div>
          </label>
          <label>Error Bubble Color
            <div style="display: flex; gap: 8px; align-items: center;">
              <input id="errorBgColor" type="color" value="#FEE2E2" />
              <div id="errorBgColorColorBox" style="width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: #FEE2E2; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
              <span id="errorBgColorValue" style="font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;">#FEE2E2</span>
            </div>
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Animation</h4>
          <label>Enable Hover
            <select id="animHover">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
          <label>Enable Pulse
            <select id="animPulse">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
          <label>Enable Slide
            <select id="animSlide">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
          <label>Duration (seconds)
            <input id="animDuration" type="number" value="0.3" min="0.1" max="2" step="0.1" />
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Behavior</h4>
          <label>Start Open
            <select id="behaviorStartOpen">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
          <label>Hidden Button
            <select id="behaviorHidden">
              <option value="false" selected>No</option>
              <option value="true">Yes</option>
            </select>
          </label>
          <label>Show Welcome Message
            <select id="behaviorWelcome">
              <option value="true" selected>Yes</option>
              <option value="false">No</option>
            </select>
          </label>
          <label>Welcome Message
            <input id="behaviorWelcomeMsg" type="text" value="◊©◊ú◊ï◊ù! ◊ê◊ô◊ö ◊ê◊§◊©◊® ◊ú◊¢◊ñ◊ï◊®?" />
          </label>
        </div>
      </div>
      
      <!-- Voice Section -->
      <div class="customization-section">
        <div class="section-header" onclick="toggleSection('voice')">
          <h3 class="section-title">üé§ Voice Settings</h3>
          <span class="section-toggle collapsed" id="voice-toggle">‚ñ∂</span>
        </div>
        <div class="section-content hidden" id="voice-content">
          <h4 style="grid-column: 1/-1; margin: 0 0 8px 0; color: #6B7280; font-size: 14px;">Voice Interface</h4>
          <label>Avatar Background Color
            <input id="voiceAvatarBg" type="color" value="#667eea" />
          </label>
          <label>Avatar Active Background
            <input id="voiceAvatarActiveBg" type="color" value="#667eea" />
          </label>
          <label>Status Title Color
            <input id="voiceStatusTitleColor" type="color" value="#1e293b" />
          </label>
          <label>Status Subtitle Color
            <input id="voiceStatusSubtitleColor" type="color" value="#64748b" />
          </label>
          <label>Start Call Button Color
            <input id="voiceStartCallBtnColor" type="color" value="#667eea" />
          </label>
          <label>Start Call Button Text Color
            <input id="voiceStartCallBtnTextColor" type="color" value="#FFFFFF" />
          </label>
          <label>Transcript Background
            <input id="voiceTranscriptBg" type="color" value="#FFFFFF" />
          </label>
          <label>Transcript Text Color
            <input id="voiceTranscriptTextColor" type="color" value="#1e293b" />
          </label>
          <label>Transcript Label Color
            <input id="voiceTranscriptLabelColor" type="color" value="#94a3b8" />
          </label>
          <label>Control Button Color
            <input id="voiceControlBtnColor" type="color" value="#FFFFFF" />
          </label>
          <label>Control Button Secondary Color
            <input id="voiceControlBtnSecondaryColor" type="color" value="#64748b" />
          </label>
          <label>End Call Button Color
            <input id="voiceEndCallBtnColor" type="color" value="#ef4444" />
          </label>
          <label>Mic Button Color
            <input id="voiceMicBtnColor" type="color" value="#10B981" />
          </label>
          <label>Mic Button Active Color
            <input id="voiceMicBtnActiveColor" type="color" value="#EF4444" />
          </label>
          <label>Mic Button Hint Text
            <input id="voiceMicHintText" type="text" value="Click the button to start voice conversation" />
          </label>
          <label>Mic Button Hint Color
            <input id="voiceMicHintColor" type="color" value="#6B7280" />
          </label>
          <label>Mic Button Hint Font Size
            <input id="voiceMicHintFontSize" type="text" value="12px" />
          </label>
        </div>
      </div>
      
      <!-- Text Section -->
      <div class="customization-section">
        <div class="section-header" onclick="toggleSection('text')">
          <h3 class="section-title">üí¨ Text Settings</h3>
          <span class="section-toggle collapsed" id="text-toggle">‚ñ∂</span>
        </div>
        <div class="section-content hidden" id="text-content">
          <h4 style="grid-column: 1/-1; margin: 0 0 8px 0; color: #6B7280; font-size: 14px;">Send Button</h4>
          <label>Send Button Color
            <input id="textSendBtnColor" type="color" value="#7C3AED" />
          </label>
          <label>Send Button Hover Color
            <input id="textSendBtnHoverColor" type="color" value="#7C3AED" />
          </label>
          <label>Send Button Active Color
            <input id="textSendBtnActiveColor" type="color" value="#6D28D9" />
          </label>
          <label>Send Button Text
            <input id="textSendBtnText" type="text" value="‚û§" />
          </label>
          <label>Send Button Text Color
            <input id="textSendBtnTextColor" type="color" value="#FFFFFF" />
          </label>
          <label>Send Button Font Size
            <input id="textSendBtnFontSize" type="text" value="18px" />
          </label>
          <label>Send Button Font Weight
            <input id="textSendBtnFontWeight" type="text" value="500" />
          </label>
          <label>Send Button Hint Text
            <input id="textSendHintText" type="text" value="" />
          </label>
          <label>Send Button Hint Color
            <input id="textSendHintColor" type="color" value="#6B7280" />
          </label>
          <label>Send Button Hint Font Size
            <input id="textSendHintFontSize" type="text" value="12px" />
          </label>
          
          <h4 style="grid-column: 1/-1; margin: 16px 0 8px 0; color: #6B7280; font-size: 14px;">Input Field</h4>
          <label>Placeholder
            <input id="textInputPlaceholder" type="text" value="◊î◊ß◊ú◊ì ◊î◊ï◊ì◊¢◊î..." />
          </label>
          <label>Border Color
            <input id="textInputBorderColor" type="color" value="#E5E7EB" />
          </label>
          <label>Focus Color
            <input id="textInputFocusColor" type="color" value="#7C3AED" />
          </label>
          <label>Background Color
            <input id="textInputBgColor" type="color" value="#FFFFFF" />
          </label>
          <label>Text Color
            <input id="textInputTextColor" type="color" value="#1F2937" />
          </label>
          <label>Font Size
            <input id="textInputFontSize" type="text" value="14px" />
          </label>
          <label>Border Radius
            <input id="textInputBorderRadius" type="number" value="20" min="0" max="30" />
          </label>
          <label>Padding
            <input id="textInputPadding" type="text" value="6px 14px" />
          </label>
        </div>
      </div>
      
      <!-- Landing Section -->
      <div class="customization-section">
        <div class="section-header" onclick="toggleSection('landing')">
          <h3 class="section-title">üéØ Landing Screen Settings</h3>
          <span class="section-toggle collapsed" id="landing-toggle">‚ñ∂</span>
        </div>
        <div class="section-content hidden" id="landing-content">
          <label>Background Color
            <input id="landingBgColor" type="color" value="#f8fafc" />
          </label>
          <label>Logo (Emoji/Text)
            <input id="landingLogo" type="text" value="ü§ñ" />
          </label>
          <label>Title
            <input id="landingTitle" type="text" value="" placeholder="Leave empty for default" />
          </label>
          <label>Title Color
            <input id="landingTitleColor" type="color" value="#1e293b" />
          </label>
          <label>Mode Card Background
            <input id="landingCardBg" type="color" value="#FFFFFF" />
          </label>
          <label>Mode Card Border Color
            <input id="landingCardBorder" type="color" value="#E2E8F0" />
          </label>
          <label>Mode Card Hover Border
            <input id="landingCardHoverBorder" type="color" value="#7C3AED" />
          </label>
          <label>Mode Card Icon Background
            <input id="landingCardIconBg" type="color" value="#7C3AED" />
          </label>
          <label>Mode Card Title Color
            <input id="landingCardTitleColor" type="color" value="#111827" />
          </label>
          <label>Voice Card Icon
            <input id="landingVoiceIcon" type="text" value="üé§" />
          </label>
          <label>Text Card Icon
            <input id="landingTextIcon" type="text" value="üí¨" />
          </label>
        </div>
      </div>
      
    </div>
    
    <div class="action-buttons">
      <button id="resetBtn" class="secondary">üîÑ Reset</button>
    </div>
  </div>

  <!-- Load the SDK from dist folder -->
  <script src="../agent-widget.js" data-agent-id="agent_87c4a55a1" data-app-id="app_Bc01EqMQt2Euehl4qqZSi6l3FJP42Q9vJ0pC" onload="console.log('SDK script loaded successfully')" onerror="console.error('Failed to load SDK script')"></script>
  
  <script>
    // Language selection only affects widget, not page UI
    // No translations needed for page UI
    
    // Setup color value displays for all color inputs
    function setupColorDisplays() {
      const colorInputs = document.querySelectorAll('input[type="color"]');
      colorInputs.forEach(input => {
        // Get or create the value display span
        const valueSpanId = input.id + 'Value';
        const colorBoxId = input.id + 'ColorBox';
        let valueSpan = document.getElementById(valueSpanId);
        let colorBox = document.getElementById(colorBoxId);
        
        if (!valueSpan || !colorBox) {
          // Check if parent is already a flex container div
          const parent = input.parentElement;
          const isParentDiv = parent.tagName === 'DIV' && (parent.style.display === 'flex' || getComputedStyle(parent).display === 'flex');
          
          if (isParentDiv) {
            // Already has wrapper div, just add color box and span
            if (!colorBox) {
              colorBox = document.createElement('div');
              colorBox.id = colorBoxId;
              colorBox.style.cssText = 'width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: ' + input.value + '; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);';
              parent.appendChild(colorBox);
            }
            if (!valueSpan) {
              valueSpan = document.createElement('span');
              valueSpan.id = valueSpanId;
              valueSpan.style.cssText = 'font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;';
              parent.appendChild(valueSpan);
            }
          } else if (parent.tagName === 'LABEL') {
            // Input is directly in label, create wrapper div
            const wrapper = document.createElement('div');
            wrapper.style.cssText = 'display: flex; gap: 8px; align-items: center;';
            
            // Move input to wrapper
            parent.insertBefore(wrapper, input);
            wrapper.appendChild(input);
            
            // Create color box
            colorBox = document.createElement('div');
            colorBox.id = colorBoxId;
            colorBox.style.cssText = 'width: 30px; height: 30px; border-radius: 4px; border: 2px solid #D1D5DB; background: ' + input.value + '; flex-shrink: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1);';
            wrapper.appendChild(colorBox);
            
            // Create value span
            valueSpan = document.createElement('span');
            valueSpan.id = valueSpanId;
            valueSpan.style.cssText = 'font-family: monospace; font-size: 12px; color: #6B7280; min-width: 70px;';
            wrapper.appendChild(valueSpan);
          }
        }
        
        // Update function
        const updateDisplay = () => {
          const currentValue = input.value.toUpperCase();
          if (valueSpan) {
            valueSpan.textContent = currentValue;
          }
          if (colorBox) {
            colorBox.style.background = input.value;
          }
        };
        
        // Set initial value
        updateDisplay();
        
        // Add event listener to update value when color changes
        input.addEventListener('input', updateDisplay);
      });
    }
    
    // Initialize color displays and language handler when DOM is ready
    function initializeUI() {
      setupColorDisplays();
      
      // Set up language change handler - only update widget, not page UI
      const langSelect = document.getElementById('languageSelect');
      if (langSelect) {
        // Update widget language when language changes (don't update page UI)
        langSelect.addEventListener('change', function(e) {
          const newLang = e.target.value;
          
          // Update widget language if it exists
          if (window.testWidget && window.testWidget.updateConfig) {
            const newDirection = (newLang === 'he' || newLang === 'ar') ? 'rtl' : 'ltr';
            window.testWidget.updateConfig({ 
              language: newLang,
              direction: newDirection
            });
            // Note: updateConfig already calls createWidget(), so no need to call it again
          }
        });
      }
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeUI);
    } else {
      initializeUI();
    }
    
    // Toggle section collapse
    function toggleSection(sectionId) {
      const content = document.getElementById(sectionId + '-content');
      const toggle = document.getElementById(sectionId + '-toggle');
      const isHidden = content.classList.contains('hidden');
      
      if (isHidden) {
        content.classList.remove('hidden');
        toggle.classList.remove('collapsed');
      } else {
        content.classList.add('hidden');
        toggle.classList.add('collapsed');
      }
    }
    
    // Status update function
    function updateStatus(message, type = '') {
      const statusEl = document.getElementById('status');
      statusEl.textContent = message;
      statusEl.className = 'status ' + (type || '');
    }

    // Initialize the widget
    let widget;
    
    function createWidget(config) {
      if (window.testWidget) {
        window.testWidget.destroy();
      }
      
      window.testWidget = new TTPAgentSDK.TextChatWidget(config);
      widget = window.testWidget;
      
      console.log('Widget initialized:', widget);
      updateStatus('Widget loaded and ready ‚úì', 'success');
      
      // Setup auto-apply after widget is created
      setTimeout(() => {
        setupAutoApply();
      }, 100);
    }
    
    function getConfigFromForm() {
      return {
        agentId: 'agent_87c4a55a1',
        appId: 'app_Bc01EqMQt2Euehl4qqZSi6l3FJP42Q9vJ0pC',
        direction: document.getElementById('dirSelect').value,
        language: document.getElementById('languageSelect').value,
        position: document.getElementById('posSelect').value,
        
        variables: {
          testMode: true,
          userName: 'Test User',
          page: 'test-text-chat.html',
          connectionType: 'text_chat'
        },
        
        primaryColor: document.getElementById('buttonBgColor').value || '#7C3AED',
        
        icon: {
          type: 'chat',
          size: document.getElementById('buttonSize').value
        },
        
        button: {
          size: document.getElementById('buttonSize').value,
          shape: document.getElementById('buttonShape').value,
          backgroundColor: document.getElementById('buttonBgColor').value,
          hoverColor: document.getElementById('buttonHoverColor').value
        },
        
        panel: {
          width: Number(document.getElementById('panelWidth').value) || 350,
          height: Number(document.getElementById('panelHeight').value) || 500,
          borderRadius: Number(document.getElementById('panelBorderRadius').value) || 12,
          backgroundColor: document.getElementById('panelBgColor').value
        },
        
        header: {
          title: document.getElementById('headerTitle').value,
          showTitle: document.getElementById('headerShowTitle').value === 'true',
          backgroundColor: document.getElementById('headerBgColor').value,
          textColor: document.getElementById('headerTextColor').value,
          showCloseButton: document.getElementById('headerShowClose').value === 'true'
        },
        
        tooltips: {
          newChat: document.getElementById('tooltipNewChat').value || null,
          back: document.getElementById('tooltipBack').value || null,
          close: document.getElementById('tooltipClose').value || null,
          mute: document.getElementById('tooltipMute').value || null,
          speaker: document.getElementById('tooltipSpeaker').value || null,
          endCall: document.getElementById('tooltipEndCall').value || null
        },
        
        messages: {
          fontSize: document.getElementById('msgFontSize').value,
          borderRadius: Number(document.getElementById('msgBorderRadius').value) || 8,
          textColor: document.getElementById('msgTextColor').value,
          userBackgroundColor: document.getElementById('userBgColor').value,
          agentBackgroundColor: document.getElementById('agentBgColor').value,
          systemBackgroundColor: document.getElementById('systemBgColor').value,
          errorBackgroundColor: document.getElementById('errorBgColor').value
        },
        
        animation: {
          enableHover: document.getElementById('animHover').value === 'true',
          enablePulse: document.getElementById('animPulse').value === 'true',
          enableSlide: document.getElementById('animSlide').value === 'true',
          duration: Number(document.getElementById('animDuration').value) || 0.3
        },
        
        behavior: {
          mode: document.getElementById('modeSelect').value,
          startOpen: document.getElementById('behaviorStartOpen').value === 'true',
          hidden: document.getElementById('behaviorHidden').value === 'true',
          showWelcomeMessage: document.getElementById('behaviorWelcome').value === 'true',
          welcomeMessage: document.getElementById('behaviorWelcomeMsg').value
        },
        
        voice: {
          avatarBackgroundColor: document.getElementById('voiceAvatarBg').value,
          avatarActiveBackgroundColor: document.getElementById('voiceAvatarActiveBg').value,
          statusTitleColor: document.getElementById('voiceStatusTitleColor').value,
          statusSubtitleColor: document.getElementById('voiceStatusSubtitleColor').value,
          startCallButtonColor: document.getElementById('voiceStartCallBtnColor').value,
          startCallButtonTextColor: document.getElementById('voiceStartCallBtnTextColor').value,
          transcriptBackgroundColor: document.getElementById('voiceTranscriptBg').value,
          transcriptTextColor: document.getElementById('voiceTranscriptTextColor').value,
          transcriptLabelColor: document.getElementById('voiceTranscriptLabelColor').value,
          controlButtonColor: document.getElementById('voiceControlBtnColor').value,
          controlButtonSecondaryColor: document.getElementById('voiceControlBtnSecondaryColor').value,
          endCallButtonColor: document.getElementById('voiceEndCallBtnColor').value,
          micButtonColor: document.getElementById('voiceMicBtnColor').value,
          micButtonActiveColor: document.getElementById('voiceMicBtnActiveColor').value,
          micButtonHint: {
            text: document.getElementById('voiceMicHintText').value,
            color: document.getElementById('voiceMicHintColor').value,
            fontSize: document.getElementById('voiceMicHintFontSize').value
          }
        },
        
        text: {
          sendButtonColor: document.getElementById('textSendBtnColor').value,
          sendButtonHoverColor: document.getElementById('textSendBtnHoverColor').value,
          sendButtonActiveColor: document.getElementById('textSendBtnActiveColor').value,
          sendButtonText: document.getElementById('textSendBtnText').value,
          sendButtonTextColor: document.getElementById('textSendBtnTextColor').value,
          sendButtonFontSize: document.getElementById('textSendBtnFontSize').value,
          sendButtonFontWeight: document.getElementById('textSendBtnFontWeight').value,
          sendButtonHint: {
            text: document.getElementById('textSendHintText').value,
            color: document.getElementById('textSendHintColor').value,
            fontSize: document.getElementById('textSendHintFontSize').value
          },
          inputPlaceholder: document.getElementById('textInputPlaceholder').value,
          inputBorderColor: document.getElementById('textInputBorderColor').value,
          inputFocusColor: document.getElementById('textInputFocusColor').value,
          inputBackgroundColor: document.getElementById('textInputBgColor').value,
          inputTextColor: document.getElementById('textInputTextColor').value,
          inputFontSize: document.getElementById('textInputFontSize').value,
          inputBorderRadius: Number(document.getElementById('textInputBorderRadius').value) || 20,
          inputPadding: document.getElementById('textInputPadding').value
        },
        
        landing: {
          backgroundColor: document.getElementById('landingBgColor').value,
          logo: document.getElementById('landingLogo').value,
          title: document.getElementById('landingTitle').value || null,
          titleColor: document.getElementById('landingTitleColor').value,
          modeCardBackgroundColor: document.getElementById('landingCardBg').value,
          modeCardBorderColor: document.getElementById('landingCardBorder').value,
          modeCardHoverBorderColor: document.getElementById('landingCardHoverBorder').value,
          modeCardIconBackgroundColor: document.getElementById('landingCardIconBg').value,
          modeCardTitleColor: document.getElementById('landingCardTitleColor').value,
          voiceCardIcon: document.getElementById('landingVoiceIcon').value,
          textCardIcon: document.getElementById('landingTextIcon').value
        }
      };
    }
    
    function applyChanges() {
      if (!widget) return;
      
      const config = getConfigFromForm();
      const currentMode = widget?.config?.behavior?.mode || 'unified';
      const newMode = config.behavior.mode;
      
      if (currentMode !== newMode) {
        // Mode changed - recreate widget
        createWidget(config);
        updateStatus(`Widget recreated with ${newMode} mode ‚úì`, 'success');
      } else {
        // Mode same - just update config
        widget.updateConfig(config);
        updateStatus('Customization applied ‚úì', 'success');
      }
    }
    
    // Track which elements already have event listeners to avoid duplicates
    const elementsWithListeners = new Set();
    
    // Auto-apply changes when user modifies any input
    function setupAutoApply() {
      if (!widget) return;
      
      // Get all input and select elements
      const allInputs = document.querySelectorAll('input, select, textarea');
      
      allInputs.forEach(element => {
        // Skip if it's the language select (handled separately)
        if (element.id === 'languageSelect') return;
        
        // Skip if already has listener
        if (elementsWithListeners.has(element)) return;
        
        // For text inputs - apply on every keystroke (input event) with debounce
        if (element.type === 'text' || element.tagName === 'TEXTAREA') {
          let timeout;
          element.addEventListener('input', function() {
            // Debounce for text inputs to avoid too many updates
            clearTimeout(timeout);
            timeout = setTimeout(() => {
              applyChanges();
            }, 300); // 300ms delay for text inputs
          });
          elementsWithListeners.add(element);
        } else {
          // For selects, color inputs, number inputs - apply immediately on change
          element.addEventListener('change', function() {
            applyChanges();
          });
          elementsWithListeners.add(element);
        }
      });
    }
    
    try {
      console.log('Initializing text chat widget...');
      console.log('TTPAgentSDK available:', typeof TTPAgentSDK);
      console.log('TTPAgentSDK.TextChatWidget available:', typeof TTPAgentSDK?.TextChatWidget);
      
      if (typeof TTPAgentSDK === 'undefined') {
        throw new Error('TTPAgentSDK is not defined. Check if the script loaded correctly.');
      }
      
      if (typeof TTPAgentSDK.TextChatWidget === 'undefined') {
        throw new Error('TTPAgentSDK.TextChatWidget is not defined. Check the SDK build.');
      }
      
      // Create initial widget
      createWidget(getConfigFromForm());
      
      // Set up event handlers
      document.getElementById('resetBtn').onclick = () => window.location.reload();
      
    } catch (error) {
      console.error('Failed to initialize widget:', error);
      updateStatus('Widget failed to load: ' + error.message, 'error');
    }
  </script>
</body>
</html>
