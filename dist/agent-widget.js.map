{"version":3,"file":"agent-widget.js","mappings":"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","sources":["webpack://VoiceAgentSDK/webpack/universalModuleDefinition","webpack://VoiceAgentSDK/webpack/bootstrap","webpack://VoiceAgentSDK/webpack/runtime/define property getters","webpack://VoiceAgentSDK/webpack/runtime/hasOwnProperty shorthand","webpack://VoiceAgentSDK/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"VoiceAgentSDK\"] = factory();\n\telse\n\t\troot[\"VoiceAgentSDK\"] = factory();\n})(this, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// ============================================\n// FILE: src/index.js\n// This is the main SDK file\n// ============================================\n\n// ============================================\n// CORE SDK - Handles WebSocket, Auth, Audio\n// ============================================\n\nclass AgentSDK {\n  constructor(config) {\n    this.config = config;\n    this.ws = null;\n    this.isConnected = false;\n    this.isListening = false;\n    this.mediaRecorder = null;\n    this.audioContext = null;\n    this.audioQueue = [];\n    this.isPlaying = false;\n    \n    this.onConnected = () => {};\n    this.onDisconnected = () => {};\n    this.onError = (error) => console.error('SDK Error:', error);\n    this.onTranscript = (text) => {};\n    this.onAgentSpeaking = (isStart) => {};\n  }\n\n  async connect(signedUrl) {\n    try {\n      if (!signedUrl) {\n        throw new Error('signedUrl is required');\n      }\n      \n      this.ws = new WebSocket(signedUrl);\n      \n      this.ws.onopen = () => {\n        console.log('WebSocket connected');\n      };\n\n      this.ws.onmessage = (event) => {\n      \ttry {\n      \t    const message = JSON.parse(event.data);\n      \t    this.handleWebSocketMessage(message);\n        } catch (error) {\n        // For testing: echo server returns plain text\n      \tconsole.log('Received non-JSON message (testing mode):', event.data);\n        }\n      };\n\n      this.ws.onerror = (error) => {\n        this.onError(error);\n      };\n\n      this.ws.onclose = () => {\n        this.isConnected = false;\n        this.onDisconnected();\n      };\n\n      await this.waitForConnection();\n      this.isConnected = true;\n      this.onConnected();\n      \n    } catch (error) {\n      this.onError(error);\n      throw error;\n    }\n  }\n\n  waitForConnection() {\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        reject(new Error('Connection timeout'));\n      }, 10000);\n\n      const checkConnection = () => {\n        if (this.ws.readyState === WebSocket.OPEN) {\n          clearTimeout(timeout);\n          resolve();\n        }\n      };\n\n      this.ws.addEventListener('open', checkConnection);\n    });\n  }\n\n  handleWebSocketMessage(message) {\n    switch (message.type) {\n      case 'connected':\n        console.log('Session started successfully');\n        break;\n        \n      case 'transcript':\n        this.onTranscript(message.text);\n        break;\n        \n      case 'agent_audio':\n        this.playAudio(message.audio);\n        break;\n        \n      case 'agent_speaking_start':\n        this.onAgentSpeaking(true);\n        break;\n        \n      case 'agent_speaking_end':\n        this.onAgentSpeaking(false);\n        break;\n        \n      case 'error':\n        this.onError(new Error(message.message));\n        break;\n    }\n  }\n\n  async startListening() {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      \n      this.mediaRecorder = new MediaRecorder(stream, {\n        mimeType: 'audio/webm;codecs=opus'\n      });\n\n      this.mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0 && this.ws.readyState === WebSocket.OPEN) {\n          this.sendAudioChunk(event.data);\n        }\n      };\n\n      this.mediaRecorder.start(100);\n      this.isListening = true;\n      \n    } catch (error) {\n      this.onError(new Error('Microphone access denied'));\n      throw error;\n    }\n  }\n\n  async sendAudioChunk(blob) {\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      const base64Audio = reader.result.split(',')[1];\n      this.ws.send(JSON.stringify({\n        type: 'audio',\n        audio: base64Audio\n      }));\n    };\n    reader.readAsDataURL(blob);\n  }\n\n  stopListening() {\n    if (this.mediaRecorder && this.isListening) {\n      this.mediaRecorder.stop();\n      this.mediaRecorder.stream.getTracks().forEach(track => track.stop());\n      this.isListening = false;\n    }\n  }\n\n  async playAudio(base64Audio) {\n    if (!this.audioContext) {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n    }\n\n    const audioData = atob(base64Audio);\n    const arrayBuffer = new ArrayBuffer(audioData.length);\n    const view = new Uint8Array(arrayBuffer);\n    for (let i = 0; i < audioData.length; i++) {\n      view[i] = audioData.charCodeAt(i);\n    }\n\n    try {\n      const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n      this.audioQueue.push(audioBuffer);\n      \n      if (!this.isPlaying) {\n        this.playNextInQueue();\n      }\n    } catch (error) {\n      console.error('Error decoding audio:', error);\n    }\n  }\n\n  playNextInQueue() {\n    if (this.audioQueue.length === 0) {\n      this.isPlaying = false;\n      return;\n    }\n\n    this.isPlaying = true;\n    const audioBuffer = this.audioQueue.shift();\n    const source = this.audioContext.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(this.audioContext.destination);\n    \n    source.onended = () => {\n      this.playNextInQueue();\n    };\n    \n    source.start(0);\n  }\n\n  updateVariables(variables) {\n    if (this.ws && this.isConnected) {\n      this.ws.send(JSON.stringify({\n        type: 'update_variables',\n        variables\n      }));\n    }\n  }\n\n  disconnect() {\n    this.stopListening();\n    if (this.ws) {\n      this.ws.close();\n    }\n    if (this.audioContext) {\n      this.audioContext.close();\n    }\n  }\n}\n\n\n// ============================================\n// WIDGET - Pre-built UI using the SDK\n// ============================================\n\nclass AgentWidget {\n  constructor(config) {\n    this.config = config;\n    this.sdk = new AgentSDK();\n    this.isOpen = false;\n    this.isActive = false;\n    \n    this.position = config.position || 'bottom-right';\n    this.primaryColor = config.primaryColor || '#4F46E5';\n    \n    this.setupEventHandlers();\n    this.createWidget();\n  }\n\n  setupEventHandlers() {\n    this.sdk.onConnected = () => {\n      this.updateStatus('connected');\n    };\n\n    this.sdk.onDisconnected = () => {\n      this.updateStatus('disconnected');\n      this.isActive = false;\n    };\n\n    this.sdk.onError = (error) => {\n      this.showError(error.message);\n    };\n\n    this.sdk.onTranscript = (text) => {\n      this.addMessage('user', text);\n    };\n\n    this.sdk.onAgentSpeaking = (isStart) => {\n      if (isStart) {\n        this.showAgentThinking();\n      } else {\n        this.hideAgentThinking();\n      }\n    };\n  }\n\n  createWidget() {\n    const widget = document.createElement('div');\n    widget.id = 'agent-widget';\n    widget.innerHTML = `\n      <style>\n        #agent-widget {\n          position: fixed;\n          ${this.position.includes('bottom') ? 'bottom: 20px;' : 'top: 20px;'}\n          ${this.position.includes('right') ? 'right: 20px;' : 'left: 20px;'}\n          z-index: 9999;\n          font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n        }\n        \n        #agent-button {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          background: ${this.primaryColor};\n          border: none;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: transform 0.2s;\n        }\n        \n        #agent-button:hover {\n          transform: scale(1.1);\n        }\n        \n        #agent-button svg {\n          width: 28px;\n          height: 28px;\n          fill: white;\n        }\n        \n        #agent-panel {\n          display: none;\n          position: absolute;\n          bottom: 80px;\n          ${this.position.includes('right') ? 'right: 0;' : 'left: 0;'}\n          width: 350px;\n          height: 500px;\n          background: white;\n          border-radius: 12px;\n          box-shadow: 0 8px 32px rgba(0,0,0,0.2);\n          flex-direction: column;\n          overflow: hidden;\n        }\n        \n        #agent-panel.open {\n          display: flex;\n        }\n        \n        #agent-header {\n          background: ${this.primaryColor};\n          color: white;\n          padding: 16px;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n        \n        #agent-close {\n          background: none;\n          border: none;\n          color: white;\n          cursor: pointer;\n          font-size: 24px;\n        }\n        \n        #agent-messages {\n          flex: 1;\n          overflow-y: auto;\n          padding: 16px;\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n        }\n        \n        .message {\n          padding: 12px;\n          border-radius: 8px;\n          max-width: 80%;\n        }\n        \n        .message.user {\n          background: #E5E7EB;\n          align-self: flex-end;\n        }\n        \n        .message.agent {\n          background: #F3F4F6;\n          align-self: flex-start;\n        }\n        \n        #agent-controls {\n          padding: 16px;\n          border-top: 1px solid #E5E7EB;\n          display: flex;\n          justify-content: center;\n        }\n        \n        #agent-mic-button {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          border: none;\n          background: ${this.primaryColor};\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: all 0.2s;\n        }\n        \n        #agent-mic-button.active {\n          background: #EF4444;\n          animation: pulse 1.5s infinite;\n        }\n        \n        #agent-mic-button svg {\n          width: 28px;\n          height: 28px;\n          fill: white;\n        }\n        \n        @keyframes pulse {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(1.05); }\n        }\n        \n        .agent-thinking {\n          font-style: italic;\n          color: #6B7280;\n        }\n        \n        .error-message {\n          background: #FEE2E2;\n          color: #991B1B;\n          padding: 12px;\n          border-radius: 8px;\n          margin: 8px;\n        }\n      </style>\n      \n      <button id=\"agent-button\">\n        <svg viewBox=\"0 0 24 24\">\n          <path d=\"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z\"/>\n          <path d=\"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z\"/>\n        </svg>\n      </button>\n      \n      <div id=\"agent-panel\">\n        <div id=\"agent-header\">\n          <h3 style=\"margin: 0;\">Voice Assistant</h3>\n          <button id=\"agent-close\">&times;</button>\n        </div>\n        \n        <div id=\"agent-messages\"></div>\n        \n        <div id=\"agent-controls\">\n          <button id=\"agent-mic-button\">\n            <svg viewBox=\"0 0 24 24\">\n              <path d=\"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z\"/>\n              <path d=\"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z\"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n    `;\n    \n    document.body.appendChild(widget);\n    \n    document.getElementById('agent-button').onclick = () => this.togglePanel();\n    document.getElementById('agent-close').onclick = () => this.togglePanel();\n    document.getElementById('agent-mic-button').onclick = () => this.toggleVoice();\n  }\n\n  togglePanel() {\n    this.isOpen = !this.isOpen;\n    const panel = document.getElementById('agent-panel');\n    panel.classList.toggle('open');\n  }\n\n  async toggleVoice() {\n    if (!this.isActive) {\n      try {\n        const signedUrl = await this.getSignedUrl();\n        await this.sdk.connect(signedUrl);\n        await this.sdk.startListening();\n        this.isActive = true;\n        document.getElementById('agent-mic-button').classList.add('active');\n        this.addMessage('system', 'Listening...');\n      } catch (error) {\n        console.error('Failed to start:', error);\n        this.showError(error.message);\n      }\n    } else {\n      this.sdk.stopListening();\n      this.sdk.disconnect();\n      this.isActive = false;\n      document.getElementById('agent-mic-button').classList.remove('active');\n    }\n  }\n\n  async getSignedUrl() {\n    if (typeof this.config.getSessionUrl === 'string') {\n      const response = await fetch(this.config.getSessionUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          agentId: this.config.agentId,\n          variables: this.config.variables || {}\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to get session URL: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      return data.signedUrl || data.wsUrl || data.url;\n    }\n    else if (typeof this.config.getSessionUrl === 'function') {\n      const result = await this.config.getSessionUrl({\n        agentId: this.config.agentId,\n        variables: this.config.variables || {}\n      });\n      \n      return typeof result === 'string' ? result : (result.signedUrl || result.wsUrl || result.url);\n    }\n    else {\n      throw new Error('getSessionUrl is required (URL string or function)');\n    }\n  }\n\n  addMessage(type, text) {\n    const messages = document.getElementById('agent-messages');\n    const message = document.createElement('div');\n    message.className = `message ${type}`;\n    message.textContent = text;\n    messages.appendChild(message);\n    messages.scrollTop = messages.scrollHeight;\n  }\n\n  showAgentThinking() {\n    const messages = document.getElementById('agent-messages');\n    const thinking = document.createElement('div');\n    thinking.className = 'message agent agent-thinking';\n    thinking.id = 'thinking-indicator';\n    thinking.textContent = 'Agent is speaking...';\n    messages.appendChild(thinking);\n    messages.scrollTop = messages.scrollHeight;\n  }\n\n  hideAgentThinking() {\n    const thinking = document.getElementById('thinking-indicator');\n    if (thinking) thinking.remove();\n  }\n\n  showError(message) {\n    const messages = document.getElementById('agent-messages');\n    const error = document.createElement('div');\n    error.className = 'error-message';\n    error.textContent = message;\n    messages.appendChild(error);\n  }\n\n  updateStatus(status) {\n    console.log('Widget status:', status);\n  }\n}\n\n\n// ============================================\n// GLOBAL API\n// ============================================\n\n// Expose to window for script tag usage\nif (typeof window !== 'undefined') {\n  window.AgentWidget = {\n    init: (config) => {\n      if (!config.agentId) {\n        throw new Error('agentId is required');\n      }\n      if (!config.getSessionUrl) {\n        throw new Error('getSessionUrl is required');\n      }\n      return new AgentWidget(config);\n    }\n  };\n  \n  window.AgentSDK = AgentSDK;\n}\n\n// Also export for npm usage\nexport { AgentSDK, AgentWidget };\nexport default { AgentSDK, AgentWidget };\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","AgentSDK","constructor","config","ws","isConnected","isListening","mediaRecorder","audioContext","audioQueue","isPlaying","onConnected","onDisconnected","onError","error","console","onTranscript","text","onAgentSpeaking","isStart","connect","signedUrl","Error","WebSocket","onopen","log","onmessage","event","message","JSON","parse","data","handleWebSocketMessage","onerror","onclose","waitForConnection","Promise","resolve","reject","timeout","setTimeout","addEventListener","readyState","OPEN","clearTimeout","type","playAudio","audio","startListening","stream","navigator","mediaDevices","getUserMedia","MediaRecorder","mimeType","ondataavailable","size","sendAudioChunk","start","blob","reader","FileReader","onloadend","base64Audio","result","split","send","stringify","readAsDataURL","stopListening","stop","getTracks","forEach","track","window","AudioContext","webkitAudioContext","audioData","atob","arrayBuffer","ArrayBuffer","length","view","Uint8Array","i","charCodeAt","audioBuffer","decodeAudioData","push","playNextInQueue","shift","source","createBufferSource","buffer","destination","onended","updateVariables","variables","disconnect","close","AgentWidget","sdk","isOpen","isActive","position","primaryColor","setupEventHandlers","createWidget","updateStatus","showError","addMessage","showAgentThinking","hideAgentThinking","widget","document","createElement","id","innerHTML","includes","body","appendChild","getElementById","onclick","togglePanel","toggleVoice","classList","toggle","remove","getSignedUrl","add","getSessionUrl","response","fetch","method","headers","agentId","ok","statusText","json","wsUrl","url","messages","className","textContent","scrollTop","scrollHeight","thinking","status","init"],"sourceRoot":""}