/*! For license information please see agent-widget.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TTPAgentSDK=e():t.TTPAgentSDK=e()}(window,()=>(()=>{"use strict";var t={540:(t,e,n)=>{t.exports=n(869)},698:(t,e)=>{var n=Symbol.for("react.transitional.element");function o(t,e,o){var i=null;if(void 0!==o&&(i=""+o),void 0!==e.key&&(i=""+e.key),"key"in e)for(var r in o={},e)"key"!==r&&(o[r]=e[r]);else o=e;return e=o.ref,{$$typeof:n,type:t,key:i,ref:void 0!==e?e:null,props:o}}Symbol.for("react.fragment"),e.jsx=o,e.jsxs=o},848:(t,e,n)=>{t.exports=n(698)},869:(t,e)=>{Symbol.for("react.transitional.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.consumer"),Symbol.for("react.context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.activity"),Symbol.iterator;var n={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},o=Object.assign,i={};function r(t,e,o){this.props=t,this.context=e,this.refs=i,this.updater=o||n}function a(){}function c(t,e,o){this.props=t,this.context=e,this.refs=i,this.updater=o||n}r.prototype.isReactComponent={},r.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},r.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},a.prototype=r.prototype;var s=c.prototype=new a;s.constructor=c,o(s,r.prototype),s.isPureReactComponent=!0;Array.isArray;var l={H:null,A:null,T:null,S:null};Object.prototype.hasOwnProperty;"function"==typeof reportError&&reportError;e.useEffect=function(t,e){return l.H.useEffect(t,e)},e.useRef=function(t){return l.H.useRef(t)},e.useState=function(t){return l.H.useState(t)}}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,a(o.key),o)}}function a(t){var e=function(t){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}n.r(o),n.d(o,{AgentSDK:()=>ne,AudioPlayer:()=>Z,AudioRecorder:()=>N,EventEmitter:()=>c,TTPChatWidget:()=>Pe,TextChatSDK:()=>Et,VERSION:()=>Be,VanillaVoiceButton:()=>qt,VoiceButton:()=>zt,VoiceSDK:()=>ft,WebSocketManager:()=>B,default:()=>Fe});var c=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.events={}},e=[{key:"on",value:function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}},{key:"off",value:function(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(function(t){return t!==e}))}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.events[t]&&this.events[t].forEach(function(e){try{e.apply(void 0,n)}catch(e){console.error("Error in event listener for ".concat(t,":"),e)}})}},{key:"removeAllListeners",value:function(t){t?delete this.events[t]:this.events={}}}],e&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,i,r,a,c=[],s=!0,l=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=r.call(n)).done)&&(c.push(o.value),c.length!==e);s=!0);}catch(t){l=!0,i=t}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return c}}(t,e)||d(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=d(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw r}}}}function d(t,e){if(t){if("string"==typeof t)return p(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function f(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return v(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(v(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,v(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,v(d,"constructor",l),v(l,"constructor",s),s.displayName="GeneratorFunction",v(l,i,"GeneratorFunction"),v(d),v(d,i,"Generator"),v(d,o,function(){return this}),v(d,"toString",function(){return"[object Generator]"}),(f=function(){return{w:r,m:p}})()}function v(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}v=function(t,e,n,o){function r(e,n){v(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},v(t,e,n,o)}function h(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function g(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,y(o.key),o)}}function y(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}function m(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(m=function(){return!!t})()}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}const w=new(function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=function(t,e,n){return e=b(e),function(t,e){if(e&&("object"==s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,m()?Reflect.construct(e,n||[],b(t).constructor):e.apply(t,n))}(this,e)).connections=new Map,t.connectionCounts=new Map,t.creatingConnections=new Set,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}(e,t),n=e,o=[{key:"getConnection",value:(i=f().m(function t(e){var n,o,i=this;return f().w(function(t){for(;;)switch(t.n){case 0:if(!this.connections.has(e)){t.n=1;break}return n=this.connections.get(e),this.connectionCounts.set(e,(this.connectionCounts.get(e)||0)+1),t.a(2,n);case 1:if(!this.creatingConnections||!this.creatingConnections.has(e)){t.n=2;break}return t.a(2,new Promise(function(t){var n=function(){if(i.connections.has(e)){var o=i.connections.get(e);i.connectionCounts.set(e,(i.connectionCounts.get(e)||0)+1),t(o)}else setTimeout(n,50)};n()}));case 2:return this.creatingConnections.add(e),o=new WebSocket(e),this.connections.set(e,o),this.connectionCounts.set(e,1),o.addEventListener("open",function(t){i.creatingConnections.delete(e),i.emit("open",t,e)}),o.addEventListener("close",function(t){i.creatingConnections.delete(e),i.connections.delete(e),i.connectionCounts.delete(e),i.emit("close",t,e)}),o.addEventListener("error",function(t){i.creatingConnections.delete(e),i.emit("error",t,e)}),o.addEventListener("message",function(t){i.emit("message",t,e)}),t.a(2,o)}},t,this)}),r=function(){var t=this,e=arguments;return new Promise(function(n,o){var r=i.apply(t,e);function a(t){h(r,n,o,a,c,"next",t)}function c(t){h(r,n,o,a,c,"throw",t)}a(void 0)})},function(t){return r.apply(this,arguments)})},{key:"releaseConnection",value:function(t){if(this.connections.has(t)){var e=this.connectionCounts.get(t)||0,n=Math.max(0,e-1);if(this.connectionCounts.set(t,n),0===n){var o=this.connections.get(t);o&&o.readyState===WebSocket.OPEN&&o.close(1e3,"No more subscribers"),this.connections.delete(t),this.connectionCounts.delete(t)}}}},{key:"forceClose",value:function(t){if(this.connections.has(t)){var e=this.connections.get(t);e&&e.readyState===WebSocket.OPEN&&e.close(1e3,"Force close"),this.connections.delete(t),this.connectionCounts.delete(t)}}},{key:"getConnectionStatus",value:function(t){return this.connections.has(t)?{exists:!0,readyState:this.connections.get(t).readyState,subscribers:this.connectionCounts.get(t)||0}:{exists:!1,readyState:null,subscribers:0}}},{key:"getAllConnections",value:function(){var t,e={},n=u(this.connections.entries());try{for(n.s();!(t=n.n()).done;){var o=l(t.value,2),i=o[0],r=o[1];e[i]={readyState:r.readyState,subscribers:this.connectionCounts.get(i)||0}}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"clearAll",value:function(){var t,e=u(this.connections.entries());try{for(e.s();!(t=e.n()).done;){var n=l(t.value,2),o=(n[0],n[1]);o&&o.readyState===WebSocket.OPEN&&o.close(1e3,"Clear all")}}catch(t){e.e(t)}finally{e.f()}this.connections.clear(),this.connectionCounts.clear(),this.creatingConnections.clear()}}],o&&g(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i,r}(c));function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function k(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return C(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(C(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,C(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,C(d,"constructor",l),C(l,"constructor",s),s.displayName="GeneratorFunction",C(l,i,"GeneratorFunction"),C(d),C(d,i,"Generator"),C(d,o,function(){return this}),C(d,"toString",function(){return"[object Generator]"}),(k=function(){return{w:r,m:p}})()}function C(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}C=function(t,e,n,o){function r(e,n){C(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},C(t,e,n,o)}function I(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function E(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,O(o.key),o)}}function O(t){var e=function(t){if("object"!=S(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==S(e)?e:e+""}function j(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(j=function(){return!!t})()}function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}function P(t,e){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},P(t,e)}var B=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e,n){return e=T(e),function(t,e){if(e&&("object"==S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,j()?Reflect.construct(e,n||[],T(t).constructor):e.apply(t,n))}(this,e)).config=t,n.ws=null,n.isConnected=!1,n.connectionId=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&P(t,e)}(e,t),n=e,o=[{key:"connect",value:(r=k().m(function t(){var e=this;return k().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,n){try{e.connectionId=Date.now()+"_"+Math.random().toString(36).substr(2,9),e.connectResolve=t,e.connectReject=n,w.getConnection(e.config.websocketUrl,e.config).then(function(n){e.ws=n,e.setupEventListeners(),n.readyState===WebSocket.OPEN&&(e.isConnected=!0,e.emit("connected"),t(),e.connectResolve=null,e.connectReject=null)}).catch(function(t){console.error("ðŸ”Œ WebSocketManager: Connection failed ".concat(e.connectionId),t),n(t),e.connectResolve=null,e.connectReject=null})}catch(t){console.error("ðŸ”Œ WebSocketManager: Connection error ".concat(e.connectionId),t),n(t),e.connectResolve=null,e.connectReject=null}}))},t)}),a=function(){var t=this,e=arguments;return new Promise(function(n,o){var i=r.apply(t,e);function a(t){I(i,n,o,a,c,"next",t)}function c(t){I(i,n,o,a,c,"throw",t)}a(void 0)})},function(){return a.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var t=this;if(this.ws){var e=function(e,n){n===t.config.websocketUrl&&(t.isConnected=!0,t.emit("connected"),t.connectResolve&&(t.connectResolve(),t.connectResolve=null,t.connectReject=null))},n=function(e,n){n===t.config.websocketUrl&&(t.isConnected=!1,t.emit("disconnected",e))},o=function(e,n){n===t.config.websocketUrl&&(t.emit("error",e),t.connectReject&&(t.connectReject(e),t.connectResolve=null,t.connectReject=null))},i=function(e,n){n===t.config.websocketUrl&&t.handleMessage(e)};w.on("open",e),w.on("close",n),w.on("error",o),w.on("message",i),this.eventHandlers={open:e,close:n,error:o,message:i}}}},{key:"disconnect",value:function(){this.eventHandlers&&(w.off("open",this.eventHandlers.open),w.off("close",this.eventHandlers.close),w.off("error",this.eventHandlers.error),w.off("message",this.eventHandlers.message)),this.config.websocketUrl&&w.releaseConnection(this.config.websocketUrl),this.ws=null,this.isConnected=!1}},{key:"sendMessage",value:function(t){if(this.isConnected&&this.ws)try{this.ws.send(JSON.stringify(t))}catch(t){console.warn("ðŸ”Œ WebSocketManager: Failed to send message:",t.message)}}},{key:"sendBinary",value:function(t){if(this.isConnected&&this.ws)try{this.ws.send(t)}catch(t){console.warn("ðŸ”Œ WebSocketManager: Failed to send binary data:",t.message)}}},{key:"handleMessage",value:function(t){var e=this;if(t.data instanceof ArrayBuffer)this.emit("binaryAudio",t.data);else if(t.data instanceof Blob)t.data.arrayBuffer().then(function(t){e.emit("binaryAudio",t)}).catch(function(t){console.error("ðŸ”Œ WebSocketManager: Error converting Blob to ArrayBuffer:",t)});else try{var n=JSON.parse(t.data);"barge_in_ack"!==n.t&&"stop_sending"!==n.t||this.emit("bargeIn",n),"stop_playing"===n.t&&this.emit("stopPlaying",n),this.emit("message",n)}catch(t){this.emit("error",t)}}},{key:"getStatus",value:function(){return{isConnected:this.isConnected,readyState:this.ws?this.ws.readyState:null,connectionId:this.connectionId}}}],i=[{key:"getSingletonStatus",value:function(){return w.getAllConnections()}},{key:"clearAllConnections",value:function(){w.clearAll()}}],o&&E(n.prototype,o),i&&E(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i,r,a}(c);function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function _(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return D(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(D(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,D(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,D(d,"constructor",l),D(l,"constructor",s),s.displayName="GeneratorFunction",D(l,i,"GeneratorFunction"),D(d),D(d,i,"Generator"),D(d,o,function(){return this}),D(d,"toString",function(){return"[object Generator]"}),(_=function(){return{w:r,m:p}})()}function D(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}D=function(t,e,n,o){function r(e,n){D(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},D(t,e,n,o)}function R(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function A(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){R(r,o,i,a,c,"next",t)}function c(t){R(r,o,i,a,c,"throw",t)}a(void 0)})}}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function z(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,L(o.key),o)}}function L(t){var e=function(t){if("object"!=F(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==F(e)?e:e+""}function H(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(H=function(){return!!t})()}function V(t){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},V(t)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},U(t,e)}var N=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e,n){return e=V(e),function(t,e){if(e&&("object"==F(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,H()?Reflect.construct(e,n||[],V(t).constructor):e.apply(t,n))}(this,e)).config=t,n.audioContext=null,n.audioWorkletNode=null,n.mediaStream=null,n.isRecording=!1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}(e,t),n=e,o=[{key:"getAudioProcessorPath",value:function(){if(this.config.audioProcessorPath)return this.config.audioProcessorPath;var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return M(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw r}}}}(document.getElementsByTagName("script"));try{for(e.s();!(t=e.n()).done;){var n=t.value.src;if(n&&(n.includes("agent-widget.js")||n.includes("ttp-agent-sdk")))try{new URL(n);var o=n.substring(0,n.lastIndexOf("/"));return"".concat(o,"/audio-processor.js")}catch(t){var i=n.substring(0,n.lastIndexOf("/"));return"".concat(i,"/audio-processor.js")}}}catch(t){e.e(t)}finally{e.f()}return"https://cdn.talktopc.com/audio-processor.js"}},{key:"start",value:(r=A(_().m(function t(){var e,n,o=this;return _().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,navigator.mediaDevices.getUserMedia({audio:{sampleRate:this.config.sampleRate,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});case 1:if(this.mediaStream=t.v,this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:this.config.sampleRate}),"suspended"!==this.audioContext.state){t.n=2;break}return t.n=2,this.audioContext.resume();case 2:return e=this.getAudioProcessorPath(),t.n=3,this.audioContext.audioWorklet.addModule(e);case 3:this.audioWorkletNode=new AudioWorkletNode(this.audioContext,"audio-processor"),this.audioContext.createMediaStreamSource(this.mediaStream).connect(this.audioWorkletNode),this.audioWorkletNode.port.onmessage=function(t){var e=t.data,n=e.type,i=e.data;"pcm_audio_data"===n&&o.emit("audioData",i)},this.audioWorkletNode.port.postMessage({type:"setForceContinuous",data:{enabled:!0}}),this.isRecording=!0,this.emit("recordingStarted"),t.n=5;break;case 4:throw t.p=4,n=t.v,this.emit("error",n),n;case 5:return t.a(2)}},t,this,[[0,4]])})),function(){return r.apply(this,arguments)})},{key:"stop",value:(i=A(_().m(function t(){var e;return _().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.isRecording){t.n=1;break}return t.a(2);case 1:if(t.p=1,!this.audioWorkletNode){t.n=2;break}return this.audioWorkletNode.port.postMessage({type:"flush"}),t.n=2,new Promise(function(t){return setTimeout(t,100)});case 2:if(this.mediaStream&&(this.mediaStream.getTracks().forEach(function(t){return t.stop()}),this.mediaStream=null),!this.audioContext||"closed"===this.audioContext.state){t.n=4;break}return t.n=3,this.audioContext.close();case 3:this.audioContext=null;case 4:this.audioWorkletNode=null,this.isRecording=!1,this.emit("recordingStopped"),t.n=6;break;case 5:throw t.p=5,e=t.v,this.emit("error",e),e;case 6:return t.a(2)}},t,this,[[1,5]])})),function(){return i.apply(this,arguments)})},{key:"getStatus",value:function(){return{isRecording:this.isRecording,audioContextState:this.audioContext?this.audioContext.state:"closed"}}},{key:"destroy",value:function(){this.stop()}}],o&&z(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i,r}(c);function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function W(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return G(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(G(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,G(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,G(d,"constructor",l),G(l,"constructor",s),s.displayName="GeneratorFunction",G(l,i,"GeneratorFunction"),G(d),G(d,i,"Generator"),G(d,o,function(){return this}),G(d,"toString",function(){return"[object Generator]"}),(W=function(){return{w:r,m:p}})()}function G(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}G=function(t,e,n,o){function r(e,n){G(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},G(t,e,n,o)}function Q(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function q(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Y(o.key),o)}}function Y(t){var e=function(t){if("object"!=K(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==K(e)?e:e+""}function J(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(J=function(){return!!t})()}function $(t){return $=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$(t)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},X(t,e)}var Z=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e,n){return e=$(e),function(t,e){if(e&&("object"==K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,J()?Reflect.construct(e,n||[],$(t).constructor):e.apply(t,n))}(this,e)).config=t,n.audioContext=null,n.audioQueue=[],n.isPlaying=!1,n.isProcessingQueue=!1,n.currentSource=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}(e,t),n=e,o=[{key:"playAudio",value:function(t){var e=this;try{var n=this.createAudioBlob(t);this.audioQueue.push(n),this.isPlaying||this.isProcessingQueue||this.currentSource||setTimeout(function(){return e.processQueue()},50)}catch(t){this.emit("playbackError",t)}}},{key:"createAudioBlob",value:function(t){var e=new Uint8Array(t);if(e.length>=4){if(82===e[0]&&73===e[1]&&70===e[2]&&70===e[3])return new Blob([t],{type:"audio/wav"});if(255===e[0]&&!(224&~e[1]))return new Blob([t],{type:"audio/mpeg"});if(79===e[0]&&103===e[1]&&103===e[2]&&83===e[3])return new Blob([t],{type:"audio/ogg"})}return new Blob([t],{type:"audio/wav"})}},{key:"processQueue",value:(i=W().m(function t(){var e,n,o,i,r,a,c,s,l=this;return W().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isProcessingQueue&&0!==this.audioQueue.length){t.n=1;break}return t.a(2);case 1:if(this.isProcessingQueue=!0,e=this.audioQueue.shift()){t.n=2;break}return this.isProcessingQueue=!1,t.a(2);case 2:if(t.p=2,n=!this.isPlaying&&null===this.currentSource,this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),"suspended"!==(o=this.audioContext).state){t.n=3;break}return t.n=3,o.resume();case 3:return t.n=4,e.arrayBuffer();case 4:return i=t.v,t.n=5,o.decodeAudioData(i);case 5:r=t.v,a=n&&!this.isPlaying&&null===this.currentSource,(c=o.createBufferSource()).buffer=r,c.connect(o.destination),this.currentSource=c,this.isPlaying=!0,a&&this.emit("playbackStarted"),c.onended=function(){l.currentSource=null,l.isProcessingQueue=!1,l.audioQueue.length>0?setTimeout(function(){return l.processQueue()},50):setTimeout(function(){0!==l.audioQueue.length||l.currentSource||(l.isPlaying=!1,l.emit("playbackStopped"))},100)},c.start(),t.n=7;break;case 6:t.p=6,s=t.v,this.currentSource=null,this.emit("playbackError",s),this.audioQueue.length>0?(this.isProcessingQueue=!1,setTimeout(function(){return l.processQueue()},100)):(this.isPlaying=!1,this.isProcessingQueue=!1,this.emit("playbackStopped"));case 7:return t.a(2)}},t,this,[[2,6]])}),r=function(){var t=this,e=arguments;return new Promise(function(n,o){var r=i.apply(t,e);function a(t){Q(r,n,o,a,c,"next",t)}function c(t){Q(r,n,o,a,c,"throw",t)}a(void 0)})},function(){return r.apply(this,arguments)})},{key:"stop",value:function(){this.stopImmediate()}},{key:"stopImmediate",value:function(){var t=this.isPlaying||null!==this.currentSource;if(this.currentSource){try{this.currentSource.stop()}catch(t){}this.currentSource=null}this.isPlaying=!1,this.isProcessingQueue=!1,this.audioQueue=[],t&&this.emit("playbackStopped")}},{key:"getStatus",value:function(){return{isPlaying:this.isPlaying,isProcessingQueue:this.isProcessingQueue,queueLength:this.audioQueue.length,audioContextState:this.audioContext?this.audioContext.state:"closed"}}},{key:"destroy",value:function(){this.stop(),this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null)}}],o&&q(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i,r}(c);function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return nt(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(nt(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,nt(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,nt(d,"constructor",l),nt(l,"constructor",s),s.displayName="GeneratorFunction",nt(l,i,"GeneratorFunction"),nt(d),nt(d,i,"Generator"),nt(d,o,function(){return this}),nt(d,"toString",function(){return"[object Generator]"}),(et=function(){return{w:r,m:p}})()}function nt(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}nt=function(t,e,n,o){function r(e,n){nt(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},nt(t,e,n,o)}function ot(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function it(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){ot(r,o,i,a,c,"next",t)}function c(t){ot(r,o,i,a,c,"throw",t)}a(void 0)})}}function rt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rt(Object(n),!0).forEach(function(e){ct(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ct(t,e,n){return(e=lt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function st(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,lt(o.key),o)}}function lt(t){var e=function(t){if("object"!=tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tt(e)?e:e+""}function ut(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ut=function(){return!!t})()}function dt(t){return dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dt(t)}function pt(t,e){return pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},pt(t,e)}var ft=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=function(t,e,n){return e=dt(e),function(t,e){if(e&&("object"==tt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ut()?Reflect.construct(e,n||[],dt(t).constructor):e.apply(t,n))}(this,e)).config=at({websocketUrl:n.websocketUrl||"wss://speech.talktopc.com/ws/conv",agentId:n.agentId,appId:n.appId,ttpId:n.ttpId,voice:n.voice||"default",language:n.language||"en",sampleRate:n.sampleRate||16e3},n),t.isConnected=!1,t.isRecording=!1,t.isPlaying=!1,t.isDestroyed=!1,t.webSocketManager=new B(at(at({},t.config),{},{autoReconnect:!1!==t.config.autoReconnect})),t.audioRecorder=new N(t.config),t.audioPlayer=new Z(t.config),t.setupEventHandlers(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pt(t,e)}(e,t),n=e,o=[{key:"setupEventHandlers",value:function(){var t=this;this.webSocketManager.on("connected",function(){t.isConnected=!0,t.sendHelloMessage(),t.emit("connected")}),this.webSocketManager.on("disconnected",function(e){if(t.isConnected=!1,e&&1008===e.code&&e.reason&&(e.reason.includes("Domain not whitelisted")||e.reason.includes("domain")||e.reason.includes("whitelist"))){var n=new Error("DOMAIN_NOT_WHITELISTED");n.reason=e.reason,n.code=e.code,t.emit("domainError",n),t.emit("error",n)}t.isRecording&&t.stopRecording().catch(function(t){console.error("VoiceSDK: Error stopping recording on disconnect:",t)}),t.emit("disconnected",e)}),this.webSocketManager.on("error",function(e){t.emit("error",e)}),this.webSocketManager.on("message",function(e){if("greeting_audio"===e.t&&e.data)try{for(var n=atob(e.data),o=new Uint8Array(n.length),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);t.audioPlayer.playAudio(o),t.emit("greetingStarted")}catch(t){console.error("VoiceSDK: Error playing greeting audio:",t)}else t.emit("message",e)}),this.webSocketManager.on("binaryAudio",function(e){t.audioPlayer.playAudio(e)}),this.webSocketManager.on("bargeIn",function(e){t.emit("bargeIn",e)}),this.webSocketManager.on("stopPlaying",function(e){t.emit("stopPlaying",e),t.audioPlayer.stopImmediate()}),this.audioRecorder.on("recordingStarted",function(){t.isRecording=!0,t.isPlaying&&(t.audioPlayer.stopImmediate(),t.isConnected&&t.webSocketManager.sendMessage({t:"barge_in"})),t.emit("recordingStarted")}),this.audioRecorder.on("recordingStopped",function(){t.isRecording=!1,t.emit("recordingStopped")}),this.audioRecorder.on("audioData",function(e){t.isConnected&&t.webSocketManager.sendBinary(e)}),this.audioPlayer.on("playbackStarted",function(){t.isPlaying=!0,t.emit("playbackStarted"),t.isConnected&&t.webSocketManager.sendMessage({t:"audio_started_playing"})}),this.audioPlayer.on("playbackStopped",function(){t.isPlaying=!1,t.emit("playbackStopped"),t.isConnected&&t.webSocketManager.sendMessage({t:"audio_stopped_playing"})}),this.audioPlayer.on("playbackError",function(e){t.emit("playbackError",e)})}},{key:"connect",value:(l=it(et().m(function t(){var e,n;return et().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isDestroyed){t.n=1;break}return console.warn("VoiceSDK: Cannot connect - SDK is destroyed"),t.a(2,!1);case 1:return t.p=1,e=this.buildWebSocketUrl(),this.webSocketManager.config.websocketUrl=e,t.n=2,this.webSocketManager.connect();case 2:return t.a(2,!0);case 3:return t.p=3,n=t.v,console.error("ðŸ”Œ VoiceSDK: Connection failed with error:",n),this.emit("error",n),t.a(2,!1)}},t,this,[[1,3]])})),function(){return l.apply(this,arguments)})},{key:"buildWebSocketUrl",value:function(){var t=this.config.websocketUrl,e=new URLSearchParams;if(this.config.agentId&&e.append("agentId",this.config.agentId),this.config.appId&&e.append("appId",this.config.appId),this.config.voice&&"default"!==this.config.voice&&e.append("voice",this.config.voice),this.config.language&&"en"!==this.config.language&&e.append("language",this.config.language),e.toString()){var n=t.includes("?")?"&":"?";t+=n+e.toString()}return t}},{key:"disconnect",value:function(){this.isDestroyed||(this.stopRecording(),this.webSocketManager.disconnect())}},{key:"resetReconnectionAttempts",value:function(){this.isDestroyed||this.webSocketManager.resetReconnectionAttempts()}},{key:"reconnect",value:(s=it(et().m(function t(){return et().w(function(t){for(;;)switch(t.n){case 0:if(!this.isDestroyed){t.n=1;break}return t.a(2,!1);case 1:return this.disconnect(),this.resetReconnectionAttempts(),t.n=2,this.connect();case 2:return t.a(2,t.v)}},t,this)})),function(){return s.apply(this,arguments)})},{key:"startRecording",value:(c=it(et().m(function t(){var e;return et().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.isConnected){t.n=1;break}throw new Error("Not connected to voice server");case 1:return t.p=1,this.webSocketManager.sendMessage({t:"start_continuous_mode",ttpId:this.generateTtpId(),voice:this.config.voice,language:this.config.language}),t.n=2,this.audioRecorder.start();case 2:return t.a(2,!0);case 3:return t.p=3,e=t.v,console.error("âŒ VoiceSDK: Failed to start recording:",e),this.emit("error",e),t.a(2,!1)}},t,this,[[1,3]])})),function(){return c.apply(this,arguments)})},{key:"stopRecording",value:(a=it(et().m(function t(){var e;return et().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.isRecording){t.n=1;break}return t.a(2);case 1:return t.p=1,this.webSocketManager.sendMessage({t:"stop_continuous_mode",ttpId:this.generateTtpId()}),t.n=2,this.audioRecorder.stop();case 2:return this.audioPlayer.stopImmediate(),t.a(2,!0);case 3:return t.p=3,e=t.v,this.emit("error",e),t.a(2,!1)}},t,this,[[1,3]])})),function(){return a.apply(this,arguments)})},{key:"toggleRecording",value:(r=it(et().m(function t(){return et().w(function(t){for(;;)switch(t.n){case 0:if(!this.isRecording){t.n=2;break}return t.n=1,this.stopRecording();case 1:case 3:return t.a(2,t.v);case 2:return t.n=3,this.startRecording();case 4:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"stopAudioPlayback",value:function(){this.audioPlayer.stopImmediate()}},{key:"handleBargeIn",value:(i=it(et().m(function t(){return et().w(function(t){for(;;)switch(t.n){case 0:if(this.stopAudioPlayback(),this.isRecording){t.n=1;break}return t.n=1,this.startRecording();case 1:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"getStatus",value:function(){return{isConnected:this.isConnected,isRecording:this.isRecording,isPlaying:this.isPlaying}}},{key:"updateConfig",value:function(t){this.config=at(at({},this.config),t)}},{key:"generateTtpId",value:function(){return"sdk_"+Math.random().toString(36).substr(2,9)+"_"+Date.now()}},{key:"sendHelloMessage",value:function(){if(this.isConnected){var t={t:"hello"};this.config.appId?t.appId=this.config.appId:this.config.ttpId?t.ttpId=this.config.ttpId:t.ttpId=this.generateTtpId();try{this.webSocketManager.sendMessage(t)}catch(t){console.error("VoiceSDK: Failed to send hello message:",t),this.emit("error",t)}}else console.warn("VoiceSDK: Cannot send hello message - not connected")}},{key:"destroy",value:function(){this.isDestroyed||(this.disconnect(),this.isDestroyed=!0,this.audioRecorder.destroy(),this.audioPlayer.destroy(),this.removeAllListeners())}}],o&&st(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i,r,a,c,s,l}(c);function vt(t){return vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vt(t)}function ht(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return gt(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(gt(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,gt(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,gt(d,"constructor",l),gt(l,"constructor",s),s.displayName="GeneratorFunction",gt(l,i,"GeneratorFunction"),gt(d),gt(d,i,"Generator"),gt(d,o,function(){return this}),gt(d,"toString",function(){return"[object Generator]"}),(ht=function(){return{w:r,m:p}})()}function gt(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}gt=function(t,e,n,o){function r(e,n){gt(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},gt(t,e,n,o)}function yt(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(n),!0).forEach(function(e){xt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function xt(t,e,n){return(e=St(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function wt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,St(o.key),o)}}function St(t){var e=function(t){if("object"!=vt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==vt(e)?e:e+""}function kt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(kt=function(){return!!t})()}function Ct(t){return Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ct(t)}function It(t,e){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},It(t,e)}var Et=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=(t=function(t,e,n){return e=Ct(e),function(t,e){if(e&&("object"==vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,kt()?Reflect.construct(e,n||[],Ct(t).constructor):e.apply(t,n))}(this,e)).readScriptTagConfig();return t.config=bt({baseWsUrl:"wss://backend.talktopc.com/chat/websocket",appId:n.appId||o.appId,agentId:n.agentId||o.agentId,conversationId:void 0!==n.conversationId?n.conversationId:t.getPersistedConversationId(),forceConversationId:n.forceConversationId,queue:[],inFlight:!1},n),t.fullResponseBuffer="",t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&It(t,e)}(e,t),n=e,o=[{key:"readScriptTagConfig",value:function(){try{var t=Array.from(document.getElementsByTagName("script")).reverse().find(function(t){return t.dataset&&(t.dataset.appId||t.dataset.agentId)||t.src&&t.src.includes("agent-widget")});return t?{appId:t.dataset.appId,agentId:t.dataset.agentId}:{}}catch(t){return{}}}},{key:"buildWebSocketUrl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.baseWsUrl,e=new URLSearchParams;return this.config.appId&&e.append("appId",this.config.appId),this.config.agentId&&e.append("agentId",this.config.agentId),this.config.conversationId&&e.append("conversationId",this.config.conversationId),"".concat(t,"?").concat(e.toString())}},{key:"sendMessage",value:(i=ht().m(function t(e){var n=this;return ht().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,o){if(e&&e.trim())if(n.config.appId&&n.config.agentId){var i={text:e,resolve:t,reject:o};n.config.inFlight?n.config.queue.push(i):n.executeTask(i)}else o(new Error("Missing appId or agentId"));else o(new Error("Message is empty"))}))},t)}),r=function(){var t=this,e=arguments;return new Promise(function(n,o){var r=i.apply(t,e);function a(t){yt(r,n,o,a,c,"next",t)}function c(t){yt(r,n,o,a,c,"throw",t)}a(void 0)})},function(t){return r.apply(this,arguments)})},{key:"executeTask",value:function(t){var e=this;if(this.config.inFlight=!0,this.fullResponseBuffer="",!this.config.conversationId){var n=this.getPersistedConversationId();n&&(this.config.conversationId=n,console.log("ðŸ” TextChatSDK hydrated conversationId from storage:",n))}var o,i=this.buildWebSocketUrl(this.config.baseWsUrl),r=this.config.baseWsUrl.endsWith("/websocket")?this.config.baseWsUrl.replace(/\/websocket$/,""):"".concat(this.config.baseWsUrl,"/websocket"),a=this.buildWebSocketUrl(r),c=!1,s=!1,l=null,u=function(n){if(!s)try{var o={message:t.text},i=e.config.forceConversationId||e.config.conversationId;i&&(o.conversationId=i,e.config.forceConversationId&&!e.config.conversationId&&(e.config.conversationId=i,e.persistConversationId(i))),console.log("ðŸ” TextChatSDK sending payload:",o,"conversationId in config:",e.config.conversationId),n.send(JSON.stringify(o)),s=!0}catch(o){t.reject(o),e.emit("error",o);try{n.close()}catch(t){}}},d=function(t){return function(){e.config.conversationId?u(t):l=setTimeout(function(){return u(t)},200)}},p=function(n){return function(o){try{try{console.log("ðŸ”Ž [TextChatSDK] WS <= raw:",o.data)}catch(t){}var i=JSON.parse(o.data);try{console.log("ðŸ”Ž [TextChatSDK] WS <= parsed:",i)}catch(t){}if("hello"===i.type&&i.conversationId){if(console.log("ðŸ” TextChatSDK received conversationId:",i.conversationId),e.config.conversationId=i.conversationId,e.persistConversationId(i.conversationId),e.emit&&e.emit("conversationIdChanged",i.conversationId),!s&&n&&1===n.readyState){if(l)try{clearTimeout(l)}catch(t){}u(n)}return}if(!e.config.conversationId&&i.conversationId&&(console.log("ðŸ” TextChatSDK captured conversationId from message:",i.conversationId),e.config.conversationId=i.conversationId,e.persistConversationId(i.conversationId)),"chunk"===i.type&&"string"==typeof i.content)e.fullResponseBuffer+=i.content,e.emit("chunk",i.content);else if("done"===i.type){try{var r=i.text||i.content||i.answer||i.message||"";r&&!e.fullResponseBuffer&&(e.fullResponseBuffer=r)}catch(t){}!e.config.conversationId&&i.conversationId&&(console.log("ðŸ” TextChatSDK captured conversationId from done:",i.conversationId),e.config.conversationId=i.conversationId),e.persistConversationId(e.config.conversationId),e.emit("done",{text:e.fullResponseBuffer}),t.resolve({conversationId:e.config.conversationId,fullText:e.fullResponseBuffer});try{n.close()}catch(t){}}else if("error"===i.type){var a=new Error(i.message||"Server error");e.emit("error",a),t.reject(a);try{n.close()}catch(t){}}}catch(t){}}},f=function(n){if(1008===n.code&&n.reason&&(n.reason.includes("Domain not whitelisted")||n.reason.includes("domain")||n.reason.includes("whitelist"))){var o=new Error("DOMAIN_NOT_WHITELISTED");return o.reason=n.reason,o.code=n.code,e.emit("domainError",o),t.reject(o),e.config.inFlight=!1,void e.drainQueue()}e.config.inFlight=!1,e.drainQueue()},v=new WebSocket(i);v.onopen=d(v),v.onmessage=p(v),v.onerror=(o=v,function(n){if(!c){c=!0;try{o.close()}catch(t){}var i=new WebSocket(a);return i.onopen=d(i),i.onmessage=p(i),i.onerror=function(n){e.emit("error",n),t.reject(n)},void(i.onclose=f)}e.emit("error",n),t.reject(n)}),v.onclose=f}},{key:"drainQueue",value:function(){if(0!==this.config.queue.length&&!this.config.inFlight){var t=this.config.queue.shift();this.executeTask(t)}}},{key:"persistConversationId",value:function(t){try{t&&localStorage.setItem("ttp_text_chat_conversation_id",t)}catch(t){}}},{key:"getPersistedConversationId",value:function(){try{return localStorage.getItem("ttp_text_chat_conversation_id")||null}catch(t){return null}}},{key:"updateConfig",value:function(t){this.config=bt(bt({},this.config),t)}},{key:"destroy",value:function(){this.config.queue=[],this.config.inFlight=!1,this.removeAllListeners()}}],o&&wt(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i,r}(c),Ot=n(540),jt=n(848);function Tt(t){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tt(t)}function Pt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function Bt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Pt(Object(n),!0).forEach(function(e){Ft(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Ft(t,e,n){return(e=function(t){var e=function(t){if("object"!=Tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Tt(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _t(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return Dt(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(Dt(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Dt(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,Dt(d,"constructor",l),Dt(l,"constructor",s),s.displayName="GeneratorFunction",Dt(l,i,"GeneratorFunction"),Dt(d),Dt(d,i,"Generator"),Dt(d,o,function(){return this}),Dt(d,"toString",function(){return"[object Generator]"}),(_t=function(){return{w:r,m:p}})()}function Dt(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}Dt=function(t,e,n,o){function r(e,n){Dt(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},Dt(t,e,n,o)}function Rt(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function At(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,i,r,a,c=[],s=!0,l=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=r.call(n)).done)&&(c.push(o.value),c.length!==e);s=!0);}catch(t){l=!0,i=t}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Mt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}const zt=function(t){var e=t.websocketUrl,n=t.agentId,o=t.voice,i=void 0===o?"default":o,r=t.language,a=void 0===r?"en":r,c=t.autoReconnect,s=void 0===c||c,l=t.onConnected,u=t.onDisconnected,d=t.onRecordingStarted,p=t.onRecordingStopped,f=t.onPlaybackStarted,v=t.onPlaybackStopped,h=t.onError,g=t.onMessage,y=t.onBargeIn,m=t.onStopPlaying,b=t.className,x=void 0===b?"":b,w=t.style,S=void 0===w?{}:w,k=t.children,C=At((0,Ot.useState)(!1),2),I=C[0],E=C[1],O=At((0,Ot.useState)(!1),2),j=O[0],T=O[1],P=At((0,Ot.useState)(!1),2),B=(P[0],P[1]),F=At((0,Ot.useState)("Disconnected"),2),_=(F[0],F[1]),D=(0,Ot.useRef)(null);(0,Ot.useEffect)(function(){console.log("ðŸŽ™ï¸ VoiceButton: Creating VoiceSDK instance for ".concat(e)),D.current&&(console.log("ðŸŽ™ï¸ VoiceButton: Destroying existing VoiceSDK instance"),D.current.destroy(),D.current=null);var t=new ft({websocketUrl:e,agentId:n,voice:i,language:a,autoReconnect:s});return t.on("connected",function(){E(!0),_("Connected"),null==l||l()}),t.on("disconnected",function(){E(!1),_("Disconnected"),null==u||u()}),t.on("recordingStarted",function(){T(!0),null==d||d()}),t.on("recordingStopped",function(){T(!1),null==p||p()}),t.on("playbackStarted",function(){B(!0),null==f||f()}),t.on("playbackStopped",function(){B(!1),null==v||v()}),t.on("error",function(t){null==h||h(t)}),t.on("message",function(t){null==g||g(t)}),t.on("bargeIn",function(t){null==y||y(t)}),t.on("stopPlaying",function(t){null==m||m(t)}),D.current=t,t.connect(),function(){console.log("ðŸŽ™ï¸ VoiceButton: Cleaning up VoiceSDK instance for ".concat(e)),D.current&&(D.current.destroy(),D.current=null)}},[e,n,i,a]);var R=function(){var t,e=(t=_t().m(function t(){var e;return _t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(D.current){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,D.current.toggleRecording();case 2:t.n=4;break;case 3:t.p=3,e=t.v,console.error("Error toggling recording:",e);case 4:return t.a(2)}},t,null,[[1,3]])}),function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){Rt(r,o,i,a,c,"next",t)}function c(t){Rt(r,o,i,a,c,"throw",t)}a(void 0)})});return function(){return e.apply(this,arguments)}}(),A=(0,jt.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,jt.jsx)("div",{style:{fontSize:"20px"},children:j?"ðŸ”´":"ðŸŽ¤"}),(0,jt.jsx)("div",{children:j?"Stop Listening":"Start Listening"})]});return(0,jt.jsx)("button",{className:"voice-button ".concat(j?"recording":""," ").concat(x),style:Bt({padding:"12px 24px",border:"none",borderRadius:"8px",backgroundColor:j?"#dc3545":"#007bff",color:"white",cursor:"pointer",fontSize:"16px",fontWeight:"500",transition:"all 0.2s ease"},S),onClick:R,disabled:!I,children:k||A})};function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function Ht(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return Vt(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(Vt(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,Vt(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,Vt(d,"constructor",l),Vt(l,"constructor",s),s.displayName="GeneratorFunction",Vt(l,i,"GeneratorFunction"),Vt(d),Vt(d,i,"Generator"),Vt(d,o,function(){return this}),Vt(d,"toString",function(){return"[object Generator]"}),(Ht=function(){return{w:r,m:p}})()}function Vt(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}Vt=function(t,e,n,o){function r(e,n){Vt(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},Vt(t,e,n,o)}function Ut(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function Nt(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){Ut(r,o,i,a,c,"next",t)}function c(t){Ut(r,o,i,a,c,"throw",t)}a(void 0)})}}function Kt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function Wt(t,e,n){return(e=Qt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Gt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Qt(o.key),o)}}function Qt(t){var e=function(t){if("object"!=Lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Lt(e)?e:e+""}var qt=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Kt(Object(n),!0).forEach(function(e){Wt(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Kt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({websocketUrl:e.websocketUrl||"wss://speech.talktopc.com/ws/conv",agentId:e.agentId,voice:e.voice||"default",language:e.language||"en",container:e.container||document.body,buttonText:e.buttonText||"Start Listening",buttonClass:e.buttonClass||"voice-button"},e),this.isConnected=!1,this.isRecording=!1,this.isPlaying=!1,this.voiceSDK=new ft({websocketUrl:this.options.websocketUrl,agentId:this.options.agentId,voice:this.options.voice,language:this.options.language}),this.setupEventListeners(),this.createButton(),this.connect()},e=[{key:"setupEventListeners",value:function(){var t=this;this.voiceSDK.on("connected",function(){var e,n;t.isConnected=!0,t.updateButton(),null===(e=(n=t.options).onConnected)||void 0===e||e.call(n)}),this.voiceSDK.on("disconnected",function(){var e,n;t.isConnected=!1,t.updateButton(),null===(e=(n=t.options).onDisconnected)||void 0===e||e.call(n)}),this.voiceSDK.on("recordingStarted",function(){var e,n;t.isRecording=!0,t.updateButton(),null===(e=(n=t.options).onRecordingStarted)||void 0===e||e.call(n)}),this.voiceSDK.on("recordingStopped",function(){var e,n;t.isRecording=!1,t.updateButton(),null===(e=(n=t.options).onRecordingStopped)||void 0===e||e.call(n)}),this.voiceSDK.on("playbackStarted",function(){var e,n;t.isPlaying=!0,null===(e=(n=t.options).onPlaybackStarted)||void 0===e||e.call(n)}),this.voiceSDK.on("playbackStopped",function(){var e,n;t.isPlaying=!1,null===(e=(n=t.options).onPlaybackStopped)||void 0===e||e.call(n)}),this.voiceSDK.on("error",function(e){var n,o;null===(n=(o=t.options).onError)||void 0===n||n.call(o,e)}),this.voiceSDK.on("message",function(e){var n,o;null===(n=(o=t.options).onMessage)||void 0===n||n.call(o,e)}),this.voiceSDK.on("bargeIn",function(e){var n,o;null===(n=(o=t.options).onBargeIn)||void 0===n||n.call(o,e)}),this.voiceSDK.on("stopPlaying",function(e){var n,o;null===(n=(o=t.options).onStopPlaying)||void 0===n||n.call(o,e)})}},{key:"createButton",value:function(){var t=this;this.button=document.createElement("button"),this.button.className=this.options.buttonClass,this.button.style.cssText="\n      padding: 12px 24px;\n      border: none;\n      border-radius: 8px;\n      background-color: #6c757d;\n      color: white;\n      cursor: pointer;\n      font-size: 16px;\n      font-weight: 500;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    ",this.button.addEventListener("click",function(){return t.toggleRecording()}),this.options.container.appendChild(this.button),this.updateButton()}},{key:"updateButton",value:function(){if(this.button){var t=this.isRecording?"ðŸ”´":"ðŸŽ¤",e=this.isRecording?"Stop Listening":"Start Listening";this.button.innerHTML='\n      <span style="font-size: 20px;">'.concat(t,"</span>\n      <span>").concat(e,"</span>\n    "),this.button.disabled=!this.isConnected,this.button.style.backgroundColor=this.isRecording?"#dc3545":this.isConnected?"#007bff":"#6c757d"}}},{key:"connect",value:(o=Nt(Ht().m(function t(){var e;return Ht().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.voiceSDK.connect();case 1:t.n=3;break;case 2:t.p=2,e=t.v,console.error("Failed to connect:",e);case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return o.apply(this,arguments)})},{key:"toggleRecording",value:(n=Nt(Ht().m(function t(){var e;return Ht().w(function(t){for(;;)switch(t.p=t.n){case 0:if(this.voiceSDK){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,this.voiceSDK.toggleRecording();case 2:t.n=4;break;case 3:t.p=3,e=t.v,console.error("Error toggling recording:",e);case 4:return t.a(2)}},t,this,[[1,3]])})),function(){return n.apply(this,arguments)})},{key:"getStatus",value:function(){return{isConnected:this.isConnected,isRecording:this.isRecording,isPlaying:this.isPlaying}}},{key:"updateConfig",value:function(t){this.voiceSDK.updateConfig(t)}},{key:"destroy",value:function(){this.button&&this.button.parentNode&&this.button.parentNode.removeChild(this.button),this.voiceSDK&&this.voiceSDK.destroy()}}],e&&Gt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o}();function Yt(t){return Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt(t)}function Jt(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return $t(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):($t(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,$t(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,$t(d,"constructor",l),$t(l,"constructor",s),s.displayName="GeneratorFunction",$t(l,i,"GeneratorFunction"),$t(d),$t(d,i,"Generator"),$t(d,o,function(){return this}),$t(d,"toString",function(){return"[object Generator]"}),(Jt=function(){return{w:r,m:p}})()}function $t(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}$t=function(t,e,n,o){function r(e,n){$t(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},$t(t,e,n,o)}function Xt(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function Zt(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){Xt(r,o,i,a,c,"next",t)}function c(t){Xt(r,o,i,a,c,"throw",t)}a(void 0)})}}function te(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ee(o.key),o)}}function ee(t){var e=function(t){if("object"!=Yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Yt(e)?e:e+""}var ne=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),console.log("ðŸš€ AgentSDK v2.1.8 initialized with config:",e),this.config=e,this.voiceSDK=null,this.isConnected=!1,this.isListening=!1,this.onConnected=function(){},this.onDisconnected=function(){},this.onError=function(t){return console.error("SDK Error:",t)},this.onTranscript=function(t){},this.onAgentSpeaking=function(t){}},e=[{key:"connect",value:(o=Zt(Jt().m(function t(e){var n,o=this;return Jt().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,e){t.n=1;break}throw new Error("signedUrl is required");case 1:return this.voiceSDK&&(console.log("ðŸ”Œ AgentSDK: Cleaning up existing connection"),this.voiceSDK.destroy(),this.voiceSDK=null),this.voiceSDK=new ft({websocketUrl:e,autoReconnect:!1,agentId:this.config.agentId,appId:this.config.appId,language:this.config.language||"en"}),this.voiceSDK.on("connected",function(){o.isConnected=!0,o.onConnected()}),this.voiceSDK.on("disconnected",function(t){if(o.isConnected=!1,t&&1008===t.code&&t.reason&&(t.reason.includes("Domain not whitelisted")||t.reason.includes("domain")||t.reason.includes("whitelist"))){var e=new Error("DOMAIN_NOT_WHITELISTED");e.reason=t.reason,e.code=t.code,o.onError(e)}o.onDisconnected()}),this.voiceSDK.on("domainError",function(t){o.onError(t)}),this.voiceSDK.on("error",function(t){o.onError(t)}),this.voiceSDK.on("message",function(t){o.handleWebSocketMessage(t)}),this.voiceSDK.on("recordingStarted",function(){o.isListening=!0}),this.voiceSDK.on("recordingStopped",function(){o.isListening=!1}),this.voiceSDK.on("playbackStarted",function(){o.onAgentSpeaking(!0)}),this.voiceSDK.on("playbackStopped",function(){o.onAgentSpeaking(!1)}),t.n=2,this.voiceSDK.connect();case 2:t.n=4;break;case 3:throw t.p=3,n=t.v,this.onError(n),n;case 4:return t.a(2)}},t,this,[[0,3]])})),function(t){return o.apply(this,arguments)})},{key:"handleWebSocketMessage",value:function(t){switch(t.type){case"connected":console.log("Session started successfully");break;case"user_transcript":this.onTranscript(t.user_transcription||t.text);break;case"agent_response":case"barge_in":case"stop_playing":break;case"error":this.onError(new Error(t.message))}}},{key:"startListening",value:(n=Zt(Jt().m(function t(){var e;return Jt().w(function(t){for(;;)switch(t.p=t.n){case 0:if(console.log("ðŸŽ¤ AgentSDK: startListening() called"),!this.voiceSDK){t.n=5;break}return t.p=1,console.log("ðŸŽ¤ AgentSDK: Starting recording..."),t.n=2,this.voiceSDK.startRecording();case 2:console.log("âœ… AgentSDK: Recording started successfully"),t.n=4;break;case 3:throw t.p=3,e=t.v,console.error("âŒ AgentSDK: Failed to start recording:",e),e;case 4:t.n=6;break;case 5:throw console.error("âŒ AgentSDK: No voiceSDK instance available"),new Error("No voiceSDK instance available");case 6:return t.a(2)}},t,this,[[1,3]])})),function(){return n.apply(this,arguments)})},{key:"stopListening",value:function(){this.voiceSDK&&this.voiceSDK.stopRecording()}},{key:"updateVariables",value:function(t){this.voiceSDK&&this.isConnected&&this.voiceSDK.webSocketManager.sendMessage({t:"update_variables",variables:t})}},{key:"disconnect",value:function(){this.voiceSDK&&(this.voiceSDK.destroy(),this.voiceSDK=null),this.isConnected=!1,this.isListening=!1}}],e&&te(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o}();function oe(t){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oe(t)}function ie(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return re(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(re(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,re(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,re(d,"constructor",l),re(l,"constructor",s),s.displayName="GeneratorFunction",re(l,i,"GeneratorFunction"),re(d),re(d,i,"Generator"),re(d,o,function(){return this}),re(d,"toString",function(){return"[object Generator]"}),(ie=function(){return{w:r,m:p}})()}function re(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}re=function(t,e,n,o){function r(e,n){re(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},re(t,e,n,o)}function ae(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function ce(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){ae(r,o,i,a,c,"next",t)}function c(t){ae(r,o,i,a,c,"throw",t)}a(void 0)})}}function se(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,le(o.key),o)}}function le(t){var e=function(t){if("object"!=oe(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==oe(e)?e:e+""}var ue=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.audioStream=null,this.callStartTime=null,this.callTimerInterval=null,this.sdk=null,this.isActive=!1,this.sdk=new ne({agentId:e.agentId,appId:e.appId,getSessionUrl:e.getSessionUrl,websocketUrl:e.websocketUrl,variables:e.variables||{},language:e.language||"en"}),this.setupSDKEventHandlers()},e=[{key:"setupSDKEventHandlers",value:function(){var t=this;this.sdk.onTranscript=function(e){t.updateTranscript(e)},this.sdk.onAgentSpeaking=function(t){var e=document.getElementById("voiceAvatarActive");e&&(t?e.classList.add("speaking"):e.classList.remove("speaking"))},this.sdk.onError=function(e){console.error("âŒ Voice SDK Error:",e),e&&("DOMAIN_NOT_WHITELISTED"===e.message||e.message&&e.message.includes("Domain not whitelisted"))?t.showDomainError():t.showError(e.message||e)}}},{key:"t",value:function(t){var e,n,o=this.config.language||"en";return((null===(e=this.config.translations)||void 0===e?void 0:e[o])||(null===(n=this.config.translations)||void 0===n?void 0:n.en)||{})[t]||t}},{key:"getTooltip",value:function(t){var e,n=null===(e=this.config.tooltips)||void 0===e?void 0:e[t];return null!=n?n:{mute:this.t("mute"),speaker:this.t("speaker"),endCall:this.t("endCall")}[t]||""}},{key:"generateHTML",value:function(){return'<div class="voice-interface" id="voiceInterface">\n      \x3c!-- Before Call State --\x3e\n      <div id="voiceIdleState" style="display: flex; flex-direction: column; align-items: center; width: 100%;">\n        <div class="voice-avatar" id="voiceAvatar">\n          ðŸ¤–\n        </div>\n        <div class="voice-status">\n          <div class="voice-status-title">'.concat(this.t("clickToStartCall"),'</div>\n          <div class="voice-status-subtitle">').concat(this.t("realTimeVoice"),'</div>\n        </div>\n        \x3c!-- BIG START CALL BUTTON --\x3e\n        <button class="start-call-btn" id="startCallBtn">\n          <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/>\n          </svg>\n          <span>').concat(this.t("startCall"),'</span>\n        </button>\n      </div>\n      \x3c!-- During Call State --\x3e\n      <div id="voiceActiveState" style="display: none; flex-direction: column; align-items: center; width: 100%; height: 100%; justify-content: flex-start; overflow: hidden; padding-top: 10px;">\n        <div class="voice-avatar-active" id="voiceAvatarActive">\n          <div class="voice-rings">\n            <div class="voice-ring"></div>\n            <div class="voice-ring"></div>\n            <div class="voice-ring"></div>\n          </div>\n          ðŸ¤–\n        </div>\n        <div class="voice-status">\n          <div class="voice-status-title" id="voiceStatusTitleActive">').concat(this.t("listening"),'</div>\n          <div class="voice-status-subtitle" id="voiceStatusSubtitleActive">').concat(this.t("speakFreely"),'</div>\n        </div>\n        <div class="voice-transcript">\n          <div class="transcript-label">').concat(this.t("liveTranscript"),'</div>\n          <div class="transcript-text empty" id="transcriptText">\n            ').concat(this.t("transcriptWillAppear"),'\n          </div>\n        </div>\n        <div class="voice-controls">\n          <button class="voice-control-btn secondary" id="muteBtn" title="').concat(this.getTooltip("mute"),'">\n            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="mute-icon">\n              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>\n              <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>\n              <line x1="12" y1="19" x2="12" y2="23"/>\n              <line x1="8" y1="23" x2="16" y2="23"/>\n              <line x1="2" y1="2" x2="22" y2="22" class="mute-cross" style="display: none; stroke: #ef4444; stroke-width: 3.5;"/>\n            </svg>\n          </button>\n          <button class="voice-control-btn primary active" id="endCallBtn" title="').concat(this.getTooltip("endCall"),'">\n            <svg width="56" height="56" viewBox="0 0 24 24" fill="#ef4444">\n              <rect x="6" y="6" width="12" height="12" rx="2"/>\n            </svg>\n            <div class="voice-timer" id="voiceTimer">00:00</div>\n          </button>\n          <button class="voice-control-btn secondary" id="speakerBtn" title="').concat(this.getTooltip("speaker"),'">\n            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n              <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>\n              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>\n              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n    </div>')}},{key:"generateCSS",value:function(){var t=this.config.avatarBackgroundColor||"#667eea",e=this.config.avatarActiveBackgroundColor||this.config.avatarBackgroundColor||"#667eea",n=this.config.statusTitleColor||"#1e293b",o=this.config.statusSubtitleColor||"#64748b",i=this.config.startCallButtonColor||"#667eea",r=this.config.startCallButtonTextColor||"#FFFFFF",a=this.config.transcriptBackgroundColor||"#FFFFFF",c=this.config.transcriptTextColor||"#1e293b",s=this.config.transcriptLabelColor||"#94a3b8",l=this.config.controlButtonColor||"#FFFFFF",u=this.config.controlButtonSecondaryColor||"#64748b",d=this.config.endCallButtonColor||"#ef4444";return"\n      /* Voice Interface Styles */\n      .voice-interface { \n        display: none; \n        flex: 1; \n        flex-direction: column;\n        align-items: center; \n        justify-content: flex-start; \n        padding: 10px 20px 20px 20px; \n        background: linear-gradient(180deg, #f8fafc 0%, #e0e7ff 100%);\n        overflow: hidden;\n        min-height: 0;\n      }\n      .voice-interface.active { display: flex; }\n      \n      /* Voice Avatar (idle state) */\n      .voice-avatar {\n        width: 120px;\n        height: 120px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, ".concat(t," 0%, ").concat(e," 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 56px;\n        margin-top: 10px;\n        margin-bottom: 16px;\n        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);\n        transition: all 0.3s ease;\n        flex-shrink: 0;\n      }\n      \n      /* Voice Avatar (active state with animations) */\n      .voice-avatar-active {\n        width: 120px;\n        height: 120px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, ").concat(t," 0%, ").concat(e," 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 56px;\n        margin-top: 10px;\n        margin-bottom: 16px;\n        position: relative;\n        box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);\n        animation: avatarPulse 2s ease-in-out infinite;\n        flex-shrink: 0;\n      }\n      \n      @keyframes avatarPulse {\n        0%, 100% { \n          transform: scale(1);\n          box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);\n        }\n        50% { \n          transform: scale(1.05);\n          box-shadow: 0 15px 50px rgba(102, 126, 234, 0.5);\n        }\n      }\n      \n      .voice-avatar-active.speaking {\n        animation: avatarSpeak 0.5s ease-in-out infinite;\n      }\n      \n      @keyframes avatarSpeak {\n        0%, 100% { transform: scale(1); }\n        50% { transform: scale(1.08); }\n      }\n      \n      /* Voice Rings Animation */\n      .voice-rings {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n      }\n      \n      .voice-ring {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        border: 2px solid rgba(102, 126, 234, 0.3);\n        border-radius: 50%;\n        opacity: 0;\n        animation: ringExpand 2s ease-out infinite;\n      }\n      \n      .voice-ring:nth-child(2) { animation-delay: 0.5s; }\n      .voice-ring:nth-child(3) { animation-delay: 1s; }\n      \n      @keyframes ringExpand {\n        0% {\n          width: 100%;\n          height: 100%;\n          opacity: 0.6;\n        }\n        100% {\n          width: 160%;\n          height: 160%;\n          opacity: 0;\n        }\n      }\n      \n      /* Voice Status */\n      .voice-status {\n        text-align: center;\n        margin-bottom: 10px;\n        flex-shrink: 0;\n      }\n      \n      .voice-status-title {\n        font-size: 18px;\n        font-weight: 600;\n        color: ").concat(n,";\n        margin-bottom: 4px;\n      }\n      \n      .voice-status-subtitle {\n        font-size: 12px;\n        color: ").concat(o,";\n      }\n      \n      /* Start Call Button */\n      .start-call-btn {\n        margin-top: 20px;\n        width: 200px;\n        height: 56px;\n        border-radius: 28px;\n        border: none;\n        background: ").concat(i,";\n        color: ").concat(r,";\n        font-size: 18px;\n        font-weight: 600;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 12px;\n        box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);\n        transition: all 0.3s ease;\n        flex-shrink: 0;\n      }\n      \n      .start-call-btn:hover {\n        transform: translateY(-4px);\n        box-shadow: 0 16px 40px rgba(102, 126, 234, 0.5);\n      }\n      \n      .start-call-btn:active {\n        transform: translateY(-2px);\n      }\n      \n      /* Voice Transcript */\n      .voice-transcript {\n        background: ").concat(a,";\n        padding: 12px;\n        border-radius: 12px;\n        max-width: 300px;\n        width: 100%;\n        margin-bottom: 12px;\n        min-height: 50px;\n        max-height: 90px;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n        flex-shrink: 1;\n        overflow-y: auto;\n      }\n      \n      .transcript-label {\n        font-size: 10px;\n        color: ").concat(s,";\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n        margin-bottom: 6px;\n      }\n      \n      .transcript-text {\n        font-size: 14px;\n        color: ").concat(c,";\n        line-height: 1.5;\n        min-height: 30px;\n      }\n      \n      .transcript-text.empty {\n        color: #cbd5e1;\n        font-style: italic;\n      }\n      \n      /* Voice Controls */\n      .voice-controls {\n        display: flex;\n        gap: 12px;\n        align-items: center;\n        flex-shrink: 0;\n      }\n      \n      .voice-control-btn {\n        width: 72px;\n        height: 72px;\n        border-radius: 50%;\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        position: relative;\n        flex-shrink: 0;\n      }\n      \n      .voice-control-btn.primary {\n        width: 80px;\n        height: 80px;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        color: white;\n        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);\n      }\n      \n      .voice-control-btn.primary:hover {\n        transform: scale(1.05);\n        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.5);\n      }\n      \n      .voice-control-btn.primary.active {\n        background: ").concat("#ef4444"===d?"white":l,";\n        animation: recordingPulse 1.5s ease-in-out infinite;\n        box-shadow: 0 8px 20px ").concat("#ef4444"===d?"rgba(239, 68, 68, 0.4)":"rgba(0, 0, 0, 0.2)",";\n      }\n      \n      @keyframes recordingPulse {\n        0%, 100% { \n          box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);\n        }\n        50% { \n          box-shadow: 0 8px 30px rgba(239, 68, 68, 0.7);\n        }\n      }\n      \n      .voice-control-btn.secondary {\n        background: ").concat(l,";\n        color: ").concat(u,";\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      }\n      \n      .voice-control-btn.secondary:hover {\n        background: #f8fafc;\n        transform: scale(1.05);\n      }\n      \n      .voice-control-btn.secondary.muted {\n        background: #f3f4f6;\n      }\n      \n      .voice-control-btn.secondary.muted .mute-icon {\n        stroke: #9ca3af !important;\n      }\n      \n      .voice-timer {\n        position: absolute;\n        bottom: -24px;\n        font-size: 12px;\n        color: #64748b;\n        font-weight: 500;\n      }\n      \n      @media (max-width: 768px) {\n        .voice-interface {\n          padding: 8px 12px 16px 12px;\n        }\n        \n        .voice-avatar,\n        .voice-avatar-active {\n          width: 100px;\n          height: 100px;\n          font-size: 48px;\n          margin-top: 8px;\n          margin-bottom: 12px;\n        }\n        \n        .voice-status-title {\n          font-size: 16px;\n        }\n        \n        .voice-status-subtitle {\n          font-size: 13px;\n        }\n        \n        .voice-start-call-btn {\n          padding: 12px 24px;\n          font-size: 15px;\n          min-height: 44px;\n        }\n        \n        .voice-transcript-container {\n          padding: 12px;\n          max-height: 180px;\n        }\n        \n        .voice-transcript-text {\n          font-size: 14px;\n          line-height: 1.5;\n        }\n        \n        .voice-controls {\n          gap: 12px;\n          padding: 12px;\n        }\n        \n        .voice-control-btn {\n          width: 48px;\n          height: 48px;\n          min-width: 48px;\n          min-height: 48px;\n        }\n        \n        .voice-control-btn.end-call {\n          width: 52px;\n          height: 52px;\n          min-width: 52px;\n          min-height: 52px;\n        }\n      }\n      \n      @media (max-width: 480px) {\n        .voice-interface {\n          padding: 6px 10px 12px 10px;\n        }\n        \n        .voice-avatar,\n        .voice-avatar-active {\n          width: 90px;\n          height: 90px;\n          font-size: 42px;\n        }\n        \n        .voice-status-title {\n          font-size: 15px;\n        }\n        \n        .voice-status-subtitle {\n          font-size: 12px;\n        }\n        \n        .voice-start-call-btn {\n          padding: 10px 20px;\n          font-size: 14px;\n        }\n        \n        .voice-transcript-container {\n          padding: 10px;\n          max-height: 150px;\n        }\n        \n        .voice-transcript-text {\n          font-size: 13px;\n        }\n        \n        .voice-controls {\n          gap: 10px;\n          padding: 10px;\n        }\n        \n        .voice-control-btn {\n          width: 44px;\n          height: 44px;\n          min-width: 44px;\n          min-height: 44px;\n        }\n        \n        .voice-control-btn.end-call {\n          width: 48px;\n          height: 48px;\n          min-width: 48px;\n          min-height: 48px;\n        }\n      }\n    ")}},{key:"setupEventHandlers",value:function(t){var e=this,n=document.getElementById("startCallBtn"),o=document.getElementById("endCallBtn"),i=document.getElementById("muteBtn"),r=document.getElementById("speakerBtn");n&&(n.onclick=function(){return e.startVoiceCall()}),o&&(o.onclick=function(){return e.endVoiceCall()}),i&&(i.onclick=function(){return e.toggleMute()}),r&&(r.onclick=function(){return e.toggleSpeaker()})}},{key:"getSignedUrl",value:(o=ce(ie().m(function t(){var e,n,o,i,r,a,c;return ie().w(function(t){for(;;)switch(t.n){case 0:if(this.config.getSessionUrl){t.n=2;break}if(this.config.agentId){t.n=1;break}throw new Error("agentId is required");case 1:return e=this.config.websocketUrl||"wss://speech.talktopc.com/ws/conv",(n=new URLSearchParams).append("agentId",this.config.agentId),this.config.appId&&n.append("appId",this.config.appId),!1!==this.config.demo&&n.append("demo","true"),t.a(2,"".concat(e,"?").concat(n.toString()));case 2:if("string"!=typeof this.config.getSessionUrl){t.n=6;break}return o={agentId:this.config.agentId,variables:this.config.variables||{}},this.config.appId&&(o.appId=this.config.appId),t.n=3,fetch(this.config.getSessionUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 3:if((i=t.v).ok){t.n=4;break}throw new Error("Failed to get session URL: ".concat(i.statusText));case 4:return t.n=5,i.json();case 5:return r=t.v,t.a(2,r.signedUrl||r.wsUrl||r.url);case 6:if("function"!=typeof this.config.getSessionUrl){t.n=8;break}return a={agentId:this.config.agentId,variables:this.config.variables||{}},this.config.appId&&(a.appId=this.config.appId),t.n=7,this.config.getSessionUrl(a);case 7:return c=t.v,t.a(2,"string"==typeof c?c:c.signedUrl||c.wsUrl||c.url);case 8:throw new Error("getSessionUrl must be a string (backend URL), a function, or omitted (for direct connection with agentId/appId)");case 9:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"startVoiceCall",value:(n=ce(ie().m(function t(){var e,n,o,i,r,a,c,s,l,u=this;return ie().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.isActive){t.n=1;break}return console.log("âš ï¸ Voice call already active"),t.a(2);case 1:return console.log("ðŸŽ¤ Starting voice call..."),t.p=2,e=document.getElementById("voiceIdleState"),n=document.getElementById("voiceActiveState"),o=document.getElementById("voiceInterface"),e&&(e.style.display="none"),n&&(n.style.display="flex"),o&&(o.scrollTop=0),t.n=3,this.getSignedUrl();case 3:return i=t.v,console.log("ðŸ”— Got signed URL:",i),t.n=4,this.sdk.connect(i);case 4:r=t.v,console.log("âœ… Connected to WebSocket, connected:",r),a=0;case 5:if(this.sdk.isConnected||!(a<50)){t.n=7;break}return t.n=6,new Promise(function(t){return setTimeout(t,100)});case 6:a++,t.n=5;break;case 7:if(!this.sdk.isConnected){t.n=9;break}return console.log("âœ… WebSocket ready, starting listening..."),t.n=8,this.sdk.startListening();case 8:console.log("ðŸŽ¤ Started listening"),this.isActive=!0,this.callStartTime=Date.now(),this.callTimerInterval=setInterval(function(){var t=Date.now()-u.callStartTime,e=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3),o=document.getElementById("voiceTimer");o&&(o.textContent="".concat(e.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")))},1e3),t.n=11;break;case 9:return console.warn("âš ï¸ Connection not fully ready, but trying to start listening anyway..."),t.n=10,this.sdk.startListening();case 10:console.log("ðŸŽ¤ Started listening"),this.isActive=!0,this.callStartTime=Date.now(),this.callTimerInterval=setInterval(function(){var t=Date.now()-u.callStartTime,e=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3),o=document.getElementById("voiceTimer");o&&(o.textContent="".concat(e.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0")))},1e3);case 11:console.log("âœ… Voice call started successfully"),t.n=13;break;case 12:t.p=12,l=t.v,console.error("âŒ Error starting voice call:",l),this.showError(l.message||l),c=document.getElementById("voiceIdleState"),s=document.getElementById("voiceActiveState"),c&&(c.style.display="flex"),s&&(s.style.display="none");case 13:return t.a(2)}},t,this,[[2,12]])})),function(){return n.apply(this,arguments)})},{key:"endVoiceCall",value:function(){console.log("ðŸ”´ Ending voice call..."),this.sdk&&this.isActive&&(this.sdk.stopListening(),this.sdk.disconnect(),this.isActive=!1),this.audioStream&&(this.audioStream.getTracks().forEach(function(t){return t.stop()}),this.audioStream=null),this.callTimerInterval&&(clearInterval(this.callTimerInterval),this.callTimerInterval=null);var t=document.getElementById("voiceIdleState"),e=document.getElementById("voiceActiveState");t&&(t.style.display="flex"),e&&(e.style.display="none");var n=document.getElementById("transcriptText");n&&(n.textContent=this.t("transcriptWillAppear"),n.classList.add("empty"));var o=document.getElementById("voiceAvatarActive");o&&o.classList.remove("speaking"),console.log("âœ… Voice call ended")}},{key:"updateTranscript",value:function(t){var e=document.getElementById("transcriptText");e&&(e.textContent=t,e.classList.remove("empty"))}},{key:"showError",value:function(t){var e=document.getElementById("transcriptText");e&&(e.textContent="".concat(this.t("error"),": ").concat(t),e.classList.remove("empty"))}},{key:"showDomainError",value:function(){var t=document.getElementById("transcriptText");if(t){var e=this.t("domainNotValidated"),n=this.t("domainErrorMessage");t.innerHTML='<div style="font-weight: 600; font-size: 16px; margin-bottom: 8px; color: #991B1B;">'.concat(e,'</div><div style="font-size: 14px; color: #991B1B; line-height: 1.5;">').concat(n,"</div>"),t.classList.remove("empty")}}},{key:"toggleMute",value:function(){if(this.sdk&&this.isActive){var t=null;if(this.sdk.voiceSDK&&this.sdk.voiceSDK.audioRecorder&&this.sdk.voiceSDK.audioRecorder.mediaStream&&(t=this.sdk.voiceSDK.audioRecorder.mediaStream.getAudioTracks()[0]),!t&&this.audioStream&&(t=this.audioStream.getAudioTracks()[0]),t){t.enabled=!t.enabled;var e=document.getElementById("muteBtn"),n=null==e?void 0:e.querySelector(".mute-icon"),o=null==e?void 0:e.querySelector(".mute-cross");e&&n&&o&&(t.enabled?(n.style.stroke="",o.style.display="none",e.classList.remove("muted")):(n.style.stroke="#9ca3af",o.style.display="block",e.classList.add("muted"))),console.log(t.enabled?"ðŸ”Š Unmuted":"ðŸ”‡ Muted")}else console.warn("âš ï¸ No audio track available for mute toggle")}}},{key:"toggleSpeaker",value:function(){console.log("ðŸ”Š Speaker toggle")}},{key:"destroy",value:function(){this.isActive&&this.endVoiceCall(),this.audioStream&&(this.audioStream.getTracks().forEach(function(t){return t.stop()}),this.audioStream=null),this.callTimerInterval&&(clearInterval(this.callTimerInterval),this.callTimerInterval=null),this.sdk&&(this.sdk.disconnect(),this.sdk=null)}}],e&&se(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o}();function de(t){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de(t)}function pe(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return fe(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(fe(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,fe(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,fe(d,"constructor",l),fe(l,"constructor",s),s.displayName="GeneratorFunction",fe(l,i,"GeneratorFunction"),fe(d),fe(d,i,"Generator"),fe(d,o,function(){return this}),fe(d,"toString",function(){return"[object Generator]"}),(pe=function(){return{w:r,m:p}})()}function fe(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}fe=function(t,e,n,o){function r(e,n){fe(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},fe(t,e,n,o)}function ve(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function he(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){ve(r,o,i,a,c,"next",t)}function c(t){ve(r,o,i,a,c,"throw",t)}a(void 0)})}}function ge(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ye(o.key),o)}}function ye(t){var e=function(t){if("object"!=de(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==de(e)?e:e+""}var me=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=e,this.sdk=n,this.streamingEl=null,this.hasStartedStreaming=!1,this.isActive=!1,this.eventHandlers={autoResize:null,keydown:null},this.eventHandlersSetup=!1,this._lastInputValue="",this._lastCursorPosition=0},e=[{key:"t",value:function(t){var e,n,o=this.config.language||"en";return((null===(e=this.config.translations)||void 0===e?void 0:e[o])||(null===(n=this.config.translations)||void 0===n?void 0:n.en)||{})[t]||t}},{key:"generateHTML",value:function(){var t,e,n,o,i,r,a,c,s,l=this.config.inputPlaceholder||(null===(t=this.config.panel)||void 0===t?void 0:t.inputPlaceholder)||this.t("typeMessage")||"Type your message...";return'<div class="text-interface" id="textInterface">\n      <div class="messages-container" id="messagesContainer">\n        <div class="empty-state">\n          <div class="empty-state-icon">ðŸ’¬</div>\n          <div class="empty-state-title">'.concat(this.t("hello"),'</div>\n          <div class="empty-state-text">').concat(this.t("sendMessage"),'</div>\n        </div>\n      </div>\n      <div class="input-container">\n        <div class="input-wrapper" style="flex:1;">\n          <textarea class="message-input" id="messageInput" placeholder="').concat(l,'" rows="1" dir="').concat(this.config.direction||"ltr",'"></textarea>\n        </div>\n        <button class="send-button" id="sendButton" aria-label="').concat(this.t("sendMessageAria"),'">').concat(this.config.sendButtonText||"âž¤","</button>\n        ").concat(null!==(e=this.config.sendButtonHint)&&void 0!==e&&e.text||null!==(n=this.config.panel)&&void 0!==n&&null!==(n=n.sendButtonHint)&&void 0!==n&&n.text?'\n          <div class="send-button-hint" style="color: '.concat((null===(o=this.config.sendButtonHint)||void 0===o?void 0:o.color)||(null===(i=this.config.panel)||void 0===i||null===(i=i.sendButtonHint)||void 0===i?void 0:i.color)||"#6B7280","; font-size: ").concat((null===(r=this.config.sendButtonHint)||void 0===r?void 0:r.fontSize)||(null===(a=this.config.panel)||void 0===a||null===(a=a.sendButtonHint)||void 0===a?void 0:a.fontSize)||"12px",'; text-align: center; margin-top: 4px;">\n            ').concat((null===(c=this.config.sendButtonHint)||void 0===c?void 0:c.text)||(null===(s=this.config.panel)||void 0===s||null===(s=s.sendButtonHint)||void 0===s?void 0:s.text),"\n          </div>\n        "):"","\n      </div>\n    </div>")}},{key:"generateCSS",value:function(){var t,e,n,o,i,r,a,c,s,l,u,d,p,f=this.config.messages,v=(this.config.panel,this.config.animation,this.config.sendButtonColor||(null===(t=this.config.panel)||void 0===t?void 0:t.sendButtonColor)||"#7C3AED"),h=this.config.sendButtonHoverColor||(null===(e=this.config.panel)||void 0===e?void 0:e.sendButtonHoverColor)||"#6D28D9",g=this.config.sendButtonTextColor||(null===(n=this.config.panel)||void 0===n?void 0:n.sendButtonTextColor)||"#FFFFFF",y=(this.config.inputPlaceholder||null===(o=this.config.panel)||void 0===o||o.inputPlaceholder,this.config.inputBorderColor||(null===(i=this.config.panel)||void 0===i?void 0:i.inputBorderColor)||"#E5E7EB"),m=this.config.inputFocusColor||(null===(r=this.config.panel)||void 0===r?void 0:r.inputFocusColor)||"#7C3AED",b=this.config.inputBackgroundColor||(null===(a=this.config.panel)||void 0===a?void 0:a.inputBackgroundColor)||"#FFFFFF",x=this.config.inputTextColor||(null===(c=this.config.panel)||void 0===c?void 0:c.inputTextColor)||"#1F2937",w=this.config.inputFontSize||(null===(s=this.config.panel)||void 0===s?void 0:s.inputFontSize)||"14px",S=this.config.inputBorderRadius||(null===(l=this.config.panel)||void 0===l?void 0:l.inputBorderRadius)||20,k=this.config.inputPadding||(null===(u=this.config.panel)||void 0===u?void 0:u.inputPadding)||"6px 14px";return"\n      /* Messages container using new classes */\n      #messagesContainer { \n        flex: 1; \n        overflow-y: auto; \n        overflow-x: hidden; \n        padding: 20px; \n        background: #f8fafc; \n        display: flex; \n        flex-direction: column; \n        gap: 16px; \n        min-height: 0; \n      }\n      .empty-state { \n        flex: 1; \n        display: flex; \n        flex-direction: column; \n        align-items: center; \n        justify-content: center; \n        gap: 12px; \n        color: #64748b; \n        text-align: center; \n        padding: 20px; \n      }\n      .empty-state-icon { font-size: 48px; opacity: 0.3; }\n      .empty-state-title { font-size: 20px; font-weight: 700; color: #334155; }\n      .empty-state-text { font-size: 13px; max-width: 280px; }\n\n      .text-interface { \n        display: none; \n        flex: 1; \n        flex-direction: column; \n        min-height: 0; \n        overflow: hidden; \n      }\n      .text-interface.active { display: flex; }\n      \n      .message { \n        display: flex; \n        gap: 8px; \n        padding: 4px 0; \n        max-width: 100%; \n        align-items: center; \n      }\n      .message.edge-left { flex-direction: row; }\n      .message.edge-right { flex-direction: row-reverse; }\n      .message-bubble { \n        padding: 12px; \n        border-radius: ".concat(f.borderRadius,"px; \n        max-width: 80%; \n        font-size: ").concat(f.fontSize,"; \n        color: ").concat(f.textColor,"; \n        word-wrap: break-word; \n        text-align: ").concat("rtl"===this.config.direction?"right":"left","; \n        direction: ").concat(this.config.direction||"ltr",";\n      }\n      .message.user { \n        background: ").concat(f.userBackgroundColor,"; \n        align-self: ").concat("rtl"===this.config.direction?"flex-start":"flex-end","; \n      }\n      .message.agent { \n        background: ").concat(f.agentBackgroundColor,"; \n        align-self: ").concat("rtl"===this.config.direction?"flex-end":"flex-start","; \n      }\n      .message .message-bubble { \n        text-align: ").concat("rtl"===this.config.direction?"right":"left","; \n      }\n      .message-avatar { \n        width: 20px; \n        height: 20px; \n        display: flex; \n        align-items: center; \n        justify-content: center; \n        flex-shrink: 0; \n        color: inherit; \n        font-size: 18px; \n        line-height: 1; \n        background: transparent; \n        border: none; \n      }\n      .message-avatar.user { background: transparent; }\n      .message-avatar.agent { background: transparent; }\n      \n      .message.system {\n        background: ").concat(f.systemBackgroundColor,";\n        align-self: flex-start;\n      }\n      .message.error {\n        background: ").concat(f.errorBackgroundColor,";\n        align-self: flex-start;\n      }\n      \n      .input-container {\n        display: flex;\n        gap: 8px;\n        padding: 12px 16px;\n        background: #FFFFFF;\n        border-top: 1px solid #E5E7EB;\n        align-items: center;\n        flex-shrink: 0;\n        flex-direction: ").concat("rtl"===this.config.direction?"row-reverse":"row",";\n      }\n      \n      .input-wrapper {\n        position: relative;\n        display: flex;\n        align-items: center;\n      }\n      \n      .message-input {\n        width: 100%;\n        min-height: 32px;\n        max-height: 120px;\n        padding: ").concat(k,";\n        border: 1px solid ").concat(y,";\n        border-radius: ").concat(S,"px;\n        font-size: ").concat(w,";\n        font-family: inherit;\n        line-height: 1.3;\n        resize: none;\n        overflow-y: auto;\n        background: ").concat(b,";\n        color: ").concat(x,";\n        vertical-align: top;\n        margin: 0;\n        display: block;\n        white-space: pre-wrap;\n        word-wrap: break-word;\n        text-align: ").concat("rtl"===this.config.direction?"right":"left",";\n        direction: ").concat(this.config.direction||"ltr",";\n        -webkit-appearance: none;\n        appearance: none;\n        box-sizing: border-box;\n      }\n      \n      .message-input:focus {\n        outline: none;\n        border-color: ").concat(m,";\n        background: ").concat("#FFFFFF"===b?"#FFFFFF":b,";\n        box-shadow: 0 0 0 3px ").concat(m,"33;\n      }\n      \n      .message-input::placeholder {\n        color: #9CA3AF;\n        text-align: ").concat("rtl"===this.config.direction?"right":"left",";\n      }\n      \n      .send-button {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        border: none;\n        background: ").concat(v,";\n        color: ").concat(g,";\n        font-size: ").concat(this.config.sendButtonFontSize||(null===(d=this.config.panel)||void 0===d?void 0:d.sendButtonFontSize)||"18px",";\n        font-weight: ").concat(this.config.sendButtonFontWeight||(null===(p=this.config.panel)||void 0===p?void 0:p.sendButtonFontWeight)||"500",";\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n        transition: all 0.2s ease;\n        box-shadow: 0 4px 12px rgba(124, 60, 237, 0.3);\n      }\n      \n      .send-button:hover:not(:disabled) {\n        background: ").concat(h,";\n        transform: scale(1.05);\n        box-shadow: 0 6px 16px rgba(124, 60, 237, 0.4);\n      }\n      \n      .send-button-hint {\n        width: 100%;\n        text-align: center;\n        margin-top: 4px;\n      }\n      \n      .send-button:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n      \n      .typing-indicator {\n        display: inline-flex;\n        gap: 4px;\n        align-items: center;\n      }\n      \n      .typing-dot {\n        width: 6px;\n        height: 6px;\n        border-radius: 50%;\n        background: #64748b;\n        animation: typingDot 1.4s ease-in-out infinite;\n      }\n      \n      .typing-dot:nth-child(2) { animation-delay: 0.2s; }\n      .typing-dot:nth-child(3) { animation-delay: 0.4s; }\n      \n      @keyframes typingDot {\n        0%, 60%, 100% { transform: translateY(0); opacity: 0.7; }\n        30% { transform: translateY(-8px); opacity: 1; }\n      }\n      \n      .error-message {\n        padding: 12px;\n        background: ").concat(f.errorBackgroundColor,";\n        border-radius: ").concat(f.borderRadius,"px;\n        color: #991B1B;\n        font-size: ").concat(f.fontSize,";\n        margin: 8px 0;\n      }\n      \n      @media (max-width: 768px) {\n        #messagesContainer {\n          padding: 12px;\n          gap: 12px;\n        }\n        \n        .message-bubble {\n          max-width: 85%;\n          font-size: 14px;\n          padding: 10px;\n        }\n        \n        .text-input-container {\n          padding: 10px;\n          gap: 8px;\n        }\n        \n        #text-chat-input {\n          font-size: 16px !important; /* Prevents iOS zoom on focus */\n          padding: 10px 14px;\n          min-height: 44px;\n        }\n        \n        #text-chat-send {\n          min-width: 56px;\n          min-height: 44px;\n          width: 56px;\n          height: 44px;\n        }\n        \n        .empty-state-icon {\n          font-size: 40px;\n        }\n        \n        .empty-state-title {\n          font-size: 18px;\n        }\n        \n        .empty-state-text {\n          font-size: 12px;\n        }\n      }\n      \n      @media (max-width: 480px) {\n        #messagesContainer {\n          padding: 10px;\n          gap: 10px;\n        }\n        \n        .message-bubble {\n          max-width: 90%;\n          font-size: 13px;\n          padding: 8px;\n        }\n        \n        .text-input-container {\n          padding: 8px;\n        }\n        \n        #text-chat-input {\n          font-size: 16px !important;\n          padding: 8px 12px;\n        }\n      }\n    ")}},{key:"setupEventHandlers",value:function(){var t=this;console.log("ðŸ”§ TextInterface.setupEventHandlers called",{stack:(new Error).stack.split("\n").slice(1,4).join("\n"),eventHandlersSetup:this.eventHandlersSetup,hasAutoResize:!!this.eventHandlers.autoResize,hasKeydown:!!this.eventHandlers.keydown});var e=document.getElementById("sendButton"),n=document.getElementById("messageInput"),o=document.getElementById("newChatBtn");if(e&&(e.onclick=function(){return t.sendMessage()}),o&&(o.onclick=function(){return t.startNewChat()}),this.updateInputAttributes(),n){var i=n.value,r=n.selectionStart;console.log("ðŸ”§ Input field state:",{value:i,cursorPosition:r,isFocused:document.activeElement===n,hasValue:i.length>0});var a=document.activeElement===n&&n.value.length>0;if(this.eventHandlersSetup&&this.eventHandlers.autoResize&&this.eventHandlers.keydown&&document.getElementById("messageInput")===n&&!a)return void console.log("â­ï¸ Skipping setupEventHandlers - handlers already set up");if(a&&(console.log("âš ï¸ Input is active, skipping handler re-attachment to preserve value"),this.eventHandlers.autoResize&&this.eventHandlers.keydown))return void this.updateInputAttributes();var c=i.length>0;this.eventHandlers.autoResize&&(console.log("ðŸ”§ Removing old autoResize listener"),n.removeEventListener("input",this.eventHandlers.autoResize)),this.eventHandlers.keydown&&(console.log("ðŸ”§ Removing old keydown listener"),n.removeEventListener("keydown",this.eventHandlers.keydown)),c||(n.style.height="32px",n.style.overflow="hidden");var s=function(){var t=n.value;n.style.height="auto";var e=Math.min(n.scrollHeight,120);if(n.style.height=e+"px",n.style.overflowY=e>=120?"auto":"hidden",n.value!==t&&t){console.error("ðŸš¨ VALUE LOST during autoResize!",{before:t,after:n.value});var o=n.selectionStart||t.length;n.value=t,n.setSelectionRange(o,o)}e>=120&&setTimeout(function(){n.scrollTop=n.scrollHeight},0)};this.eventHandlers.autoResize=function(e){var o=e.target||n,i=o.value,r=o.selectionStart||i.length;t._lastInputValue=i,t._lastCursorPosition=r,console.log("ðŸ“ Input event fired:",{value:i,inputId:o.id,type:e.type,savedValue:t._lastInputValue}),s()},n.addEventListener("input",this.eventHandlers.autoResize),console.log("ðŸ”§ Added input listener");var l=function(e){console.log("âŒ¨ï¸ Keydown event:",{key:e.key,inputValue:e.target.value,inputId:e.target.id}),"Enter"!==e.key||e.shiftKey?"Enter"===e.key&&e.shiftKey&&setTimeout(s,0):(e.preventDefault(),t.sendMessage())};this.eventHandlers.keydown=l,n.addEventListener("keydown",l),console.log("ðŸ”§ Added keydown listener"),this.eventHandlersSetup=!0,console.log("âœ… Event handlers set up, preserved value:",i,"cursor:",r),c&&i!==n.value?(console.log("ðŸ”„ Restoring input value:",i,"was:",n.value),n.value=i,setTimeout(function(){n.selectionStart!==r&&n.setSelectionRange(r,r),console.log("âœ… Restored input value and cursor"),s()},0)):c?(console.log("âœ… Value preserved, triggering auto-resize"),setTimeout(s,0)):console.log("â„¹ï¸ No content to preserve")}}},{key:"startNewChat",value:function(){try{localStorage.removeItem("ttp_text_chat_conversation_id")}catch(t){}this.sdk&&(this.sdk.config.conversationId=null);var t=document.getElementById("messagesContainer");t&&(t.innerHTML='\n        <div class="empty-state">\n          <div class="empty-state-icon">ðŸ’¬</div>\n          <div class="empty-state-title">'.concat(this.t("hello"),'</div>\n          <div class="empty-state-text">').concat(this.t("sendMessage"),"</div>\n        </div>"));var e=document.getElementById("messageInput");e&&e.focus()}},{key:"updateInputAttributes",value:function(){var t=document.getElementById("messageInput");if(t){var e;this.lastInputField&&this.lastInputField===t||(this.eventHandlersSetup=!1,this.lastInputField=t);var n=this.config.inputPlaceholder||(null===(e=this.config.panel)||void 0===e?void 0:e.inputPlaceholder)||this.t("typeMessage")||"Type your message...";t.placeholder=n,t.dir=this.config.direction||"ltr",t.style.textAlign="rtl"===this.config.direction?"right":"left"}}},{key:"show",value:function(){var t;console.log("ðŸ“± TextInterface.show called",{stack:(new Error).stack.split("\n").slice(1,4).join("\n"),inputValue:(null===(t=document.getElementById("messageInput"))||void 0===t?void 0:t.value)||""});var e=document.getElementById("textInterface");e&&e.classList.add("active"),setTimeout(function(){var t=document.getElementById("messageInput");console.log("ðŸ“± Focusing input, current value:",(null==t?void 0:t.value)||""),t&&t.focus()},50)}},{key:"hide",value:function(){var t=document.getElementById("textInterface");t&&t.classList.remove("active")}},{key:"startChat",value:(o=he(pe().m(function t(){return pe().w(function(t){for(;;)switch(t.n){case 0:this.isActive=!0,this.updateSendButtonState();case 1:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"sendMessage",value:(n=he(pe().m(function t(){var e,n,o;return pe().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=document.getElementById("messageInput"),n=e.value.trim()){t.n=1;break}return t.a(2);case 1:if(this.isActive){t.n=2;break}return t.n=2,this.startChat();case 2:return this.addMessage("user",n),e.value="",e.style.height="32px",e.style.overflow="hidden",t.p=3,this.beginStreaming(),t.n=4,this.sdk.sendMessage(n);case 4:t.n=6;break;case 5:t.p=5,o=t.v,console.error("âŒ Failed to send message:",o),o&&("DOMAIN_NOT_WHITELISTED"===o.message||o.message&&o.message.includes("Domain not whitelisted"))||this.showError(o),this.stopStreamingState();case 6:return t.a(2)}},t,this,[[3,5]])})),function(){return n.apply(this,arguments)})},{key:"updateSendButtonState",value:function(){var t=document.getElementById("sendButton");t&&(t.disabled=!this.isActive)}},{key:"addMessage",value:function(t,e){var n=document.getElementById("messagesContainer");if(n){var o=n.querySelector(".empty-state");o&&o.remove();var i=document.createElement("div"),r="rtl"===this.config.direction?"user"===t?"edge-left":"edge-right":"user"===t?"edge-right":"edge-left";i.className="message ".concat(t," ").concat(r);var a=document.createElement("div");a.className="message-avatar ".concat(t),a.textContent="user"===t?"ðŸ‘¤":"ðŸ¤–";var c=document.createElement("div");c.className="message-bubble",c.textContent=e,i.appendChild(a),i.appendChild(c),n.appendChild(i),n.scrollTop=n.scrollHeight}}},{key:"beginStreaming",value:function(){var t=document.getElementById("messagesContainer");if(t){this.stopStreamingState();var e=document.createElement("div"),n="rtl"===this.config.direction?"edge-right":"edge-left";e.className="message agent ".concat(n),e.id="agent-streaming";var o=document.createElement("div");o.className="message-avatar agent",o.textContent="ðŸ¤–";var i=document.createElement("div");i.className="message-bubble",i.innerHTML='<span class="typing-indicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></span>',e.appendChild(o),e.appendChild(i),t.appendChild(e),this.streamingEl=i,this.hasStartedStreaming=!1,t.scrollTop=t.scrollHeight}}},{key:"appendStreamingChunk",value:function(t){if(this.streamingEl){this.hasStartedStreaming||(this.streamingEl.textContent="",this.hasStartedStreaming=!0),this.streamingEl.textContent+=t;var e=document.getElementById("messagesContainer");e&&(e.scrollTop=e.scrollHeight)}}},{key:"finalizeStreaming",value:function(t){if(this.streamingEl){this.streamingEl.textContent=t||this.streamingEl.textContent;var e=document.getElementById("agent-streaming");e&&(e.id=""),this.streamingEl=null}this.updateSendButtonState()}},{key:"stopStreamingState",value:function(){var t=document.getElementById("agent-streaming");t&&t.remove(),this.streamingEl=null,this.hasStartedStreaming=!1}},{key:"showError",value:function(t){var e=document.getElementById("messagesContainer");if(e){if(t&&("DOMAIN_NOT_WHITELISTED"===t.message||"string"==typeof t&&t.includes("DOMAIN_NOT_WHITELISTED")||t.message&&t.message.includes("Domain not whitelisted")||"string"==typeof t&&t.includes("Domain not whitelisted"))){var n,o=document.createElement("div");o.className="error-message",o.style.cssText="padding: 16px; margin: 12px; border-radius: 8px; background: "+((null===(n=this.config.messages)||void 0===n?void 0:n.errorBackgroundColor)||"#FEE2E2")+";";var i=document.createElement("div");i.style.cssText="font-weight: 600; font-size: 16px; margin-bottom: 8px; color: #991B1B;",i.textContent=this.t("domainNotValidated");var r=document.createElement("div");r.style.cssText="font-size: 14px; color: #991B1B; line-height: 1.5;",r.textContent=this.t("domainErrorMessage"),o.appendChild(i),o.appendChild(r),e.appendChild(o)}else{var a=document.createElement("div");a.className="error-message",a.textContent="string"==typeof t?t:(null==t?void 0:t.message)||t,e.appendChild(a)}e.scrollTop=e.scrollHeight}}},{key:"setActive",value:function(t){this.isActive=t,this.updateSendButtonState()}}],e&&ge(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o}();const be={en:{landingTitle:"How would you like to communicate?",voiceCall:"Voice Call",textChat:"Text Chat",clickToStartCall:"Click to Start Call",realTimeVoice:"Real-time voice conversation",startCall:"Start Call",listening:"Listening...",speakFreely:"Speak freely",liveTranscript:"Live Transcript",transcriptWillAppear:"Transcript will appear here during the call...",mute:"Mute",speaker:"Speaker",endCall:"End Call",hello:"Hello! How can I help?",sendMessage:"Send a message to get started",online:"Online",newChat:"New Chat",back:"Back",close:"Close",error:"Error",typeMessage:"Type your message...",sendMessageAria:"Send message",domainNotValidated:"Domain not validated",domainErrorMessage:"This domain is not whitelisted. Please contact the administrator to whitelist your website URL."},he:{landingTitle:"××™×š ×ª×¨×¦×” ×œ×ª×§×©×¨?",voiceCall:"×©×™×—×” ×§×•×œ×™×ª",textChat:"×¦'××˜ ×˜×§×¡×˜",clickToStartCall:"×œ×—×¥ ×œ×”×ª×—×œ×ª ×©×™×—×”",realTimeVoice:"×©×™×—×” ×§×•×œ×™×ª ×‘×–×ž×Ÿ ××ž×ª",startCall:"×”×ª×—×œ ×©×™×—×”",listening:"×ž×§×©×™×‘...",speakFreely:"×“×‘×¨ ×‘×—×•×¤×©×™×•×ª",liveTranscript:"×ª×ž×œ×•×œ ×‘×–×ž×Ÿ ××ž×ª",transcriptWillAppear:"×”×ª×ž×œ×•×œ ×™×•×¤×™×¢ ×›××Ÿ ×‘×ž×”×œ×š ×”×©×™×—×”...",mute:"×”×©×ª×§",speaker:"×¨×ž×§×•×œ",endCall:"×¡×™×™× ×©×™×—×”",hello:"×©×œ×•×! ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?",sendMessage:"×©×œ×— ×”×•×“×¢×” ××• ×¢×‘×•×¨ ×œ×ž×¦×‘ ×§×•×œ×™ ×œ×©×™×—×” ×‘×–×ž×Ÿ ××ž×ª",online:"×ž×§×•×•×Ÿ",newChat:"×¦'××˜ ×—×“×©",back:"×—×–×•×¨",close:"×¡×’×•×¨",error:"×©×’×™××”",typeMessage:"×”×§×œ×“ ×”×•×“×¢×”...",sendMessageAria:"×©×œ×— ×”×•×“×¢×”",domainNotValidated:"×“×•×ž×™×™×Ÿ ×œ× ×ž××•×ž×ª",domainErrorMessage:"×“×•×ž×™×™×Ÿ ×–×” ×œ× ×‘×¨×©×™×ž×ª ×”×ž×•×¨×©×™×. ×× × ×¤× ×” ×œ×ž× ×”×œ ×”×ž×¢×¨×›×ª ×›×“×™ ×œ×”×•×¡×™×£ ××ª ×›×ª×•×‘×ª ×”××ª×¨ ×©×œ×š ×œ×¨×©×™×ž×”."},ar:{landingTitle:"ÙƒÙŠÙ ØªØ±ÙŠØ¯ Ø§Ù„ØªÙˆØ§ØµÙ„ØŸ",voiceCall:"Ù…ÙƒØ§Ù„Ù…Ø© ØµÙˆØªÙŠØ©",textChat:"Ø¯Ø±Ø¯Ø´Ø© Ù†ØµÙŠØ©",clickToStartCall:"Ø§Ù†Ù‚Ø± Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",realTimeVoice:"Ù…Ø­Ø§Ø¯Ø«Ø© ØµÙˆØªÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ",startCall:"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",listening:"Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...",speakFreely:"ØªÙƒÙ„Ù… Ø¨Ø­Ø±ÙŠØ©",liveTranscript:"Ù†Øµ Ù…Ø¨Ø§Ø´Ø±",transcriptWillAppear:"Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©...",mute:"ÙƒØªÙ… Ø§Ù„ØµÙˆØª",speaker:"Ù…ÙƒØ¨Ø± Ø§Ù„ØµÙˆØª",endCall:"Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",hello:"Ù…Ø±Ø­Ø¨Ø§! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ",sendMessage:"Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨Ø¯Ø¡",online:"Ù…ØªØµÙ„",newChat:"Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©",back:"Ø±Ø¬ÙˆØ¹",close:"Ø¥ØºÙ„Ø§Ù‚",error:"Ø®Ø·Ø£",typeMessage:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...",sendMessageAria:"Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©",domainNotValidated:"Ø§Ù„Ù†Ø·Ø§Ù‚ ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯",domainErrorMessage:"Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©."},ru:{landingTitle:"ÐšÐ°Ðº Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¾Ð±Ñ‰Ð°Ñ‚ÑŒÑÑ?",voiceCall:"Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹ Ð·Ð²Ð¾Ð½Ð¾Ðº",textChat:"Ð¢ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚",clickToStartCall:"ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð·Ð²Ð¾Ð½Ð¾Ðº",realTimeVoice:"Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹ Ñ€Ð°Ð·Ð³Ð¾Ð²Ð¾Ñ€ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸",startCall:"ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð·Ð²Ð¾Ð½Ð¾Ðº",listening:"Ð¡Ð»ÑƒÑˆÐ°ÑŽ...",speakFreely:"Ð“Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚Ðµ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾",liveTranscript:"Ð–Ð¸Ð²Ð°Ñ Ñ‚Ñ€Ð°Ð½ÑÐºÑ€Ð¸Ð¿Ñ†Ð¸Ñ",transcriptWillAppear:"Ð¢Ñ€Ð°Ð½ÑÐºÑ€Ð¸Ð¿Ñ†Ð¸Ñ Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ Ð·Ð´ÐµÑÑŒ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð·Ð²Ð¾Ð½ÐºÐ°...",mute:"ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐº",speaker:"Ð”Ð¸Ð½Ð°Ð¼Ð¸Ðº",endCall:"Ð—Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð·Ð²Ð¾Ð½Ð¾Ðº",hello:"ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐšÐ°Ðº Ñ Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?",sendMessage:"ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð°",online:"Ð’ ÑÐµÑ‚Ð¸",newChat:"ÐÐ¾Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚",back:"ÐÐ°Ð·Ð°Ð´",close:"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",error:"ÐžÑˆÐ¸Ð±ÐºÐ°",typeMessage:"Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ...",sendMessageAria:"ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",domainNotValidated:"Ð”Ð¾Ð¼ÐµÐ½ Ð½Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½",domainErrorMessage:"Ð­Ñ‚Ð¾Ñ‚ Ð´Ð¾Ð¼ÐµÐ½ Ð½Ðµ Ð² Ð±ÐµÐ»Ð¾Ð¼ ÑÐ¿Ð¸ÑÐºÐµ. ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐ²ÑÐ¶Ð¸Ñ‚ÐµÑÑŒ Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ URL Ð²Ð°ÑˆÐµÐ³Ð¾ Ð²ÐµÐ±-ÑÐ°Ð¹Ñ‚Ð° Ð² ÑÐ¿Ð¸ÑÐ¾Ðº."},es:{landingTitle:"Â¿CÃ³mo te gustarÃ­a comunicarte?",voiceCall:"Llamada de voz",textChat:"Chat de texto",clickToStartCall:"Haz clic para iniciar la llamada",realTimeVoice:"ConversaciÃ³n de voz en tiempo real",startCall:"Iniciar llamada",listening:"Escuchando...",speakFreely:"Habla libremente",liveTranscript:"TranscripciÃ³n en vivo",transcriptWillAppear:"La transcripciÃ³n aparecerÃ¡ aquÃ­ durante la llamada...",mute:"Silenciar",speaker:"Altavoz",endCall:"Terminar llamada",hello:"Â¡Hola! Â¿CÃ³mo puedo ayudarte?",sendMessage:"EnvÃ­a un mensaje para comenzar",online:"En lÃ­nea",newChat:"Nuevo chat",back:"AtrÃ¡s",close:"Cerrar",error:"Error",typeMessage:"Escribe un mensaje...",sendMessageAria:"Enviar mensaje",domainNotValidated:"Dominio no validado",domainErrorMessage:"Este dominio no estÃ¡ en la lista blanca. Por favor, contacte al administrador para agregar la URL de su sitio web a la lista."},fr:{landingTitle:"Comment souhaitez-vous communiquer?",voiceCall:"Appel vocal",textChat:"Chat texte",clickToStartCall:"Cliquez pour dÃ©marrer l'appel",realTimeVoice:"Conversation vocale en temps rÃ©el",startCall:"DÃ©marrer l'appel",listening:"Ã‰coute...",speakFreely:"Parlez librement",liveTranscript:"TranscripciÃ³n en direct",transcriptWillAppear:"La transcription apparaÃ®tra ici pendant l'appel...",mute:"Muet",speaker:"Haut-parleur",endCall:"Terminer l'appel",hello:"Bonjour! Comment puis-je vous aider?",sendMessage:"Envoyez un message pour commencer",online:"En ligne",newChat:"Nouveau chat",back:"Retour",close:"Fermer",error:"Erreur",typeMessage:"Tapez votre message...",sendMessageAria:"Envoyer un message",domainNotValidated:"Domaine non validÃ©",domainErrorMessage:"Ce domaine n'est pas sur la liste blanche. Veuillez contacter l'administrateur pour ajouter l'URL de votre site Web Ã  la liste."},de:{landingTitle:"Wie mÃ¶chten Sie kommunizieren?",voiceCall:"Sprachanruf",textChat:"Text-Chat",clickToStartCall:"Klicken Sie, um den Anruf zu starten",realTimeVoice:"Sprachanruf in Echtzeit",startCall:"Anruf starten",listening:"HÃ¶ren...",speakFreely:"Sprechen Sie frei",liveTranscript:"Live-Transkription",transcriptWillAppear:"Die Transkription erscheint hier wÃ¤hrend des Anrufs...",mute:"Stumm",speaker:"Lautsprecher",endCall:"Anruf beenden",hello:"Hallo! Wie kann ich helfen?",sendMessage:"Senden Sie eine Nachricht zum Starten",online:"Online",newChat:"Neuer Chat",back:"ZurÃ¼ck",close:"SchlieÃŸen",error:"Fehler",typeMessage:"Geben Sie eine Nachricht ein...",sendMessageAria:"Nachricht senden",domainNotValidated:"Domain nicht validiert",domainErrorMessage:"Diese Domain steht nicht auf der Whitelist. Bitte kontaktieren Sie den Administrator, um die URL Ihrer Website zur Liste hinzuzufÃ¼gen."}};function xe(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function r(n,o,i,r){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return we(l,"_invoke",function(n,o,i){var r,c,s,l=0,u=i||[],d=!1,p={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return r=e,c=0,s=t,p.n=n,a}};function f(n,o){for(c=n,s=o,e=0;!d&&l&&!i&&e<u.length;e++){var i,r=u[e],f=p.p,v=r[2];n>3?(i=v===o)&&(s=r[(c=r[4])?5:(c=3,3)],r[4]=r[5]=t):r[0]<=f&&((i=n<2&&f<r[1])?(c=0,p.v=o,p.n=r[1]):f<v&&(i=n<3||r[0]>o||o>v)&&(r[4]=n,r[5]=o,p.n=v,c=0))}if(i||n>1)return a;throw d=!0,o}return function(i,u,v){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,v),c=u,s=v;(e=c<2?t:s)||!d;){r||(c?c<3?(c>1&&(p.n=-1),f(c,s)):p.n=s:p.v=s);try{if(l=2,r){if(c||(i="next"),e=r[i]){if(!(e=e.call(r,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,c<2&&(c=0)}else 1===c&&(e=r.return)&&e.call(r),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);r=t}else if((e=(d=p.n<0)?s:n.call(o,p))!==a)break}catch(e){r=t,c=1,s=e}finally{l=1}}return{value:e,done:d}}}(n,i,r),!0),l}var a={};function c(){}function s(){}function l(){}e=Object.getPrototypeOf;var u=[][o]?e(e([][o]())):(we(e={},o,function(){return this}),e),d=l.prototype=c.prototype=Object.create(u);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,we(t,i,"GeneratorFunction")),t.prototype=Object.create(d),t}return s.prototype=l,we(d,"constructor",l),we(l,"constructor",s),s.displayName="GeneratorFunction",we(l,i,"GeneratorFunction"),we(d),we(d,i,"Generator"),we(d,o,function(){return this}),we(d,"toString",function(){return"[object Generator]"}),(xe=function(){return{w:r,m:p}})()}function we(t,e,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}we=function(t,e,n,o){function r(e,n){we(t,e,function(t){return this._invoke(e,n,t)})}e?i?i(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(r("next",0),r("throw",1),r("return",2))},we(t,e,n,o)}function Se(t,e,n,o,i,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(o,i)}function ke(t){return function(){var e=this,n=arguments;return new Promise(function(o,i){var r=t.apply(e,n);function a(t){Se(r,o,i,a,c,"next",t)}function c(t){Se(r,o,i,a,c,"throw",t)}a(void 0)})}}function Ce(t){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ce(t)}function Ie(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function Ee(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ie(Object(n),!0).forEach(function(e){Oe(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Oe(t,e,n){return(e=Te(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function je(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Te(o.key),o)}}function Te(t){var e=function(t){if("object"!=Ce(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ce(e)?e:e+""}var Pe=function(){return t=function t(){var e,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=this.mergeWithDefaults(o),this.sdk=new Et(this.config),this.isOpen=!1,this.isActive=!1,this.translations=be,this.currentView="landing";var i=Ee(Ee(Ee({},this.config),this.config.voice),{},{language:(null===(e=this.config.voice)||void 0===e?void 0:e.language)||this.config.language||"en",websocketUrl:(null===(n=this.config.voice)||void 0===n?void 0:n.websocketUrl)||this.config.websocketUrl||"wss://speech.talktopc.com/ws/conv",translations:this.translations});this.voiceInterface=new ue(i);var r=Ee(Ee(Ee({},this.config),this.config.text),{},{translations:this.translations});if(this.textInterface=new me(r,this.sdk),this.setupEventHandlers(),this.createWidget(),this.config.behavior.startOpen||this.config.behavior.autoOpen){var a=document.getElementById("text-chat-panel");a&&(this.isOpen=!0,a.classList.add("open"))}},e=[{key:"mergeWithDefaults",value:function(t){var e,n,o,i,r,a,c,s,l,u,d,p,f,v,h,g,y,m,b,x,w,S,k,C,I,E,O,j,T,P,B,F,_,D,R,A,M,z,L,H,V,U,N,K,W,G,Q,q,Y,J,$,X,Z,tt,et,nt,ot,it,rt,at,ct,st,lt,ut,dt,pt,ft,vt,ht,gt,yt,mt,bt,xt,wt,St,kt,Ct,It,Et,Ot,jt,Tt,Pt,Bt,Ft,_t,Dt,Rt,At,Mt,zt,Lt,Ht,Vt,Ut,Nt,Kt,Wt,Gt,Qt,qt,Yt,Jt,$t,Xt,Zt,te,ee,ne,oe,ie,re,ae,ce,se,le,ue,de,pe,fe,ve,he,ge,ye,me,be,xe,we,Se,ke,Ie,Oe,je,Te=t.position||"bottom-right";if("string"==typeof Te){var Pe=Te.split("-");Te={vertical:Pe[0]||"bottom",horizontal:Pe[1]||"right",offset:t.positionOffset||{x:20,y:20}}}var Be=t.primaryColor||(null===(e=t.button)||void 0===e?void 0:e.primaryColor)||(null===(n=t.button)||void 0===n?void 0:n.backgroundColor)||"#7C3AED",Fe=(null===(o=t.header)||void 0===o?void 0:o.backgroundColor)||(null===(i=t.button)||void 0===i?void 0:i.backgroundColor)||Be;return Ee({agentId:t.agentId,appId:t.appId,getSessionUrl:t.getSessionUrl,websocketUrl:t.websocketUrl,demo:!1!==t.demo,direction:t.direction||"ltr",language:t.language||"en",icon:Ee({type:(null===(r=t.icon)||void 0===r?void 0:r.type)||"custom",customImage:(null===(a=t.icon)||void 0===a?void 0:a.customImage)||"https://talktopc.com/logo192.png",emoji:(null===(c=t.icon)||void 0===c?void 0:c.emoji)||"ðŸŽ¤",text:(null===(s=t.icon)||void 0===s?void 0:s.text)||"AI",size:(null===(l=t.icon)||void 0===l?void 0:l.size)||"medium",backgroundColor:(null===(u=t.icon)||void 0===u?void 0:u.backgroundColor)||"#FFFFFF"},t.icon),position:Ee({vertical:Te.vertical||"bottom",horizontal:Te.horizontal||"right",offset:Te.offset||{x:20,y:20}},"object"===Ce(t.position)?t.position:{}),button:Ee({size:(null===(d=t.button)||void 0===d?void 0:d.size)||"medium",shape:(null===(p=t.button)||void 0===p?void 0:p.shape)||"circle",backgroundColor:(null===(f=t.button)||void 0===f?void 0:f.backgroundColor)||(null===(v=t.icon)||void 0===v?void 0:v.backgroundColor)||Be,hoverColor:(null===(h=t.button)||void 0===h?void 0:h.hoverColor)||"#7C3AED",shadow:!1!==(null===(g=t.button)||void 0===g?void 0:g.shadow),shadowColor:(null===(y=t.button)||void 0===y?void 0:y.shadowColor)||"rgba(0,0,0,0.15)",primaryColor:(null===(m=t.button)||void 0===m?void 0:m.backgroundColor)||(null===(b=t.icon)||void 0===b?void 0:b.backgroundColor)||Be},t.button),panel:Ee({width:(null===(x=t.panel)||void 0===x?void 0:x.width)||350,height:(null===(w=t.panel)||void 0===w?void 0:w.height)||500,borderRadius:(null===(S=t.panel)||void 0===S?void 0:S.borderRadius)||12,backgroundColor:(null===(k=t.panel)||void 0===k?void 0:k.backgroundColor)||"#FFFFFF",backdropFilter:(null===(C=t.panel)||void 0===C?void 0:C.backdropFilter)||null,border:(null===(I=t.panel)||void 0===I?void 0:I.border)||"1px solid rgba(0,0,0,0.1)"},t.panel),voice:Ee({micButtonColor:(null===(E=t.voice)||void 0===E?void 0:E.micButtonColor)||(null===(O=t.panel)||void 0===O?void 0:O.micButtonColor)||Be,micButtonActiveColor:(null===(j=t.voice)||void 0===j?void 0:j.micButtonActiveColor)||(null===(T=t.panel)||void 0===T?void 0:T.micButtonActiveColor)||"#EF4444",micButtonHint:Ee(Ee({text:(null===(P=t.voice)||void 0===P||null===(P=P.micButtonHint)||void 0===P?void 0:P.text)||(null===(B=t.panel)||void 0===B||null===(B=B.micButtonHint)||void 0===B?void 0:B.text)||"Click the button to start voice conversation",color:(null===(F=t.voice)||void 0===F||null===(F=F.micButtonHint)||void 0===F?void 0:F.color)||(null===(_=t.panel)||void 0===_||null===(_=_.micButtonHint)||void 0===_?void 0:_.color)||"#6B7280",fontSize:(null===(D=t.voice)||void 0===D||null===(D=D.micButtonHint)||void 0===D?void 0:D.fontSize)||(null===(R=t.panel)||void 0===R||null===(R=R.micButtonHint)||void 0===R?void 0:R.fontSize)||"12px"},null===(A=t.voice)||void 0===A?void 0:A.micButtonHint),null===(M=t.panel)||void 0===M?void 0:M.micButtonHint),avatarBackgroundColor:(null===(z=t.voice)||void 0===z?void 0:z.avatarBackgroundColor)||"#667eea",avatarActiveBackgroundColor:(null===(L=t.voice)||void 0===L?void 0:L.avatarActiveBackgroundColor)||"#667eea",statusTitleColor:(null===(H=t.voice)||void 0===H?void 0:H.statusTitleColor)||"#1e293b",statusSubtitleColor:(null===(V=t.voice)||void 0===V?void 0:V.statusSubtitleColor)||"#64748b",startCallButtonColor:(null===(U=t.voice)||void 0===U?void 0:U.startCallButtonColor)||"#667eea",startCallButtonTextColor:(null===(N=t.voice)||void 0===N?void 0:N.startCallButtonTextColor)||"#FFFFFF",transcriptBackgroundColor:(null===(K=t.voice)||void 0===K?void 0:K.transcriptBackgroundColor)||"#FFFFFF",transcriptTextColor:(null===(W=t.voice)||void 0===W?void 0:W.transcriptTextColor)||"#1e293b",transcriptLabelColor:(null===(G=t.voice)||void 0===G?void 0:G.transcriptLabelColor)||"#94a3b8",controlButtonColor:(null===(Q=t.voice)||void 0===Q?void 0:Q.controlButtonColor)||"#FFFFFF",controlButtonSecondaryColor:(null===(q=t.voice)||void 0===q?void 0:q.controlButtonSecondaryColor)||"#64748b",endCallButtonColor:(null===(Y=t.voice)||void 0===Y?void 0:Y.endCallButtonColor)||"#ef4444",language:(null===(J=t.voice)||void 0===J?void 0:J.language)||t.language||"en",websocketUrl:(null===($=t.voice)||void 0===$?void 0:$.websocketUrl)||t.websocketUrl},t.voice),text:Ee({sendButtonColor:(null===(X=t.text)||void 0===X?void 0:X.sendButtonColor)||(null===(Z=t.panel)||void 0===Z?void 0:Z.sendButtonColor)||"#7C3AED",sendButtonHoverColor:(null===(tt=t.text)||void 0===tt?void 0:tt.sendButtonHoverColor)||(null===(et=t.panel)||void 0===et?void 0:et.sendButtonHoverColor)||"#6D28D9",sendButtonActiveColor:(null===(nt=t.text)||void 0===nt?void 0:nt.sendButtonActiveColor)||(null===(ot=t.panel)||void 0===ot?void 0:ot.sendButtonActiveColor)||"#6D28D9",sendButtonText:(null===(it=t.text)||void 0===it?void 0:it.sendButtonText)||(null===(rt=t.panel)||void 0===rt?void 0:rt.sendButtonText)||"âž¤",sendButtonTextColor:(null===(at=t.text)||void 0===at?void 0:at.sendButtonTextColor)||(null===(ct=t.panel)||void 0===ct?void 0:ct.sendButtonTextColor)||"#FFFFFF",sendButtonFontSize:(null===(st=t.text)||void 0===st?void 0:st.sendButtonFontSize)||(null===(lt=t.panel)||void 0===lt?void 0:lt.sendButtonFontSize)||"18px",sendButtonFontWeight:(null===(ut=t.text)||void 0===ut?void 0:ut.sendButtonFontWeight)||(null===(dt=t.panel)||void 0===dt?void 0:dt.sendButtonFontWeight)||"500",sendButtonHint:Ee(Ee({text:(null===(pt=t.text)||void 0===pt||null===(pt=pt.sendButtonHint)||void 0===pt?void 0:pt.text)||(null===(ft=t.panel)||void 0===ft||null===(ft=ft.sendButtonHint)||void 0===ft?void 0:ft.text)||"",color:(null===(vt=t.text)||void 0===vt||null===(vt=vt.sendButtonHint)||void 0===vt?void 0:vt.color)||(null===(ht=t.panel)||void 0===ht||null===(ht=ht.sendButtonHint)||void 0===ht?void 0:ht.color)||"#6B7280",fontSize:(null===(gt=t.text)||void 0===gt||null===(gt=gt.sendButtonHint)||void 0===gt?void 0:gt.fontSize)||(null===(yt=t.panel)||void 0===yt||null===(yt=yt.sendButtonHint)||void 0===yt?void 0:yt.fontSize)||"12px"},null===(mt=t.text)||void 0===mt?void 0:mt.sendButtonHint),null===(bt=t.panel)||void 0===bt?void 0:bt.sendButtonHint),inputPlaceholder:(null===(xt=t.text)||void 0===xt?void 0:xt.inputPlaceholder)||(null===(wt=t.panel)||void 0===wt?void 0:wt.inputPlaceholder)||"Type your message...",inputBorderColor:(null===(St=t.text)||void 0===St?void 0:St.inputBorderColor)||(null===(kt=t.panel)||void 0===kt?void 0:kt.inputBorderColor)||"#E5E7EB",inputFocusColor:(null===(Ct=t.text)||void 0===Ct?void 0:Ct.inputFocusColor)||(null===(It=t.panel)||void 0===It?void 0:It.inputFocusColor)||"#7C3AED",inputBackgroundColor:(null===(Et=t.text)||void 0===Et?void 0:Et.inputBackgroundColor)||(null===(Ot=t.panel)||void 0===Ot?void 0:Ot.inputBackgroundColor)||"#FFFFFF",inputTextColor:(null===(jt=t.text)||void 0===jt?void 0:jt.inputTextColor)||(null===(Tt=t.panel)||void 0===Tt?void 0:Tt.inputTextColor)||"#1F2937",inputFontSize:(null===(Pt=t.text)||void 0===Pt?void 0:Pt.inputFontSize)||(null===(Bt=t.panel)||void 0===Bt?void 0:Bt.inputFontSize)||"14px",inputBorderRadius:(null===(Ft=t.text)||void 0===Ft?void 0:Ft.inputBorderRadius)||(null===(_t=t.panel)||void 0===_t?void 0:_t.inputBorderRadius)||20,inputPadding:(null===(Dt=t.text)||void 0===Dt?void 0:Dt.inputPadding)||(null===(Rt=t.panel)||void 0===Rt?void 0:Rt.inputPadding)||"6px 14px"},t.text),landing:Ee({backgroundColor:(null===(At=t.landing)||void 0===At?void 0:At.backgroundColor)||"linear-gradient(180deg, #f8fafc 0%, #e0e7ff 100%)",logo:(null===(Mt=t.landing)||void 0===Mt?void 0:Mt.logo)||"ðŸ¤–",title:(null===(zt=t.landing)||void 0===zt?void 0:zt.title)||null,titleColor:(null===(Lt=t.landing)||void 0===Lt?void 0:Lt.titleColor)||"#1e293b",modeCardBackgroundColor:(null===(Ht=t.landing)||void 0===Ht?void 0:Ht.modeCardBackgroundColor)||"#FFFFFF",modeCardBorderColor:(null===(Vt=t.landing)||void 0===Vt?void 0:Vt.modeCardBorderColor)||"#E2E8F0",modeCardHoverBorderColor:(null===(Ut=t.landing)||void 0===Ut?void 0:Ut.modeCardHoverBorderColor)||Fe,modeCardIconBackgroundColor:(null===(Nt=t.landing)||void 0===Nt?void 0:Nt.modeCardIconBackgroundColor)||Fe,modeCardTitleColor:(null===(Kt=t.landing)||void 0===Kt?void 0:Kt.modeCardTitleColor)||"#111827",voiceCardIcon:(null===(Wt=t.landing)||void 0===Wt?void 0:Wt.voiceCardIcon)||"ðŸŽ¤",textCardIcon:(null===(Gt=t.landing)||void 0===Gt?void 0:Gt.textCardIcon)||"ðŸ’¬"},t.landing),header:Ee({title:(null===(Qt=t.header)||void 0===Qt?void 0:Qt.title)||"Chat Assistant",showTitle:!1!==(null===(qt=t.header)||void 0===qt?void 0:qt.showTitle),backgroundColor:(null===(Yt=t.header)||void 0===Yt?void 0:Yt.backgroundColor)||(null===(Jt=t.button)||void 0===Jt?void 0:Jt.backgroundColor)||"#7C3AED",textColor:(null===($t=t.header)||void 0===$t?void 0:$t.textColor)||"#FFFFFF",showCloseButton:!1!==(null===(Xt=t.header)||void 0===Xt?void 0:Xt.showCloseButton)},t.header),tooltips:Ee({newChat:(null===(Zt=t.tooltips)||void 0===Zt?void 0:Zt.newChat)||null,back:(null===(te=t.tooltips)||void 0===te?void 0:te.back)||null,close:(null===(ee=t.tooltips)||void 0===ee?void 0:ee.close)||null,mute:(null===(ne=t.tooltips)||void 0===ne?void 0:ne.mute)||null,speaker:(null===(oe=t.tooltips)||void 0===oe?void 0:oe.speaker)||null,endCall:(null===(ie=t.tooltips)||void 0===ie?void 0:ie.endCall)||null},t.tooltips),messages:Ee({userBackgroundColor:(null===(re=t.messages)||void 0===re?void 0:re.userBackgroundColor)||"#E5E7EB",agentBackgroundColor:(null===(ae=t.messages)||void 0===ae?void 0:ae.agentBackgroundColor)||"#F3F4F6",systemBackgroundColor:(null===(ce=t.messages)||void 0===ce?void 0:ce.systemBackgroundColor)||"#DCFCE7",errorBackgroundColor:(null===(se=t.messages)||void 0===se?void 0:se.errorBackgroundColor)||"#FEE2E2",textColor:(null===(le=t.messages)||void 0===le?void 0:le.textColor)||"#1F2937",fontSize:(null===(ue=t.messages)||void 0===ue?void 0:ue.fontSize)||"14px",borderRadius:(null===(de=t.messages)||void 0===de?void 0:de.borderRadius)||8},t.messages),animation:Ee({enableHover:!1!==(null===(pe=t.animation)||void 0===pe?void 0:pe.enableHover),enablePulse:!1!==(null===(fe=t.animation)||void 0===fe?void 0:fe.enablePulse),enableSlide:!1!==(null===(ve=t.animation)||void 0===ve?void 0:ve.enableSlide),duration:(null===(he=t.animation)||void 0===he?void 0:he.duration)||.3},t.animation),behavior:Ee({autoOpen:(null===(ge=t.behavior)||void 0===ge?void 0:ge.autoOpen)||!1,startOpen:(null===(ye=t.behavior)||void 0===ye?void 0:ye.startOpen)||!1,hidden:(null===(me=t.behavior)||void 0===me?void 0:me.hidden)||!1,autoConnect:(null===(be=t.behavior)||void 0===be?void 0:be.autoConnect)||!1,showWelcomeMessage:!1!==(null===(xe=t.behavior)||void 0===xe?void 0:xe.showWelcomeMessage),welcomeMessage:(null===(we=t.behavior)||void 0===we?void 0:we.welcomeMessage)||"Hello! How can I help you today?",enableVoiceMode:void 0===(null===(Se=t.behavior)||void 0===Se?void 0:Se.enableVoiceMode)||t.behavior.enableVoiceMode,mode:(null===(ke=t.behavior)||void 0===ke?void 0:ke.mode)||"unified"},t.behavior),accessibility:Ee({ariaLabel:(null===(Ie=t.accessibility)||void 0===Ie?void 0:Ie.ariaLabel)||"Chat Assistant",ariaDescription:(null===(Oe=t.accessibility)||void 0===Oe?void 0:Oe.ariaDescription)||"Click to open chat assistant",keyboardNavigation:!1!==(null===(je=t.accessibility)||void 0===je?void 0:je.keyboardNavigation)},t.accessibility),customStyles:t.customStyles||"",variables:t.variables||{},forceConversationId:t.forceConversationId,primaryColor:Be},"string"==typeof t.position?{positionString:t.position}:{})}},{key:"setupEventHandlers",value:function(){var t=this;this.sdk.on("domainError",function(e){t.textInterface.showError(e),t.textInterface.stopStreamingState()}),this.sdk.on("error",function(e){e&&("DOMAIN_NOT_WHITELISTED"===e.message||e.message&&e.message.includes("Domain not whitelisted"))||(t.textInterface.showError(e.message||e),t.textInterface.stopStreamingState())}),this.sdk.on("chunk",function(e){t.textInterface.appendStreamingChunk(e)}),this.sdk.on("done",function(e){var n=e.text;t.textInterface.finalizeStreaming(n)})}},{key:"createWidget",value:function(){console.log("ðŸ—ï¸ TextChatWidget.createWidget called",{stack:(new Error).stack.split("\n").slice(1,4).join("\n"),currentView:this.currentView,hasStoredValue:!!this._preservedInputValue});var t,e=document.getElementById("messageInput"),n="",o=0,i=!1;this._preservedInputValue&&(n=this._preservedInputValue,o=this._preservedCursorPosition||0,i=this._wasInputFocused||!1,console.log("ðŸ’¾ Found previously stored value:",n,"wasFocused:",i)),e?(i=document.activeElement===e,console.log("ðŸ‘ï¸ Input focus state before recreation:",i,"activeElement:",null===(t=document.activeElement)||void 0===t?void 0:t.id),e.value?(n=e.value,o=e.selectionStart||e.value.length||0,console.log("ðŸ’¾ Preserving input value FROM EXISTING INPUT BEFORE widget removal:",n,"cursor:",o)):console.log("â„¹ï¸ Input exists but is empty")):console.log("â„¹ï¸ No existing input element found"),this.textInterface?(console.log("ðŸ” Checking TextInterface for last input value:",{hasTextInterface:!!this.textInterface,lastInputValue:this.textInterface._lastInputValue,lastCursorPosition:this.textInterface._lastCursorPosition}),this.textInterface._lastInputValue?(n=this.textInterface._lastInputValue,o=this.textInterface._lastCursorPosition||0,console.log("ðŸ’¾ Preserving input value FROM TextInterface._lastInputValue (PRIMARY SOURCE):",n,"cursor:",o)):console.log("âš ï¸ TextInterface exists but _lastInputValue is empty")):console.log("âš ï¸ TextInterface is null/undefined"),(n||i)&&(this._preservedInputValue=n,this._preservedCursorPosition=o,this._wasInputFocused=i,console.log("ðŸ’¾ Stored preserved value on instance:",this._preservedInputValue,"cursor:",this._preservedCursorPosition,"wasFocused:",i));var r=document.getElementById("text-chat-widget");r&&(console.log("ðŸ—‘ï¸ Removing existing widget"),r.remove()),!n&&this._preservedInputValue&&(n=this._preservedInputValue,o=this._preservedCursorPosition,console.log("ðŸ’¾ Using preserved value from instance:",n));var a=document.createElement("div");if(a.id="text-chat-widget",a.innerHTML=this.generateWidgetHTML(),document.body.appendChild(a),console.log("âœ… Widget created"),this.setupWidgetEvents(),n||i){console.log("ðŸ”„ Restoring preserved input value:",n,"and focus:",i);var c=document.getElementById("messageInput");c?(n&&(console.log("ðŸ”„ Setting input value IMMEDIATELY to:",n,"current:",c.value),c.value=n),i?(console.log("ðŸ‘ï¸ Restoring focus to input field"),requestAnimationFrame(function(){var t;c.focus(),n&&c.setSelectionRange(o,o),console.log("âœ… Focus restored, activeElement:",null===(t=document.activeElement)||void 0===t?void 0:t.id)})):n&&c.setSelectionRange(o,o),console.log("âœ… Restored input value, new value:",c.value),setTimeout(function(){if(c.scrollHeight>32){c.style.height="auto";var t=Math.min(c.scrollHeight,120);c.style.height=t+"px"}},0)):(console.log("âš ï¸ Could not find new input element to restore value"),setTimeout(function(){var t=document.getElementById("messageInput");t&&n&&(console.log("ðŸ”„ Retrying to restore input value:",n),t.value=n,t.setSelectionRange(o,o),t.focus())},10)),this._preservedInputValue=null,this._preservedCursorPosition=null}if(this.config.behavior.startOpen||this.config.behavior.autoOpen){var s=document.getElementById("text-chat-panel");s&&(this.isOpen=!0,s.classList.add("open"))}}},{key:"generateWidgetHTML",value:function(){var t=this,e=(this.config.position,this.config.button),n=this.config.icon,o=(this.config.panel,this.config.header),i=(this.config.animation,{small:50,medium:60,large:70,xl:80}[e.size]||60),r={small:20,medium:28,large:36,xl:44}[n.size]||28,a=this.generatePositionStyles(),c=this.generateIconHTML(r),s=this.config.behavior.mode||"unified",l="unified"===s,u="unified"===s||"voice-only"===s,d="unified"===s||"text-only"===s,p=function(e){var n=t.config.language||"en";return(t.translations[n]||t.translations.en)[e]||e},f=function(e){var n,o=null===(n=t.config.tooltips)||void 0===n?void 0:n[e];return null!=o?o:{newChat:p("newChat"),back:p("back"),close:p("close"),mute:p("mute"),speaker:p("speaker"),endCall:p("endCall")}[e]||""};return"\n      <style>\n        ".concat(this.generateCSS(a,i,r),"\n        ").concat(this.config.customStyles,"\n      </style>\n      \n      ").concat(this.config.behavior.hidden?"":'\n      <button id="text-chat-button" \n              aria-label="'.concat(this.config.accessibility.ariaLabel,'"\n              aria-description="').concat(this.config.accessibility.ariaDescription,'">\n        ').concat(c,"\n      </button>\n      "),'\n      \n      <div id="text-chat-panel">\n        <div class="widget-shell">\n          <div class="panel-inner widget-container" style="direction: ').concat(this.config.direction,';">\n          <div class="widget-header" style="background: ').concat(o.backgroundColor,"; color: ").concat(o.textColor,';">\n            <div>\n              ').concat(o.showTitle?'<div class="header-title">'.concat(o.title,"</div>"):"",'\n              <div class="header-status">\n                <span class="status-dot"></span>\n                <span>').concat(p("online"),'</span>\n              </div>\n            </div>\n            \n            <div style="display: flex; gap: 12px; align-items: center;">\n              \x3c!-- New Chat Button (hide on landing screen, show otherwise) --\x3e\n              <button class="header-icon new-chat-btn" id="newChatBtn" title="').concat(f("newChat"),'" style="').concat(l?"display: none;":"",'">\n                <span style="font-size: 18px; font-weight: bold;">+</span>\n              </button>\n              \n              \x3c!-- Back Button (only show in unified mode) --\x3e\n              ').concat("unified"===s?'<button class="header-icon back-btn" id="backBtn" title="'.concat(f("back"),'" style="display: none;">\n                <span style="font-size: 16px;">â€¹</span>\n              </button>'):"","\n              \n              \x3c!-- Close Button --\x3e\n              ").concat(o.showCloseButton?'<button class="header-icon close-btn" id="closeBtn" title="'+f("close")+'"><span style="font-size: 18px; font-weight: bold;">Ã—</span></button>':"","\n            </div>\n          </div>\n\n          ").concat(l?'\n          <div class="landing-screen" id="landingScreen">\n            <div class="landing-logo">ðŸ¤–</div>\n            <div class="landing-title">'.concat(p("landingTitle"),'</div>\n            <div class="mode-selection">\n              ').concat(u?'<div class="mode-card voice" id="mode-card-voice">\n                <div class="mode-card-icon">ðŸŽ¤</div>\n                <div class="mode-card-title">'.concat(p("voiceCall"),"</div>\n              </div>"):"","\n              ").concat(d?'<div class="mode-card text" id="mode-card-text">\n                <div class="mode-card-icon">ðŸ’¬</div>\n                <div class="mode-card-title">'.concat(p("textChat"),"</div>\n              </div>"):"","\n            </div>\n          </div>"):"","\n\n          ").concat(u?this.voiceInterface.generateHTML():"","\n          ").concat(d?this.textInterface.generateHTML():"","\n          </div>\n        </div>\n      </div>\n    ")}},{key:"generatePositionStyles",value:function(){var t=this.config.position,e=t.offset||{x:20,y:20},n="";return"top"===t.vertical?n+="top: ".concat(e.y,"px;"):"bottom"===t.vertical?n+="bottom: ".concat(e.y,"px;"):"center"===t.vertical&&(n+="top: 50%; transform: translateY(-50%);"),"left"===t.horizontal?n+="left: ".concat(e.x,"px;"):"right"===t.horizontal?n+="right: ".concat(e.x,"px;"):"center"===t.horizontal&&(n+="left: 50%; transform: translateX(-50%);"),n}},{key:"generateIconHTML",value:function(t){var e=this.config.icon;switch(e.type){case"custom":return'<img src="'.concat(e.customImage,'" alt="Chat Assistant" style="width: ').concat(t,"px; height: ").concat(t,'px; object-fit: contain;" />');case"emoji":return'<span style="font-size: '.concat(t,'px; line-height: 1;">').concat(e.emoji,"</span>");case"text":return'<span style="font-size: '.concat(Math.floor(.6*t),'px; font-weight: bold; color: white;">').concat(e.text,"</span>");case"microphone":default:return'<svg viewBox="0 0 24 24" style="width: '.concat(t,"px; height: ").concat(t,'px; fill: white;">\n          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>\n          <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>\n        </svg>');case"chat":return'<svg viewBox="0 0 24 24" style="width: '.concat(t,"px; height: ").concat(t,'px; fill: white;">\n          <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>\n        </svg>')}}},{key:"generateCSS",value:function(t,e,n){var o,i,r,a,c,s,l,u=this.config.button,d=this.config.icon,p=this.config.panel,f=this.config.header,v=(this.config.messages,this.config.animation),h=this.config.behavior.mode||"unified",g="unified"===h||"voice-only"===h,y="unified"===h||"text-only"===h,m=f.backgroundColor;return'\n      /* MOBILE FIRST - Default styles for all devices */\n      #text-chat-widget {\n        position: fixed !important;\n        z-index: 10000;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        /* Mobile defaults */\n        right: 10px;\n        bottom: 10px;\n        left: auto;\n        top: auto;\n      }\n      \n      /* Desktop positioning (only on larger screens) */\n      @media (min-width: 769px) {\n        #text-chat-widget {\n          '.concat(t,"\n          right: ").concat("right"===this.config.position.horizontal?"20px":"auto",";\n          left: ").concat("left"===this.config.position.horizontal?"20px":"auto",";\n          bottom: ").concat("bottom"===this.config.position.vertical?"20px":"auto",";\n          top: ").concat("top"===this.config.position.vertical?"20px":"auto",";\n        }\n      }\n      \n      /* Mobile override (force mobile positioning) */\n      @media (max-width: 768px) {\n        #text-chat-widget {\n          right: 10px !important;\n          bottom: 10px !important;\n          left: auto !important;\n          top: auto !important;\n          transform: none !important;\n        }\n      }\n      \n      @media (max-width: 480px) {\n        #text-chat-widget {\n          right: 8px !important;\n          bottom: 8px !important;\n          left: auto !important;\n          top: auto !important;\n        }\n      }\n      \n      #text-chat-button {\n        width: ").concat(e,"px;\n        height: ").concat(e,"px;\n        border-radius: ").concat("circle"===u.shape?"50%":"square"===u.shape?"0":"12px",";\n        background: ").concat(u.backgroundColor||d.backgroundColor||"#7C3AED",";\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all ").concat(v.duration,"s ease;\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        touch-action: manipulation;\n        -webkit-tap-highlight-color: transparent;\n        -webkit-touch-callout: none;\n        user-select: none;\n        min-width: 44px;\n        min-height: 44px;\n      }\n      \n      @media (max-width: 768px) {\n        #text-chat-widget {\n          right: 10px !important;\n          bottom: 10px !important;\n          left: auto !important;\n          top: auto !important;\n          transform: none !important;\n        }\n        \n        #text-chat-button {\n          width: 56px !important;\n          height: 56px !important;\n          min-width: 56px !important;\n          min-height: 56px !important;\n          max-width: 56px !important;\n          max-height: 56px !important;\n        }\n        \n        #text-chat-panel {\n          position: fixed !important;\n          left: 10px !important;\n          right: 10px !important;\n          bottom: 76px !important; /* 56px button + 20px gap */\n          top: 60px !important; /* Add top spacing */\n          width: auto !important;\n          max-width: none !important;\n          height: auto !important; /* Change from max-height to auto */\n          max-height: none !important; /* Remove max-height */\n          transform: none !important;\n          margin: 0 !important;\n        }\n        \n        #text-chat-panel .widget-header {\n          padding: 10px 14px;\n          min-height: 56px;\n        }\n        \n        #text-chat-panel .header-title {\n          font-size: 15px;\n        }\n        \n        #text-chat-panel .header-icon {\n          width: 40px;\n          height: 40px;\n          min-width: 40px;\n          min-height: 40px;\n        }\n        \n        #text-chat-input {\n          font-size: 16px !important; /* Prevents iOS zoom on focus */\n          padding: 12px 16px !important;\n          min-height: 48px !important;\n        }\n        \n        #text-chat-send {\n          min-width: 48px !important;\n          min-height: 48px !important;\n          width: 48px !important;\n          height: 48px !important;\n        }\n        \n        .landing-screen {\n          padding: 16px;\n        }\n        \n        .landing-logo {\n          font-size: 40px;\n        }\n        \n        .landing-title {\n          font-size: 18px;\n          margin-bottom: 16px;\n        }\n        \n        .mode-selection {\n          flex-direction: column;\n          gap: 12px;\n          align-items: center;\n        }\n        \n        .mode-card {\n          max-width: 100%;\n          width: 100%;\n          padding: 16px;\n        }\n        \n        .mode-card-icon {\n          width: 50px;\n          height: 50px;\n          font-size: 28px;\n        }\n        \n        .mode-card-title {\n          font-size: 14px;\n        }\n      }\n      \n      @media (max-width: 480px) {\n        #text-chat-widget {\n          right: 8px !important;\n          bottom: 8px !important;\n          left: auto !important;\n          top: auto !important;\n        }\n        \n        #text-chat-button {\n          width: 54px !important;\n          height: 54px !important;\n          min-width: 54px !important;\n          min-height: 54px !important;\n        }\n        \n        #text-chat-panel {\n          left: 8px !important;\n          right: 8px !important;\n          bottom: 70px !important;\n          top: 50px !important; /* Add top spacing for very small screens */\n          height: auto !important;\n          max-height: none !important;\n        }\n        \n        #text-chat-panel .widget-header {\n          padding: 8px 12px;\n          min-height: 52px;\n        }\n        \n        #text-chat-panel .header-title {\n          font-size: 14px;\n        }\n        \n        .landing-logo {\n          font-size: 36px;\n        }\n        \n        .landing-title {\n          font-size: 16px;\n        }\n      }\n      \n      ").concat(v.enableHover?"\n        #text-chat-button:hover {\n          background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);\n          transform: scale(1.05);\n          box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);\n        }\n      ":"","\n      \n      #text-chat-panel {\n        display: none;\n        position: fixed;\n        bottom: calc(").concat(e,"px + 20px);\n        ").concat("right"===this.config.position.horizontal?"right: 20px;":"left: 20px;","\n        width: ").concat(p.width,"px;\n        max-width: calc(100vw - 40px);\n        height: ").concat(p.height,"px;\n        max-height: calc(100vh - ").concat(e,"px - 40px);\n        background: transparent;\n        border-radius: ").concat(p.borderRadius,"px;\n        border: none;\n        flex-direction: column;\n        overflow: hidden;\n        ").concat(p.backdropFilter?"backdrop-filter: ".concat(p.backdropFilter,";"):"","\n        ").concat(v.enableSlide?"transition: all ".concat(v.duration,"s ease;"):"","\n        box-sizing: border-box;\n      }\n      \n      #text-chat-panel.open {\n        display: flex;\n        ").concat(v.enableSlide?"transform: translateY(0); opacity: 1;":"","\n      }\n\n      /* Shell for gradient border/background */\n      .widget-shell { width: 100%; height: 100%; padding: 0; border-radius: ").concat(p.borderRadius,"px; background: transparent; box-shadow: 0 20px 60px rgba(0,0,0,0.15); overflow: hidden; display: flex; flex-direction: column; box-sizing: border-box; }\n      .panel-inner { width: 100%; height: 100%; background: #ffffff; border-radius: ").concat(p.borderRadius,"px; overflow: hidden; display:flex; flex-direction: column; padding: 0; box-sizing: border-box; max-width: 100%; }\n\n      /* New structure styles matching provided design */\n      #text-chat-panel .widget-container {\n        width: 100%; height: 100%; min-height: 0; background: #FFFFFF; overflow: hidden; display: flex; flex-direction: column; border-radius: ").concat(p.borderRadius,"px;\n      }\n      #text-chat-panel .widget-header {\n        padding: 12px 16px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-top-left-radius: ").concat(p.borderRadius,"px;\n        border-top-right-radius: ").concat(p.borderRadius,"px;\n        flex-shrink: 0;\n        min-height: 60px;\n        box-sizing: border-box;\n      }\n      #text-chat-panel .header-title { font-size: 16px; font-weight: 600; }\n      #text-chat-panel .header-status { display: flex; align-items: center; gap: 8px; font-size: 12px; opacity: 0.9; }\n      #text-chat-panel .status-dot { width: 8px; height: 8px; background: #4ade80; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }\n      @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\n      /* Header icon buttons */\n      .header-icon {\n        background: rgba(255, 255, 255, 0.2);\n        border: none;\n        color: white;\n        width: 36px;\n        height: 36px;\n        min-width: 36px;\n        min-height: 36px;\n        border-radius: 50%;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background 0.2s;\n        flex-shrink: 0;\n        font-size: 16px;\n        padding: 0;\n        box-sizing: border-box;\n      }\n      \n      .header-icon:hover {\n        background: rgba(255, 255, 255, 0.3);\n      }\n      \n      .header-icon svg {\n        pointer-events: none;\n        stroke: white;\n        fill: none;\n      }\n      \n      .back-btn.visible {\n        display: flex !important;\n      }\n\n      /* Landing and mode selection (shown only if voice enabled) */\n      .landing-screen { \n        display: none; \n        flex: 1; \n        padding: 20px; \n        background: ").concat((null===(o=this.config.landing)||void 0===o?void 0:o.backgroundColor)||"linear-gradient(180deg, #f8fafc 0%, #e0e7ff 100%)","; \n        align-items: center; \n        justify-content: flex-start; \n        flex-direction: column; \n        gap: 16px; \n        overflow-y: auto; \n        min-height: 0; \n      }\n      .landing-screen.active { display: flex; }\n      .landing-logo { font-size: 48px; }\n      .landing-title { \n        font-size: 20px; \n        color: ").concat((null===(i=this.config.landing)||void 0===i?void 0:i.titleColor)||"#1e293b","; \n        font-weight: 700; \n        margin-bottom: 20px; \n        text-align: center;\n        width: 100%;\n      }\n      .mode-selection { display: flex; gap: 16px; width: 100%; justify-content: center; }\n      .mode-card { \n        flex: 1; \n        max-width: 180px; \n        background: ").concat((null===(r=this.config.landing)||void 0===r?void 0:r.modeCardBackgroundColor)||"#FFFFFF","; \n        border: 2px solid ").concat((null===(a=this.config.landing)||void 0===a?void 0:a.modeCardBorderColor)||"#E2E8F0","; \n        border-radius: 20px; \n        padding: 20px 12px; \n        cursor: pointer; \n        display: flex; \n        flex-direction: column; \n        align-items: center; \n        gap: 8px; \n        transition: transform ").concat(v.duration,"s ease, box-shadow ").concat(v.duration,"s ease, border-color ").concat(v.duration,"s ease; \n        box-shadow: 0 4px 12px rgba(0,0,0,0.05); \n      }\n      .mode-card:hover { \n        transform: translateY(-6px); \n        box-shadow: 0 12px 24px rgba(102, 126, 234, 0.2); \n        border-color: ").concat((null===(c=this.config.landing)||void 0===c?void 0:c.modeCardHoverBorderColor)||m,"; \n      }\n      .mode-card-icon { \n        width: 60px; \n        height: 60px; \n        display: flex; \n        align-items: center; \n        justify-content: center; \n        border-radius: 50%; \n        background: ").concat((null===(s=this.config.landing)||void 0===s?void 0:s.modeCardIconBackgroundColor)||m,"; \n        color: #fff; \n        font-size: 32px; \n      }\n      .mode-card-title { \n        color: ").concat((null===(l=this.config.landing)||void 0===l?void 0:l.modeCardTitleColor)||"#111827","; \n        font-weight: 600; \n        text-align: center;\n        width: 100%;\n      }\n\n      ").concat(g?this.voiceInterface.generateCSS():"","\n      ").concat(y?this.textInterface.generateCSS():"","\n      \n      #text-chat-send-hint {\n        text-align: center;\n        line-height: 1.4;\n      }\n      \n      .agent-thinking {\n        font-style: italic;\n        color: #6B7280;\n      }\n    ")}},{key:"setupWidgetEvents",value:function(){var t=this;console.log("âš™ï¸ TextChatWidget.setupWidgetEvents called",{stack:(new Error).stack.split("\n").slice(1,4).join("\n"),currentView:this.currentView});var e=document.getElementById("text-chat-button");e&&(e.onclick=function(){return t.togglePanel()});var n=document.getElementById("closeBtn");n&&(n.onclick=function(){return t.togglePanel()});var o=this.config.behavior.mode||"unified",i="unified"===o,r="unified"===o||"voice-only"===o,a="unified"===o||"text-only"===o,c=document.getElementById("backBtn"),s=document.getElementById("landingScreen"),l=document.getElementById("mode-card-voice"),u=document.getElementById("mode-card-text"),d=document.getElementById("textInterface"),p=document.getElementById("voiceInterface");c&&(c.onclick=function(){return t.showLanding()}),i?(l&&(l.onclick=function(){return t.showVoice()}),u&&(u.onclick=function(){return t.showText()}),"text"===this.currentView?(s&&s.classList.remove("active"),d&&d.classList.add("active"),p&&p.classList.remove("active"),c&&"unified"===o&&c.classList.add("visible"),f&&(f.style.display="")):"voice"===this.currentView?(s&&s.classList.remove("active"),d&&d.classList.remove("active"),p&&p.classList.add("active"),c&&"unified"===o&&c.classList.add("visible"),f&&(f.style.display="none")):(this.currentView="landing",s&&s.classList.add("active"),d&&d.classList.remove("active"),p&&p.classList.remove("active"),c&&"unified"===o&&c.classList.remove("visible"))):"voice-only"===o?(p&&p.classList.add("active"),d&&d.classList.remove("active"),s&&s.classList.remove("active")):"text-only"===o&&(d&&d.classList.add("active"),p&&p.classList.remove("active"),s&&s.classList.remove("active")),r&&(console.log("âš™ï¸ Setting up voice interface event handlers"),this.voiceInterface.setupEventHandlers()),a&&(console.log("âš™ï¸ Setting up text interface event handlers"),this.textInterface.setupEventHandlers());var f=document.getElementById("newChatBtn");f&&(f.onclick=function(){return t.textInterface.startNewChat()},i&&(f.style.display="none")),this.config.accessibility.keyboardNavigation&&this.setupKeyboardNavigation()}},{key:"startNewChat",value:function(){this.textInterface.startNewChat()}},{key:"showLanding",value:function(){if("unified"===(this.config.behavior.mode||"unified")){this.currentView="landing";var t=document.getElementById("landingScreen"),e=document.getElementById("textInterface"),n=document.getElementById("voiceInterface"),o=document.getElementById("backBtn"),i=document.getElementById("newChatBtn");t&&t.classList.add("active"),e&&e.classList.remove("active"),n&&n.classList.remove("active"),o&&o.classList.remove("visible"),i&&(i.style.display="none")}}},{key:"showText",value:function(){this.currentView="text";var t=document.getElementById("landingScreen"),e=document.getElementById("voiceInterface"),n=document.getElementById("backBtn"),o=document.getElementById("newChatBtn");t&&t.classList.remove("active"),e&&e.classList.remove("active"),this.textInterface.show();var i=this.config.behavior.mode||"unified";n&&"unified"===i&&n.classList.add("visible"),o&&(o.style.display="")}},{key:"showVoice",value:function(){this.currentView="voice";var t=document.getElementById("landingScreen"),e=document.getElementById("textInterface"),n=document.getElementById("voiceInterface"),o=document.getElementById("backBtn"),i=document.getElementById("newChatBtn");t&&t.classList.remove("active"),e&&e.classList.remove("active"),n&&n.classList.add("active");var r=this.config.behavior.mode||"unified";o&&"unified"===r&&o.classList.add("visible"),i&&(i.style.display="none")}},{key:"setupKeyboardNavigation",value:function(){var t=this;document.addEventListener("keydown",function(e){"Escape"===e.key&&t.isOpen&&t.togglePanel()})}},{key:"togglePanel",value:function(){this.isOpen=!this.isOpen,document.getElementById("text-chat-panel").classList.toggle("open"),this.isOpen&&setTimeout(function(){var t=document.getElementById("messageInput");t&&t.focus()},100),this.isOpen&&!this.isActive&&this.config.behavior.autoConnect&&this.startChat()}},{key:"startChat",value:(r=ke(xe().m(function t(){return xe().w(function(t){for(;;)switch(t.n){case 0:this.isActive=!0,this.textInterface.setActive(!0);case 1:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"sendMessage",value:(i=ke(xe().m(function t(){return xe().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.textInterface.sendMessage();case 1:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"updateSendButtonState",value:function(){this.textInterface.updateSendButtonState()}},{key:"getSignedUrl",value:(o=ke(xe().m(function t(){var e,n,o,i,r,a,c;return xe().w(function(t){for(;;)switch(t.n){case 0:if(this.config.getSessionUrl){t.n=2;break}if(this.config.agentId){t.n=1;break}throw new Error("agentId is required");case 1:return e=this.config.websocketUrl||"wss://backend.talktopc.com/ws/conv",(n=new URLSearchParams).append("agentId",this.config.agentId),this.config.appId&&n.append("appId",this.config.appId),!1!==this.config.demo&&n.append("demo","true"),t.a(2,"".concat(e,"?").concat(n.toString()));case 2:if("string"!=typeof this.config.getSessionUrl){t.n=6;break}return o={agentId:this.config.agentId,variables:this.config.variables||{}},this.config.appId&&(o.appId=this.config.appId),t.n=3,fetch(this.config.getSessionUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});case 3:if((i=t.v).ok){t.n=4;break}throw new Error("Failed to get session URL: ".concat(i.statusText));case 4:return t.n=5,i.json();case 5:return r=t.v,t.a(2,r.signedUrl||r.wsUrl||r.url);case 6:if("function"!=typeof this.config.getSessionUrl){t.n=8;break}return a={agentId:this.config.agentId,variables:this.config.variables||{}},this.config.appId&&(a.appId=this.config.appId),t.n=7,this.config.getSessionUrl(a);case 7:return c=t.v,t.a(2,"string"==typeof c?c:c.signedUrl||c.wsUrl||c.url);case 8:throw new Error("getSessionUrl must be a string (backend URL), a function, or omitted (for direct connection with agentId/appId)");case 9:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"addMessage",value:function(t,e){this.textInterface.addMessage(t,e)}},{key:"beginStreaming",value:function(){this.textInterface.beginStreaming()}},{key:"appendStreamingChunk",value:function(t){this.textInterface.appendStreamingChunk(t)}},{key:"finalizeStreaming",value:function(t){this.textInterface.finalizeStreaming(t)}},{key:"stopStreamingState",value:function(){this.textInterface.stopStreamingState()}},{key:"showError",value:function(t){this.textInterface.showError(t)}},{key:"updateStatus",value:function(t){}},{key:"updateConfig",value:function(t){var e,n,o,i,r=Ee({},this.config);t.panel&&(r.panel=Ee(Ee({},this.config.panel),t.panel)),t.voice&&(r.voice=Ee(Ee({},this.config.voice),t.voice),t.voice.micButtonHint&&(r.voice.micButtonHint=Ee(Ee({},null===(o=this.config.voice)||void 0===o?void 0:o.micButtonHint),t.voice.micButtonHint))),t.text&&(r.text=Ee(Ee({},this.config.text),t.text),t.text.sendButtonHint&&(r.text.sendButtonHint=Ee(Ee({},null===(i=this.config.text)||void 0===i?void 0:i.sendButtonHint),t.text.sendButtonHint))),void 0!==t.language&&(r.language=t.language),void 0!==t.language&&(["he","ar"].includes(t.language)?r.direction="rtl":void 0===t.direction&&(r.direction="ltr")),t.translations&&(r.translations=t.translations,this.translations=t.translations),t.button&&(r.button=Ee(Ee({},this.config.button),t.button)),t.header&&(r.header=Ee(Ee({},this.config.header),t.header)),t.icon&&(r.icon=Ee(Ee({},this.config.icon),t.icon)),t.messages&&(r.messages=Ee(Ee({},this.config.messages),t.messages)),t.animation&&(r.animation=Ee(Ee({},this.config.animation),t.animation)),t.behavior&&(r.behavior=Ee(Ee({},this.config.behavior),t.behavior)),t.accessibility&&(r.accessibility=Ee(Ee({},this.config.accessibility),t.accessibility)),t.tooltips&&(r.tooltips=Ee(Ee({},this.config.tooltips),t.tooltips)),t.landing&&(r.landing=Ee(Ee({},this.config.landing),t.landing)),void 0!==t.direction&&void 0===r.direction&&(r.direction=t.direction),void 0!==t.primaryColor&&(r.primaryColor=t.primaryColor),Object.keys(t).forEach(function(e){["panel","button","header","icon","messages","direction","voice","text","animation","behavior","accessibility","language","tooltips","landing","primaryColor"].includes(e)||(r[e]=t[e])}),null===(e=this.config)||void 0===e||e.language,this.config=this.mergeWithDefaults(r);var a="",c=0;if(this.textInterface){this.textInterface._lastInputValue&&(a=this.textInterface._lastInputValue,c=this.textInterface._lastCursorPosition||0,console.log("ðŸ’¾ Preserving input value from OLD TextInterface before recreation:",a));var s=document.getElementById("messageInput");s&&s.value&&(a=s.value,c=s.selectionStart||s.value.length||0,console.log("ðŸ’¾ Preserving input value from actual input element:",a))}a&&(this._preservedInputValue=a,this._preservedCursorPosition=c,console.log("ðŸ’¾ Stored input value on widget instance BEFORE recreating interfaces:",this._preservedInputValue));var l=this.config.language||"en",u=Ee(Ee(Ee({},this.config),this.config.voice),{},{language:l,websocketUrl:(null===(n=this.config.voice)||void 0===n?void 0:n.websocketUrl)||this.config.websocketUrl||"wss://speech.talktopc.com/ws/conv",translations:this.translations});this.voiceInterface=new ue(u);var d=Ee(Ee(Ee({},this.config),this.config.text),{},{language:l,translations:this.translations});this.textInterface=new me(d,this.sdk),a&&(this.textInterface._lastInputValue=a,this.textInterface._lastCursorPosition=c,console.log("ðŸ’¾ Restored input value to NEW TextInterface instance:",this.textInterface._lastInputValue));var p=document.getElementById("text-chat-widget");p&&p.remove(),this.createWidget(),this.textInterface&&this.textInterface.updateInputAttributes&&this.textInterface.updateInputAttributes()}},{key:"destroy",value:function(){var t=document.getElementById("text-chat-widget");t&&t.remove(),this.sdk&&this.sdk.destroy(),this.voiceInterface&&this.voiceInterface.destroy()}},{key:"startVoiceCall",value:(n=ke(xe().m(function t(){return xe().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.voiceInterface.startVoiceCall();case 1:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"endVoiceCall",value:function(){this.voiceInterface.endVoiceCall()}},{key:"toggleMute",value:function(){this.voiceInterface.toggleMute()}},{key:"toggleSpeaker",value:function(){this.voiceInterface.toggleSpeaker()}}],e&&je(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,o,i,r}(),Be="2.0.0";const Fe={VoiceSDK:ft,TextChatSDK:Et,WebSocketManager:B,AudioRecorder:N,AudioPlayer:Z,EventEmitter:c,VoiceButton:zt,VanillaVoiceButton:qt,AgentSDK:ne,TTPChatWidget:Pe,VERSION:Be};return o})());
//# sourceMappingURL=agent-widget.js.map