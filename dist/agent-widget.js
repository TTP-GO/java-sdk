/*! For license information please see agent-widget.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TTPAgentSDK=e():t.TTPAgentSDK=e()}(this,()=>(()=>{"use strict";var t={540:(t,e,n)=>{n(869)},698:(t,e)=>{Symbol.for("react.transitional.element");Symbol.for("react.fragment")},848:(t,e,n)=>{n(698)},869:(t,e)=>{Symbol.for("react.transitional.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.consumer"),Symbol.for("react.context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.activity"),Symbol.iterator;var n={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},o=Object.assign,r={};function c(t,e,o){this.props=t,this.context=e,this.refs=r,this.updater=o||n}function i(){}function a(t,e,o){this.props=t,this.context=e,this.refs=r,this.updater=o||n}c.prototype.isReactComponent={},c.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},c.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},i.prototype=c.prototype;var s=a.prototype=new i;s.constructor=a,o(s,c.prototype),s.isPureReactComponent=!0;Array.isArray;Object.prototype.hasOwnProperty;"function"==typeof reportError&&reportError}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var c=e[o]={exports:{}};return t[o](c,c.exports,n),c.exports}n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var o={};function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function c(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function i(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,i,a=[],s=!0,u=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=c.call(n)).done)&&(a.push(o.value),a.length!==e);s=!0);}catch(t){u=!0,r=t}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw r}}return a}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=l(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){a=!0,c=t},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw c}}}}function l(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function y(){var t,e,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function c(n,o,r,c){var s=o&&o.prototype instanceof a?o:a,u=Object.create(s.prototype);return p(u,"_invoke",function(n,o,r){var c,a,s,u=0,l=r||[],f=!1,y={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return c=e,a=0,s=t,y.n=n,i}};function p(n,o){for(a=n,s=o,e=0;!f&&u&&!r&&e<l.length;e++){var r,c=l[e],p=y.p,b=c[2];n>3?(r=b===o)&&(s=c[(a=c[4])?5:(a=3,3)],c[4]=c[5]=t):c[0]<=p&&((r=n<2&&p<c[1])?(a=0,y.v=o,y.n=c[1]):p<b&&(r=n<3||c[0]>o||o>b)&&(c[4]=n,c[5]=o,y.n=b,a=0))}if(r||n>1)return i;throw f=!0,o}return function(r,l,b){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,b),a=l,s=b;(e=a<2?t:s)||!f;){c||(a?a<3?(a>1&&(y.n=-1),p(a,s)):y.n=s:y.v=s);try{if(u=2,c){if(a||(r="next"),e=c[r]){if(!(e=e.call(c,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,a<2&&(a=0)}else 1===a&&(e=c.return)&&e.call(c),a<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),a=1);c=t}else if((e=(f=y.n<0)?s:n.call(o,y))!==i)break}catch(e){c=t,a=1,s=e}finally{u=1}}return{value:e,done:f}}}(n,r,c),!0),u}var i={};function a(){}function s(){}function u(){}e=Object.getPrototypeOf;var l=[][o]?e(e([][o]())):(p(e={},o,function(){return this}),e),f=u.prototype=a.prototype=Object.create(l);function b(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,p(t,r,"GeneratorFunction")),t.prototype=Object.create(f),t}return s.prototype=u,p(f,"constructor",u),p(u,"constructor",s),s.displayName="GeneratorFunction",p(u,r,"GeneratorFunction"),p(f),p(f,r,"Generator"),p(f,o,function(){return this}),p(f,"toString",function(){return"[object Generator]"}),(y=function(){return{w:c,m:b}})()}function p(t,e,n,o){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}p=function(t,e,n,o){function c(e,n){p(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(c("next",0),c("throw",1),c("return",2))},p(t,e,n,o)}function b(t,e,n,o,r,c,i){try{var a=t[c](i),s=a.value}catch(t){return void n(t)}a.done?e(s):Promise.resolve(s).then(o,r)}function v(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,h(o.key),o)}}function h(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}function d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(d=function(){return!!t})()}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}function g(t,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},g(t,e)}function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function w(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,C(o.key),o)}}function C(t){var e=function(t){if("object"!=S(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==S(e)?e:e+""}n.d(o,{default:()=>j}),new(function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=function(t,e,n){return e=m(e),function(t,e){if(e&&("object"==a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,d()?Reflect.construct(e,n||[],m(t).constructor):e.apply(t,n))}(this,e)).connections=new Map,t.connectionCounts=new Map,t.creatingConnections=new Set,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&g(t,e)}(e,t),n=e,o=[{key:"getConnection",value:(r=y().m(function t(e){var n,o,r=this;return y().w(function(t){for(;;)switch(t.n){case 0:if(!this.connections.has(e)){t.n=1;break}return n=this.connections.get(e),this.connectionCounts.set(e,(this.connectionCounts.get(e)||0)+1),console.log("ðŸ”Œ WebSocketSingleton: Reusing existing connection for ".concat(e," (").concat(this.connectionCounts.get(e)," subscribers)")),t.a(2,n);case 1:if(!this.creatingConnections||!this.creatingConnections.has(e)){t.n=2;break}return console.log("ðŸ”Œ WebSocketSingleton: Connection already being created for ".concat(e,", waiting...")),t.a(2,new Promise(function(t){var n=function(){if(r.connections.has(e)){var o=r.connections.get(e);r.connectionCounts.set(e,(r.connectionCounts.get(e)||0)+1),console.log("ðŸ”Œ WebSocketSingleton: Got existing connection after wait for ".concat(e," (").concat(r.connectionCounts.get(e)," subscribers)")),t(o)}else setTimeout(n,50)};n()}));case 2:return console.log("ðŸ”Œ WebSocketSingleton: Creating new connection for ".concat(e)),this.creatingConnections.add(e),o=new WebSocket(e),this.connections.set(e,o),this.connectionCounts.set(e,1),o.addEventListener("open",function(t){console.log("ðŸ”Œ WebSocketSingleton: Connection opened for ".concat(e)),r.creatingConnections.delete(e),r.emit("open",t,e)}),o.addEventListener("close",function(t){console.log("ðŸ”Œ WebSocketSingleton: Connection closed for ".concat(e," (Code: ").concat(t.code,")")),r.creatingConnections.delete(e),r.connections.delete(e),r.connectionCounts.delete(e),r.emit("close",t,e)}),o.addEventListener("error",function(t){console.log("ðŸ”Œ WebSocketSingleton: Connection error for ".concat(e),t),r.creatingConnections.delete(e),r.emit("error",t,e)}),o.addEventListener("message",function(t){r.emit("message",t,e)}),t.a(2,o)}},t,this)}),c=function(){var t=this,e=arguments;return new Promise(function(n,o){var c=r.apply(t,e);function i(t){b(c,n,o,i,a,"next",t)}function a(t){b(c,n,o,i,a,"throw",t)}i(void 0)})},function(t){return c.apply(this,arguments)})},{key:"releaseConnection",value:function(t){if(this.connections.has(t)){var e=this.connectionCounts.get(t)||0,n=Math.max(0,e-1);if(this.connectionCounts.set(t,n),console.log("ðŸ”Œ WebSocketSingleton: Released connection for ".concat(t," (").concat(n," subscribers remaining)")),0===n){var o=this.connections.get(t);o&&o.readyState===WebSocket.OPEN&&(console.log("ðŸ”Œ WebSocketSingleton: Closing connection for ".concat(t," (no more subscribers)")),o.close(1e3,"No more subscribers")),this.connections.delete(t),this.connectionCounts.delete(t)}}else console.log("ðŸ”Œ WebSocketSingleton: Attempted to release non-existent connection for ".concat(t))}},{key:"forceClose",value:function(t){if(this.connections.has(t)){var e=this.connections.get(t);e&&e.readyState===WebSocket.OPEN&&(console.log("ðŸ”Œ WebSocketSingleton: Force closing connection for ".concat(t)),e.close(1e3,"Force close")),this.connections.delete(t),this.connectionCounts.delete(t)}}},{key:"getConnectionStatus",value:function(t){return this.connections.has(t)?{exists:!0,readyState:this.connections.get(t).readyState,subscribers:this.connectionCounts.get(t)||0}:{exists:!1,readyState:null,subscribers:0}}},{key:"getAllConnections",value:function(){var t,e={},n=u(this.connections.entries());try{for(n.s();!(t=n.n()).done;){var o=s(t.value,2),r=o[0],c=o[1];e[r]={readyState:c.readyState,subscribers:this.connectionCounts.get(r)||0}}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"clearAll",value:function(){console.log("ðŸ”Œ WebSocketSingleton: Clearing all connections");var t,e=u(this.connections.entries());try{for(e.s();!(t=e.n()).done;){var n=s(t.value,2),o=(n[0],n[1]);o&&o.readyState===WebSocket.OPEN&&o.close(1e3,"Clear all")}}catch(t){e.e(t)}finally{e.f()}this.connections.clear(),this.connectionCounts.clear(),this.creatingConnections.clear()}}],o&&v(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,r,c}(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.events={}},e=[{key:"on",value:function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}},{key:"off",value:function(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(function(t){return t!==e}))}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.events[t]&&this.events[t].forEach(function(e){try{e.apply(void 0,n)}catch(e){console.error("Error in event listener for ".concat(t,":"),e)}})}},{key:"removeAllListeners",value:function(t){t?delete this.events[t]:this.events={}}}],e&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}())),new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.connections=new Map},(e=[{key:"registerConnection",value:function(t,e){if(!this.connections.has(t))return this.connections.set(t,{connectionId:e,timestamp:Date.now(),count:1}),console.log("ðŸ”Œ ConnectionManager: Registered connection ".concat(e," for ").concat(t)),!0;var n=this.connections.get(t),o=Date.now()-n.timestamp;return o>3e4?(this.connections.set(t,{connectionId:e,timestamp:Date.now(),count:1}),console.log("ðŸ”Œ ConnectionManager: Allowed new connection ".concat(e," for ").concat(t," (old connection was ").concat(o,"ms ago)")),!0):(n.count++,console.log("ðŸ”Œ ConnectionManager: Blocked connection ".concat(e," for ").concat(t," (").concat(n.count," attempts in ").concat(o,"ms)")),!1)}},{key:"unregisterConnection",value:function(t,e){var n=this.connections.get(t);n&&n.connectionId===e&&(this.connections.delete(t),console.log("ðŸ”Œ ConnectionManager: Unregistered connection ".concat(e," for ").concat(t)))}},{key:"isConnectionAllowed",value:function(t){var e=this.connections.get(t);return!e||Date.now()-e.timestamp>3e4}},{key:"getConnectionInfo",value:function(t){return this.connections.get(t)}},{key:"clearAll",value:function(){this.connections.clear(),console.log("ðŸ”Œ ConnectionManager: Cleared all connections")}}])&&w(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}()),n(540),n(848);const j={VoiceSDK,WebSocketManager,WebSocketManagerV2,AudioRecorder,AudioPlayer,EventEmitter,VoiceButton,VanillaVoiceButton,AgentSDK,AgentWidget,VERSION:"2.0.0"};return o.default})());
//# sourceMappingURL=agent-widget.js.map